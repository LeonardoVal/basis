{"version":3,"sources":["../src/__prologue__.js","../src/core.js","../src/polyfill.js","../src/objects.js","../src/text.js","../src/math.js","../src/functions.js","../src/Initializer.js","../src/iterables.js","../src/Future.js","../src/HttpRequest.js","../src/Parallel.js","../src/Events.js","../src/Randomness.js","../src/Chronometer.js","../src/Statistic.js","../src/Statistics.js","../src/Logger.js","../src/__epilogue__.js"],"names":["__init__","Sermat","exports","__package__","__name__","__dependencies__","__SERMAT__","include","global","Function","f","raise","Error","Array","prototype","slice","call","arguments","join","raiseIf","condition","apply","this","callStack","exception","stack","stacktrace","split","e","obj","result","i","length","copy","objTo","k","objFrom","hasOwnProperty","bind","_this","TypeError","args","fToBind","F_NOP","fBound","concat","String","repeat","n","objects","subconstructor","parent","constructor","Object","create","setPrototypeOf","__proto__","addMember","key","value","force","modifiers","pop","indexOf","forEach","scope","defineProperty","get","set","enumerable","configurable","addMembers","members","keys","map","id","declare","shift","undefined","initializer","unimplemented","cls","name","XML_ENTITIES","<",">","&","\"","'","Text","clear","text","add","toString","escapeXML","str","replace","c","static XML_ENTITIES","addXML","escapeRegExp","formatDate","date","format","useUTC","Date","lpad","match","charAt","getUTCFullYear","getFullYear","getUTCMonth","getMonth","getUTCDate","getDate","getUTCHours","getHours","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","getUTCMilliseconds","getMilliseconds","substr","addDate","static lpad","len","pad","isNaN","static rpad","static hashCode","charCodeAt","math","clamp","min","max","Math","sign","x","factorial","b","NaN","combinations","gauss_pdf","mean","variance","standardDeviation","sqrt","exp","pow","PI","gauss_erfc","z","abs","t","ans","gauss_cdf","functions","I","K","S","y","__infixOperator__","op","Initializer","subject","options","missingValueError","defaultValue","typeCheck","coerced","coerce","typeMismatchError","regexp","exec","invalidValueError","minimum","maximum","check","attr","overwrite","attrOverwriteError","ignore","bool","Boolean","string","number","Number","integer","floor","func","array","isArray","object","values","objectType","STOP_ITERATION","Iterable","__iter__","__iteratorFromString__","__iteratorFromArray__","__iteratorFromObject__","__iteratorSingleton__","dual STOP_ITERATION","dual stop","dual catchStop","static __iteratorFromArray__","static __iteratorFromString__","static __iteratorFromObject__","static __iteratorSingleton__","finished","isEmpty","err","catchStop","count","from","iter","indicesOf","filter","v","indexWhere","indicesWhere","doFunction","ifFunction","forEachApply","mapFunction","filterFunction","mapApply","select","__selection__","member","filterApply","takeWhile","Infinity","stop","take","dropWhile","dropping","drop","head","tail","last","it","init","greater","evaluation","maxEval","push","lesser","minEval","sample","random","EMPTY","Randomness","DEFAULT","buffer","r","p","splice","sort","t1","t2","foldl","foldFunction","initial","scanl","foldr","reverse","scanr","sum","all","predicate","strict","any","sep","toArray","toObject","sorted","sortFunction","permutations","pool","current","indices","range","is","j","slices","size","groupBy","currentKey","currentValues","valueKey","pair","groupAll","DEFAULT_KEY","DEFAULT_ACCUM","xs","accum","elem","static zipWith","its","iterable","iterators","iterator","zipWith","static zip","zip","product","unshift","tuple","static product","chain","static chain","flatten","self","nub","comp","union","unionBy","intersection","intersectionBy","difference","differenceBy","static range","to","step","static repeat","static iterate","cycle","elems","JSON","stringify","Future","state","callbacks","resolve","__future__","static __isFuture__","STATES","isPending","isResolved","isRejected","isCancelled","__complete__","context","__completion__","callback","setTimeout","reject","reason","cancel","__register__","done","fail","__onCancel__","always","future","then","onResolved","onRejected","__isFuture__","static when","static then","static invoke","fn","when","error","static all","futures","doneCallback","index","static any","iterables","static sequence","rejection","action","lastValue","static doWhile","loopEnd","invoke","loop","checks","static whileDo","doWhile","static delay","ms","now","static retrying","times","delay","delayFactor","maxDelay","retrying","static imports","require","HttpRequest","__request__","XMLHttpRequest","request","method","url","content","headers","user","password","xhr","open","getOwnPropertyNames","setRequestHeader","onreadystatechange","readyState","status","send","getText","responseText","getJSON","parse","post","postJSON","Parallel","worker","newWorker","onmessage","__onmessage__","static newWorker","src","msg","base","eval","data","postMessage","blob","Blob","type","Worker","URL","createObjectURL","run","code","static run","parallel","terminate","importScripts","loadModule","module","recursive","sequence","dep","consoleLog","console","log","Events","config","initialize","__listeners__","events","eventName","listeners","emit","listener","on","isOpen","maxListeners","once","off","generator","__random__","randomInt","randomBool","prob","randoms","choice","choices","shuffle","normalizeWeights","weightedValues","weight","weightedChoice","chance","weightedChoices","maxProb","results","averagedDistribution","randomFunc","s","static __SERMAT__","identifier","serializer","materializer","LinearCongruential","m","a","seed","__arguments__","static numericalRecipies","static borlandC","static glibc","MersenneTwister","unsigned","__seed__","numbers","generate","Chronometer","reset","__timestamp__","time","tick","chronometer","total","Statistic","__count__","__sum__","__sqrSum__","__min__","__max__","__minData__","__maxData__","applies","squareSum","minData","maxData","average","biased","center","addAll","gain","factor","DEFAULT_GAIN_FACTOR","gainAll","addStatistic","stat","startTime","timestamp","__chronometer__","addTime","addTick","static z_test","sampleCount","sampleMean","p_lessThan","p_greaterThan","p_notEqual","z_test","static t_test1","sampleStandardDeviation","t_test1","static t_test2","sampleCount1","sampleCount2","sampleMean1","sampleMean2","sampleVariance1","sampleVariance2","pooledVariance","t_test2","other","kv","Statistics","__stats__","__id__","stats","keyVal","addObject","addStatistics","accumulation","acc","fsep","rsep","Logger","level","ROOT","appenders","passes","LEVELS","logger","message","appender","defaultFormat","TRACE","DEBUG","INFO","WARN","ERROR","FATAL","OK","FAIL","TODO","FIXME","trace","debug","info","warn","fatal","htmlFormat","tag","cssClassPrefix","appendToConsole","__consoleAppender__","entry","appendToFile","filepath","flags","encoding","stream","createWriteStream","fileAppender","write","appendToHtml","htmlElement","maxEntries","reversed","document","getElementById","getElementsByTagName","entries","htmlAppender","innerHTML","appendAsWorkerMessages","messageTag","postMessageAppender"],"mappings":";;uMAEA,SAASA,SAASC,QAAU,aAE3B,IAAIC,SACHC,YAAa,kBACbC,SAAU,OACVJ,SAAUA,SACVK,kBAAmBJ,QACnBK,YAAcC,aCAZC,OAASN,QAAQM,OACZC,SACA,eAADC,GAMJC,MAAQT,QAAQS,MAAQ,WAC3B,MAAM,IAAIC,MAAMC,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAK1DC,QAAUjB,QAAQiB,QAAU,SAAiBC,GAC5CA,GACHT,MAAMU,MAAMC,KAAMT,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,KAQtDM,UAAYrB,QAAQqB,UAAY,SAAmBC,GACtD,GAAIA,EACH,OAAQA,EAAUC,OAASD,EAAUE,YAAc,IAAIC,MAAK,MACtD,IACN,MAAM,IAAIf,MACT,MAAOgB,GACRJ,EAAYI,EAEb,OAAQJ,EAAUC,OAASD,EAAUE,YAAc,IAAIC,MAAK,MAAOZ,MAAM,IAMtEc,IAAM3B,QAAQ2B,IAAM,WAEvB,IADA,IAAIC,KACKC,EAAI,EAAGA,EAAId,UAAUe,OAAQD,GAAK,EAC1CD,EAAOb,UAAUc,GAAG,IAAOd,UAAUc,EAAE,GAExC,OAAOD,GAMJG,KAAO/B,QAAQ+B,KAAO,SAAcC,GACvC,IAAWC,EAAGC,EAAVL,EAAI,EAKR,IAJId,UAAUe,OAAS,IACtBE,KACAH,EAAI,GAEEA,EAAId,UAAUe,OAAQD,IAE5B,IAAKI,KADLC,EAAUnB,UAAUc,GAEfK,EAAQC,eAAeF,KAAOD,EAAMG,eAAeF,KACtDD,EAAMC,GAAKC,EAAQD,IAItB,OAAOD,GC/DHzB,SAASK,UAAUwB,OACvB7B,SAASK,UAAUwB,KAAO,SAAcC,GACvC,GAAoB,mBAATjB,KACV,MAAM,IAAIkB,UAAS,wEAEpB,GAAIvB,UAAUe,OAAS,EACtB,OAAOV,KAER,IAAImB,EAAO5B,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAChDyB,EAAUpB,KACVqB,EAAQ,aACRC,EAAS,WACR,OAAOF,EAAQrB,MAAMkB,EAAOE,EAAKI,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,cAIrE,OAFA0B,EAAM7B,UAAYQ,KAAKR,UACvB8B,EAAO9B,UAAY,IAAI6B,EAChBC,IAOJE,OAAOhC,UAAUiC,SACrBD,OAAOhC,UAAUiC,OAAS,SAAgBC,GAEzC,OADAA,GAAQ,IACI,EAAI,GAAS,EAAJA,EAAQ1B,KAAOA,KAAKyB,OAAOC,EAAI,IAAM1B,KAAOA,MAAMyB,OAAOC,GAAK,KC/BrF,IAAIC,QAAU/C,QAAQ+C,QAAU,WAI/B,IAAIC,EAAiB5B,KAAK4B,eAAiB,SAAwBC,EAAQC,GAiB1E,MAf2B,mBAAhBA,IACVA,EAAc,WACbD,EAAO9B,MAAMC,KAAML,aAGrBmC,EAAYtC,UAAYuC,OAAOC,OAAOH,EAAOrC,WAC7CsC,EAAYtC,UAAUsC,YAAcA,EAIhCC,OAAOE,eACVF,OAAOE,eAAeH,EAAaD,GAEnCC,EAAYI,UAAYL,EAElBC,GAeJK,EAAYnC,KAAKmC,UAAY,SAAmBL,EAAaM,EAAKC,EAAOC,GAC5E,IAAIC,EAAYH,EAAI/B,MAAK,OACzB+B,EAAMG,EAAUC,OACZD,EAAUE,QAAO,SAAY,GACtBX,EAAaA,EAAYtC,WACzB+C,EAAUE,QAAO,WAAc,GAC/BX,IAEAA,EAAYtC,YAEhBkD,QAAQ,SAAUC,GACxB,GAAIL,QAA+B,IAAfK,EAAMP,GACzB,OAAIG,EAAUE,QAAO,aAAgB,EAC7BV,OAAOa,eAAeD,EAAOP,EAAKC,GAC/BE,EAAUE,QAAO,UAAa,EACjCV,OAAOa,eAAeD,EAAOP,GACnCS,IAAK,WAAc,OAAOR,GAC1BS,IAAK,WAAc,MAAM,IAAIxD,MAAM8C,EAAI,kBACvCW,YAAY,EACZC,cAAc,IAGRL,EAAMP,GAAOC,KASpBY,EAAajD,KAAKiD,WAAa,SAAoBnB,EAAaoB,EAASZ,GAC5EP,OAAOoB,KAAKD,GAASE,IAAI,SAAUC,GAClClB,EAAUL,EAAauB,EAAIH,EAAQG,GAAKf,MAU5B1D,QAAQ0E,QAAUtD,KAAKsD,QAAU,WAC9C,IAAInC,EAAO5B,MAAMC,UAAUC,MAAMC,KAAKC,WACrCkC,EAASV,EAAKT,OAAS,EAAIS,EAAKoC,QAAUxB,OAC1CmB,EAAU/B,EAAKT,OAAS,EAAIS,EAAKqB,SACjCV,EAAcF,EAAeC,EAAQqB,EAAQnC,eAAc,eAAkBmC,EAAQpB,iBAAc0B,GACnGC,EAAcP,EAAO,IAetB,OAdAnB,OAAOoB,KAAKD,GAASE,IAAI,SAAUC,GACvB,KAAPA,GAAoB,gBAAPA,GAChBlB,EAAUL,EAAauB,EAAIH,EAAQG,IAAK,KAG1ClC,EAAKuB,QAAQ,SAAUQ,GACC,mBAAZA,IACVA,EAAUA,EAAQ1D,WAEnByD,EAAWnB,EAAaoB,GAAS,KAEP,mBAAhBO,GACVA,EAAY1D,MAAM+B,GAEZA,GAOY9B,KAAK0D,cAAgB,SAAuBC,EAAKN,GACpE,OAAO,WACN,MAAM,IAAI/D,OAAOqE,GAAO3D,KAAK8B,YAAY8B,MAAM,IAAMP,EAAG,wCAI1D,OAAOrD,MACLN,SAEC4D,QAAU3B,QAAQ2B,QCnHlBO,cACFC,IAAK,OACLC,IAAK,OACLC,IAAK,QACLC,IAAK,SACLC,IAAK,UAENC,KAAOvF,QAAQuF,KAAOb,SAItBxB,YAAa,WACZ9B,KAAKoE,SAKNA,MAAO,WACN,IAAIC,EAAOrE,KAAKqE,KAEhB,OADArE,KAAKqE,KAAO,GACLA,GAKRC,IAAK,WACJ,IAAK,IAAI7D,EAAI,EAAGA,EAAId,UAAUe,OAAQD,IACrCT,KAAKqE,MAAQ1E,UAAUc,IAMzB8D,SAAU,WACT,OAAOvE,KAAKqE,MAUbG,UAAW,SAAmBC,GAC7B,IAAIZ,EAAe7D,KAAK6D,aACxB,OAAQY,EAAI,IAAKC,QAAO,WAAa,SAAUC,GAC9C,OAAOd,EAAac,MAMtBd,aAAcA,aACde,sBAAuBf,aAIvBgB,OAAQ,WACP,IAAK,IAAIpE,EAAI,EAAGA,EAAId,UAAUe,OAAQD,IACrCT,KAAKqE,MAAQrE,KAAKwE,UAAU7E,UAAUc,KASxCqE,aAAc,SAAsBL,GACnC,OAAQA,EAAI,IAAKC,QAAO,wBAA0B,SASnDK,WAAY,SAAoBC,EAAMC,EAAQC,GAC7CF,EAAOA,GAAQ,IAAIG,KACnB,IAAIC,EAAOjB,KAAKiB,KAChB,OAAQH,EAA2BA,EAAOP,QAAO,2CAChD,SAAUW,GACT,OAAQA,EAAMC,OAAO,IACrB,IAAK,IAAK,OAAOF,GAAMF,EAASF,EAAKO,iBAAmBP,EAAKQ,eAAe,GAAKH,EAAM3E,OAAQ,KAC/F,IAAK,IAAK,OAAO0E,GAAOF,EAASF,EAAKS,cAAgBT,EAAKU,YAAc,EAAG,GAAKL,EAAM3E,OAAQ,KAC/F,IAAK,IAAK,OAAO0E,GAAMF,EAASF,EAAKW,aAAeX,EAAKY,WAAW,GAAKP,EAAM3E,OAAQ,KACvF,IAAK,IAAK,OAAO0E,GAAMF,EAASF,EAAKa,cAAgBb,EAAKc,YAAY,GAAKT,EAAM3E,OAAQ,KACzF,IAAK,IAAK,OAAO0E,GAAMF,EAASF,EAAKa,cAAgBb,EAAKc,YAAc,GAAG,GAAKT,EAAM3E,OAAQ,KAC9F,IAAK,IAAK,OAAO0E,GAAMF,EAASF,EAAKe,gBAAkBf,EAAKgB,cAAc,GAAKX,EAAM3E,OAAQ,KAC7F,IAAK,IAAK,OAAO0E,GAAMF,EAASF,EAAKiB,gBAAkBjB,EAAKkB,cAAc,GAAKb,EAAM3E,OAAQ,KAC7F,IAAK,IAAK,OAAO0E,GAAMF,EAASF,EAAKmB,qBAAuBnB,EAAKoB,mBAAmB,GAAKf,EAAM3E,OAAQ,KACvG,IAAK,IAAK,OAAO,KAAI,UAAYwE,EAASF,EAAKa,cAAgBb,EAAKc,YAAc,KAAKO,OAAO,EAAGhB,EAAM3E,QACvG,IAAK,IAAK,OAAO,KAAI,UAAYwE,EAASF,EAAKa,cAAgBb,EAAKc,YAAc,KAAKO,OAAO,EAAGhB,EAAM3E,QACvG,IAAK,IAAK,OAAO2E,EAAMgB,OAAO,EAAGhB,EAAM3E,OAAO,GAC9C,QAAS,OAAO2E,KAdDL,EAAKT,YAsBvB+B,QAAS,SAAiBtB,EAAMC,EAAQC,GACvClF,KAAKqE,MAAQrE,KAAK+E,WAAWC,EAAMC,EAAQC,IAQ5CqB,cAAe,SAAc9B,EAAK+B,EAAKC,GACtC,OAAIC,MAAMF,IAAQ/B,EAAI/D,QAAU8F,EACxB/B,IAEPgC,GAAOA,GAAO,KAAK,IACPhF,QAAQ+E,EAAM/B,EAAI/D,QAAU+F,EAAI/F,OAAS,GAAK+D,GAAK4B,QAAQG,IAOzEG,cAAe,SAAclC,EAAK+B,EAAKC,GACtC,OAAIC,MAAMF,IAAQ/B,EAAI/D,QAAU8F,EACxB/B,GAGCA,GADRgC,GAAOA,GAAO,KAAK,IACDhF,QAAQ+E,EAAM/B,EAAI/D,QAAU+F,EAAI/F,OAAS,IAAI2F,OAAO,EAAGG,IAM3EI,kBAAmB,SAAkBnC,GAGpC,IAFA,IAAIjE,EAAS,EACZgG,EAAM/B,EAAI/D,OACFD,EAAI,EAAGA,EAAI+F,IAAO/F,EAC1BD,EAAmB,GAATA,EAAciE,EAAIoC,WAAWpG,GAAM,WAE9C,OAAOD,KAIT2D,KAAKK,UAAYL,KAAK3E,UAAUgF,UAChCL,KAAKW,aAAeX,KAAK3E,UAAUsF,aACnCX,KAAKY,WAAaZ,KAAK3E,UAAUuF,WCpJjC,IAAI+B,KAAOlI,QAAQkI,QAMnBA,KAAKC,MAAQ,SAAe1E,EAAO2E,EAAKC,GACvC,OAAOC,KAAKF,IAAIC,EAAKC,KAAKD,IAAID,EAAK3E,KAKpCyE,KAAKK,KAAO,SAAcC,GAEzB,OAAc,KADdA,GAAKA,IACcV,MAAMU,GAAMA,EAAIA,EAAI,EAAI,GAAK,GAQjD,IAAIC,UAAYP,KAAKO,UAAY,SAAmB3F,EAAG4F,GAGtD,GAFA5F,GAAM,EACN4F,EAAIJ,KAAKD,IAAI,EAAK,EAAFK,GACZ5F,EAAI,EACP,OAAO6F,IAEP,IAAK,IAAInI,EAAI,EAAGsC,EAAI4F,IAAK5F,EACxBtC,GAAKsC,EAEN,OAAOtC,GAOT0H,KAAKU,aAAe,SAAsB9F,EAAGb,GAC5C,OAAOwG,UAAU3F,EAAGb,GAAKwG,UAAU3F,EAAIb,IAQxCiG,KAAKW,UAAY,SAAmBpF,EAAOqF,EAAMC,GAChDD,EAAOhB,MAAMgB,GAAQ,GAAKA,EAC1BC,EAAWjB,MAAMiB,GAAY,GAAKA,EAClC,IAAIC,EAAoBV,KAAKW,KAAKF,GAE/B,OAAOT,KAAKY,KAAKZ,KAAKa,IAAIX,EAAIM,EAAM,IAAM,EAAIC,IAChDC,EAAoBV,KAAKW,KAAK,EAAIX,KAAKc,KAOzClB,KAAKmB,WAAa,SAAoB5F,GACrC,IAAI6F,EAAIhB,KAAKiB,IAAI9F,GAChB+F,EAAI,GAAO,EAAM,GAAMF,GACvBG,EAAMD,EAAIlB,KAAKY,KAAKI,EAAIA,EAAI,WAAaE,GAAK,WAAaA,GAAK,UAC/DA,GAAK,UAAaA,GAAmBA,GAAK,UAAaA,GACvDA,GAAK,WAAaA,GAAuB,UAAJA,EAAb,YADqC,aAArC,eAEvB,OAAO/F,GAAS,EAAMgG,EAAM,EAAMA,GAMtCvB,KAAKwB,UAAY,SAAmBjG,EAAOqF,EAAMC,GAChDD,EAAOhB,MAAMgB,GAAQ,GAAKA,EAC1BC,EAAWjB,MAAMiB,GAAY,GAAKA,EAClC,IAAIC,EAAoBV,KAAKW,KAAKF,GAElC,OAAOb,KAAKmB,aAAa5F,EAAQqF,IAASE,EAAoBV,KAAKW,KAAK,KAAO,GC7EhF,IAAIU,UAAY3J,QAAQ2J,aAWxBA,UAAUC,EAAID,UAAUlF,GAAK,SAAY+D,GACxC,OAAOA,GAKRmB,UAAUE,EAAI,SAAYrB,GACzB,OAAOA,GAMRmB,UAAUG,EAAI,SAAYtB,EAAGuB,EAAGT,GAC/B,OAAOd,EAAE1H,KAAKM,KAAMkI,EAAGS,EAAEjJ,KAAKM,KAAMkI,KAMrCK,UAAUK,kBAAoB,SAAUC,GACvC,OAAO,IAAI1J,SAAQ,IAAM,IAAK,aAAc0J,EAAG,SAGhD,wEAAwExI,MAAK,OAAQqC,QAAQ,SAAUmG,GACtG,IAAIzJ,EAAImJ,UAAUK,kBAAkBC,GACpCN,UAAUM,GAAMzJ,EAChBmJ,UAAS,IAAMM,EAAG,KAAQzJ,IAG3BmJ,UAAS,KAAQA,UAAS,OAAU,IAAIpJ,SAAQ,IAAM,cACtDoJ,UAAS,KAAQA,UAAS,OAAU,IAAIpJ,SAAQ,IAAM,cACtDoJ,UAAS,OAAU,IAAIpJ,SAAQ,IAAM,cACrCoJ,UAAS,OAAU,IAAIpJ,SAAQ,IAAM,cACrCoJ,UAAiB,OAAKA,UAAS,YAAe,IAAIpJ,SAAQ,IAAM,oBAChEoJ,UAAe,KAAKA,UAAS,UAAa,IAAIpJ,SAAQ,IAAM,kBAE5DoJ,UAAS,KAAQA,UAAS,OAAU,IAAIpJ,SAAQ,IAAM,IAAK,gBAC3DoJ,UAAS,MAASA,UAAS,QAAW,IAAIpJ,SAAQ,IAAM,IAAK,IAAK,qBC/ClE,IAAI2J,YAAclK,QAAQkK,YAAcxF,SAIvCxB,YAAa,SAAqBiH,EAAS5H,GAC1CnB,KAAK+I,QAAUA,MACf/I,KAAKmB,KAAOA,OAmBb0B,IAAK,SAAaQ,EAAI2F,GACrB,IAAI3G,EASJ,GARA2G,EAAUA,MACLhJ,KAAKmB,KAAKJ,eAAesC,GAK7BhB,EAAQrC,KAAKmB,KAAKkC,IAJlBxD,SAASmJ,EAAQjI,eAAc,gBAC9BiI,EAAQC,mBAAqB,qBAAsB5F,EAAG,MACvDhB,EAAQ2G,EAAQE,cAIbF,EAAQG,UAAW,CACtB,IAAIC,EAAUJ,EAAQG,UAAU9G,IAAS2G,EAAQK,QACjDxJ,aAA2B,IAAZuJ,EAAyBJ,EAAQM,mBAC/C,uBAAwBjH,EAAM,UAAYgB,EAAG,MAC9ChB,EAAQ+G,EAWT,OATAvJ,QAAQmJ,EAAQO,SAAWP,EAAQO,OAAOC,KAAKnH,GAAQ2G,EAAQS,mBAC9D,UAAWpH,EAAM,UAAYgB,EAAG,oBAAsB2F,EAAQO,OAAO,KACtE1J,QAAQmJ,EAAQjI,eAAc,YAAeiI,EAAQU,QAAUrH,EAAO2G,EAAQS,mBAC7E,UAAWpH,EAAM,UAAYgB,EAAG,sCAAwC2F,EAAQU,QAAQ,KACzF7J,QAAQmJ,EAAQjI,eAAc,YAAeiI,EAAQW,QAAUtH,EAAO2G,EAAQS,mBAC7E,UAAWpH,EAAM,UAAYgB,EAAG,mCAAqC2F,EAAQW,QAAQ,KACzD,mBAAlBX,EAAQY,OAClBZ,EAAQY,MAAMlK,KAAKM,KAAK+I,QAAS1G,EAAOgB,EAAI2F,GAEtC3G,GAORwH,KAAM,SAAcxG,EAAI2F,GACvBA,EAAUA,MACV,IACCnJ,QAAQmJ,EAAQjI,eAAc,eAAkBiI,EAAQc,WAAa9J,KAAK+I,QAAQhI,eAAesC,GAChG2F,EAAQe,oBAAsB,cAAe1G,EAAG,yBACjDrD,KAAK+I,QAAQ1F,GAAMrD,KAAK6C,IAAIQ,EAAI2F,GAC/B,MAAO9I,GACR,IAAK8I,EAAQgB,OACZ,MAAM9J,EAGR,OAAOF,MAURiK,KAAM,SAAc5G,EAAI2F,GAUvB,OATAA,EAAUA,OACFG,UAAY,SAAwB9G,EAAOgH,GAClD,MAAqB,kBAAVhH,QACAmB,IAAVnB,GAAiC,OAAVA,GAAkBA,EAAMP,cAAgBoI,QACxD7H,EACGgH,IACDhH,OADH,GAIDrC,KAAK6J,KAAKxG,EAAI2F,IAKtBmB,OAAQ,SAAgB9G,EAAI2F,GAU3B,OATAA,EAAUA,OACFG,UAAY,SAA0B9G,EAAOgH,GACpD,MAAqB,iBAAVhH,QACAmB,IAAVnB,GAAiC,OAAVA,GAAkBA,EAAMP,cAAgBN,OACxDa,EACGgH,EACH,GAAIhH,OADL,GAIDrC,KAAK6J,KAAKxG,EAAI2F,IAKtBoB,OAAQ,SAAgB/G,EAAI2F,GAU3B,OATAA,EAAUA,OACFG,UAAY,SAA0B9G,EAAOgH,GACpD,MAAqB,iBAAVhH,QACAmB,IAAVnB,GAAiC,OAAVA,GAAkBA,EAAMP,cAAgBuI,OACxDhI,EACGgH,GACFhH,OADF,GAIDrC,KAAK6J,KAAKxG,EAAI2F,IAKtBsB,QAAS,SAAiBjH,EAAI2F,GAS7B,OARAA,EAAUA,OACFG,UAAY,SAA2B9G,EAAOgH,GACrD,OAAInC,KAAKqD,MAAMlI,KAAWA,EAClBA,EACGgH,EACHnC,KAAKqD,OAAOlI,QADb,GAIDrC,KAAK6J,KAAKxG,EAAI2F,IAKtBwB,KAAM,SAAcnH,EAAI2F,GAQvB,OAPAA,EAAUA,OACFG,UAAY,SAAwB9G,EAAOgH,GAClD,GAAqB,mBAAVhH,QACAmB,IAAVnB,GAAiC,OAAVA,GAAkBA,EAAMP,cAAgB3C,SAC/D,OAAOkD,GAGFrC,KAAK6J,KAAKxG,EAAI2F,IAKtByB,MAAO,SAAepH,EAAI2F,GAQzB,OAPAA,EAAUA,OACFG,UAAY,SAAyB9G,EAAOgH,GACnD,GAAI9J,MAAMmL,QAAQrI,GAEjB,OAAOA,GAGFrC,KAAK6J,KAAKxG,EAAI2F,IAOtB2B,OAAQ,SAAgBtH,EAAI2F,GAQ3B,OAPAA,EAAUA,OACFG,UAAY,SAA0ByB,EAAQvB,GACrD,GAAqB,iBAAVhH,QAAqD,mBAAvB2G,EAAQ6B,YAChDxI,iBAAiB2G,EAAQ6B,YACzB,OAAOxI,OAGFrC,KAAK6J,KAAKxG,EAAI2F,MC3KnB8B,eAAiB,IAAIxL,MAAK,uBAE1ByL,SAAWnM,QAAQmM,SAAWzH,SAQjCxB,YAAa,SAASiJ,EAASxK,GAC9B,GAAY,OAARA,QAAwBiD,IAARjD,EACnB,MAAM,IAAIjB,MAAK,yCACU,mBAARiB,EACjBP,KAAKgL,SAAWzK,EACS,iBAARA,EACjBP,KAAKgL,SAAWD,EAASE,uBAAuB1K,GACtChB,MAAMmL,QAAQnK,GACxBP,KAAKgL,SAAWD,EAASG,sBAAsB3K,GACtB,iBAARA,EACW,mBAAjBA,EAAIyK,SACdhL,KAAKgL,SAAWzK,EAAIyK,SAAShK,KAAKT,GAElCP,KAAKgL,SAAWD,EAASI,uBAAuB5K,GAGjDP,KAAKgL,SAAWD,EAASK,sBAAsB7K,IAOjD8K,sBAAuBP,eAKvBQ,YAAa,WACZ,MAAMR,gBAMPS,iBAAkB,SAAmBrL,GACpC,GAAIA,IAAc4K,eACjB,MAAM5K,GASRsL,+BAAgC,SAA+Bf,GAC9D,OAAO,WACN,IAAIhK,EAAI,EACR,OAAO,WACN,GAAIA,EAAIgK,EAAM/J,OACb,OAAO+J,EAAMhK,KAEb,MAAMqK,kBASVW,gCAAiC,SAAgChH,GAChE,OAAO,WACN,IAAIhE,EAAI,EACR,OAAO,WACN,GAAIA,EAAIgE,EAAI/D,OACX,OAAO+D,EAAIa,OAAO7E,KAElB,MAAMqK,kBASVY,gCAAiC,SAAgCnL,GAChE,OAAO,WACN,IAAI4C,EAAOpB,OAAOoB,KAAK5C,GACvB,OAAO,WACN,GAAI4C,EAAKzC,OAAS,EAAG,CACpB,IAAIG,EAAIsC,EAAKI,QACb,OAAQ1C,EAAGN,EAAIM,IAEf,MAAMiK,kBASVa,+BAAgC,SAA+BvE,GAC9D,OAAO,WACN,IAAIwE,GAAW,EACf,OAAO,WACN,GAAKA,EAIJ,MAAMd,eAFN,OADAc,GAAW,EACJxE,KAYXyE,QAAS,WACR,IAEC,OADA7L,KAAKgL,UAALhL,IACO,EACN,MAAO8L,GAER,OADA9L,KAAK+L,UAAUD,IACR,IAQTE,MAAO,WACN,IAAIxL,EAAS,EAIb,OAHAR,KAAK0C,QAAQ,SAAU0E,GACtB5G,MAEMA,GAKRE,OAAQ,WACP,OAAOV,KAAKgM,SAMbvJ,QAAS,SAAiBJ,EAAO4J,GAChCA,GAAY,EACZ,IAA4B7E,EAAxB8E,EAAOlM,KAAKgL,WAAevK,EAAI,EACnC,IACC,IAAK2G,EAAI8E,KAAc9E,EAAI8E,MAAUzL,EACpC,GAAIA,GAAKwL,GAAQ7E,IAAM/E,EACtB,OAAO5B,EAGR,MAAOqL,GACR9L,KAAK+L,UAAUD,GAEhB,OAAQ,GAKTK,UAAW,SAAmB9J,EAAO4J,GAEpC,OADAA,GAAY,EACLjM,KAAKoM,OAAO,SAAUC,EAAG5L,GAC/B,OAAOA,GAAKwL,GAAQI,IAAMhK,GACxB,SAAUgK,EAAG5L,GACf,OAAOA,KAOT6L,WAAY,SAAoBxM,EAAWmM,GAC1CA,GAAY,EACZ,IAA4B7E,EAAxB8E,EAAOlM,KAAKgL,WAAevK,EAAI,EACnC,IACC,IAAK2G,EAAI8E,KAAc9E,EAAI8E,MAAUzL,EACpC,GAAIA,GAAKwL,GAAQnM,EAAUsH,EAAG3G,GAC7B,OAAOA,EAGR,MAAOqL,GACR9L,KAAK+L,UAAUD,GAEhB,OAAQ,GAMTS,aAAc,SAAsBzM,EAAWmM,GAE9C,OADAA,GAAY,EACLjM,KAAKoM,OAAO,SAAUC,EAAG5L,GAC/B,OAAOA,GAAKwL,GAAQnM,EAAUuM,IAC5B,SAAUA,EAAG5L,GACf,OAAOA,KAUTiC,QAAS,SAAiB8J,EAAYC,GACrC,IAA4BrF,EAAU5G,EAAlC0L,EAAOlM,KAAKgL,WAAevK,EAAI,EACnC,IACC,IAAK2G,EAAI8E,KAAc9E,EAAI8E,IAAQzL,IAC7BgM,IAAcA,EAAWrF,EAAG3G,KAChCD,EAASgM,EAAWpF,EAAG3G,IAGxB,MAAOqL,GACR9L,KAAK+L,UAAUD,GAEhB,OAAOtL,GAORkM,aAAc,SAAsBF,EAAYC,EAAYxL,GAE3D,OADAA,EAAQA,GAASjB,KACVA,KAAK0C,QAAQ,SAAUvB,EAAMV,GACnC,OAAO+L,EAAWzM,MAAMkB,EAAOE,EAAKI,QAAQd,MAC1CgM,IAOJrJ,IAAK,SAAauJ,EAAaC,GAC9B,IAAIX,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAA4B3D,EAAxB8E,EAAOD,EAAKjB,WAAevK,GAAK,EACpC,OAAO,WACN,IAAK2G,EAAI8E,KAAc9E,EAAI8E,IAG1B,GAFAzL,IACA2G,EAAIuF,EAAcA,EAAYvF,EAAG3G,GAAK2G,GACjCwF,GAAkBA,EAAexF,EAAG3G,GACxC,OAAO2G,EAGT,MAAM0D,mBAST+B,SAAU,SAAkBF,EAAaC,EAAgB3L,GAExD,OADAA,EAAQA,GAASjB,KACVA,KAAKoD,IAAI,SAAUjC,EAAMV,GAC/B,OAAOkM,EAAY5M,MAAMkB,EAAOE,EAAKI,QAAQd,MAC3CmM,IAQJE,OAAQ,WAgBP,OAAO,SAAgB5J,GACtB,OAAOlD,KAAKoD,IAAI,SAAU7C,GACzB,OAjBF,SAASwM,EAAcd,EAAMe,GAC5B,GAAIzN,MAAMmL,QAAQsC,GACjB,OAAOA,EAAO5J,IAAI2J,EAAc/L,KAAK,KAAMiL,IACrC,GAAsB,iBAAXe,EAAqB,CACtC,IAAIxM,KAIJ,OAHAuB,OAAOoB,KAAK6J,GAAQtK,QAAQ,SAAU7B,GACrCL,EAAOK,GAAKkM,EAAcrN,KAAK,KAAMuM,EAAMe,EAAOnM,MAE5CL,EACD,MAAsB,mBAAXwM,EACVA,EAAOf,GAEPA,EAAKe,GAKLD,CAAcxM,EAAK2C,MAlBrB,GA6BRkJ,OAAQ,SAAgBQ,EAAgBD,GACvC,IAAIV,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAA4B3D,EAAxB8E,EAAOD,EAAKjB,WAAevK,GAAK,EACpC,OAAO,WACN,OAGC,GAFA2G,EAAI8E,IACJzL,IACImM,EAAiBA,EAAexF,EAAG3G,GAAK2G,EAC3C,OAAOuF,EAAcA,EAAYvF,EAAG3G,GAAK2G,EAG3C,MAAM0D,mBASTmC,YAAa,SAAqBL,EAAgBD,EAAa1L,GAE9D,OADAA,EAAQA,GAASjB,KACVA,KAAKoM,OAAO,SAAUjL,EAAMV,GAClC,OAAOmM,EAAe7M,MAAMkB,EAAOE,EAAKI,QAAQd,MAC9CkM,GAAe,SAAUxL,EAAMV,GACjC,OAAOkM,EAAY5M,MAAMkB,EAAOE,EAAKI,QAAQd,QAO/CyM,UAAW,SAAmBpN,GAC7B,IAAImM,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAAImB,EAAOD,EAAKjB,WACfvK,EAAI,EACL,OAAO,WACN,GAAIA,GAAK,EAAG,CACX,IAAI2G,EAAI8E,IACR,GAAIpM,EAAUsH,EAAG3G,GAEhB,OADAA,IACO2G,EAEP3G,GAAK0M,EAAAA,EAGPlB,EAAKmB,WAORC,KAAM,SAAc3L,GAEnB,OADAA,EAAIgF,MAAMhF,GAAK,EAAQ,EAAJA,EACZ1B,KAAKkN,UAAU,SAAU9F,EAAG3G,GAClC,OAAOA,EAAIiB,KAOb4L,UAAW,SAAmBxN,GAC7B,IAAImM,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAAImB,EAAOD,EAAKjB,WACfvK,EAAI,EACJ8M,GAAW,EACZ,OAAO,WACN,IAAInG,EACJ,GACCA,EAAI8E,IACJqB,EAAWA,GAAYzN,EAAUsH,EAAG3G,GACpCA,UACQ8M,GACT,OAAOnG,MAOVoG,KAAM,SAAc9L,GAEnB,OADAA,EAAIgF,MAAMhF,GAAK,EAAQ,EAAJA,EACZ1B,KAAKsN,UAAU,SAAUlG,EAAG3G,GAClC,OAAOA,EAAIiB,KAOb+L,KAAM,SAAcvE,GACnB,IACC,OAAOlJ,KAAKgL,UAALhL,GACN,MAAO8L,GAER,GADA9L,KAAK+L,UAAUD,GACXnM,UAAUe,OAAS,EACtB,MAAM,IAAIpB,MAAK,qDAEf,OAAO4J,IAOVwE,KAAM,WACL,IAAIzB,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAAImB,EAAOD,EAAKjB,WAChB,IACCkB,IACC,MAAOJ,GAER,MADA9L,KAAK+L,UAAUD,GACT,IAAIxM,MAAK,+CAEhB,OAAO4M,KAOTyB,KAAM,SAAczE,GACnB,IAAI1I,EAAQqL,GAAU,EAAM+B,EAAK5N,KAAKgL,WACtC,IACC,IAAKa,GAAU,GAAYA,GAAU,EACpCrL,EAASoN,IAET,MAAO9B,GAER,GADA9L,KAAK+L,UAAUD,GACVD,EAEE,CAAA,GAAIlM,UAAUe,OAAS,EAC7B,MAAM,IAAIpB,MAAK,qDAEf,OAAO4J,EAJP,OAAO1I,IAWVqN,KAAM,WACL,IAAI5B,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAA4B4C,EAAxBzB,EAAOD,EAAKjB,WAChB,IACC2C,EAAOzB,IACN,MAAOJ,GAER,MADA9L,KAAK+L,UAAUD,GACT,IAAIxM,MAAK,+CAEhB,OAAO,WACN,IAAIkB,EAASmN,EAEb,OADAA,EAAOzB,IACA1L,MAQVsN,QAAS,SAAiBC,GACzBA,EAAmC,mBAAfA,EAA4BA,EAAa,SAAU3G,GACrE,OAAQA,GAEV,IAAsC9G,EAAlC0N,GAAWb,EAAAA,EAAU3M,KAUzB,OATAR,KAAK0C,QAAQ,SAAU0E,GACtB9G,EAAIyN,EAAW3G,GACX4G,EAAU1N,GACb0N,EAAU1N,EACVE,GAAU4G,IACA4G,GAAW1N,GACrBE,EAAOyN,KAAK7G,KAGP5G,GAMR0N,OAAQ,SAAgBH,GACvBA,EAAmC,mBAAfA,EAA4BA,EAAa,SAAU3G,GACrE,OAAQA,GAEV,IAAqC9G,EAAjC6N,EAAUhB,EAAAA,EAAU3M,KAUxB,OATAR,KAAK0C,QAAQ,SAAU0E,GACtB9G,EAAIyN,EAAW3G,GACX+G,EAAU7N,GACb6N,EAAU7N,EACVE,GAAU4G,IACA+G,GAAW7N,GACrBE,EAAOyN,KAAK7G,KAGP5G,GAMR4N,OAAQ,SAAgB1M,EAAG2M,GAE1B,IADA3M,GAAM,GACE,EACP,OAAOqJ,SAASuD,MAEjBD,EAASA,GAAUE,WAAWC,QAC9B,IAAIC,KAYJ,OAXAzO,KAAK0C,QAAQ,SAAU0E,EAAG3G,GAEzB,IADA,IAAIiO,EAAIL,EAAOA,SACNM,EAAIF,EAAO/N,OAAQiO,EAAI,GAAKF,EAAOE,EAAE,GAAG,GAAKD,IAAKC,GAE3D,IADAF,EAAOG,OAAOD,EAAG,GAAID,EAAGtH,EAAG3G,IACpBgO,EAAO/N,OAASgB,GACtB+M,EAAOjM,QAGTiM,EAAOI,KAAK,SAAUC,EAAIC,GACzB,OAAOD,EAAG,GAAKC,EAAG,KAEZ,IAAIhE,SAAS0D,EAAOrL,IAAI,SAAUgF,GACxC,OAAOA,EAAE,OAUX4G,MAAO,SAAeC,EAAcC,GACnC,IAA4B9H,EAAxB8E,EAAOlM,KAAKgL,WAChB,IAEC,IADAkE,OAAsB1L,IAAZ0L,EAAwBhD,IAASgD,EACtC9H,EAAI8E,KAAc9E,EAAI8E,IAC1BgD,EAAUD,EAAaC,EAAS9H,GAEhC,MAAO0E,GACR9L,KAAK+L,UAAUD,GAEhB,OAAOoD,GAORC,MAAO,SAAeF,EAAcC,GACnC,IAAIjD,EAAOjM,KACX,OAAO,IAAI+K,SAAS,WACnB,IAA4B1I,EAAxB6J,EAAOD,EAAKjB,WAAmBgB,GAAS,EAC5C,OAAO,WAON,OAJC3J,EADa,MADd2J,OAEqBxI,IAAZ0L,EAAwBhD,IAASgD,EAEjCD,EAAa5M,EAAO6J,SAahCkD,MAAO,SAAeH,EAAcC,GAInC,OAAOlP,KAAKqP,UAAUL,MAHtB,SAA6B5H,EAAEuB,GAC9B,OAAOsG,EAAatG,EAAEvB,IAE0B8H,IASlDI,MAAO,SAAeL,EAAcC,GAInC,OAAOlP,KAAKqP,UAAUF,MAHtB,SAA6B/H,EAAEuB,GAC9B,OAAOsG,EAAatG,EAAEvB,IAE0B8H,IAKlDK,IAAK,SAAa7N,GACjB,IAAIlB,EAASkG,MAAMhF,GAAK,GAAKA,EAI7B,OAHA1B,KAAK0C,QAAQ,SAAU0E,GACtB5G,IAAY4G,IAEN5G,GAMRwG,IAAK,SAAatF,GACjB,IAAIlB,EAASkG,MAAMhF,GAAKyL,EAAAA,GAAYzL,EAOpC,OANA1B,KAAK0C,QAAQ,SAAU0E,IACtBA,GAAMA,GACE5G,IACPA,EAAS4G,KAGJ5G,GAMRyG,IAAK,SAAavF,GACjB,IAAIlB,EAASkG,MAAMhF,IAAMyL,EAAAA,GAAYzL,EAOrC,OANA1B,KAAK0C,QAAQ,SAAU0E,IACtBA,GAAMA,GACE5G,IACPA,EAAS4G,KAGJ5G,GAMRgP,IAAK,SAAaC,EAAWC,GAC5BD,EAAiC,mBAAdA,EAA2BA,EAAY,SAAUrI,GAAK,QAASA,GAClF,IAAI5G,GAAS,EASb,OARAR,KAAK0C,QAAQ,SAAU0E,EAAG3G,GACzB,IAAKgP,EAAUrI,EAAG3G,KACjBD,GAAS,GACJkP,GACJ,MAAM5E,iBAIFtK,GAMRmP,IAAK,SAAaF,EAAWC,GAC5BD,EAAiC,mBAAdA,EAA2BA,EAAY,SAAUrI,GAAK,QAASA,GAClF,IAAI5G,GAAS,EASb,OARAR,KAAK0C,QAAQ,SAAU0E,EAAG3G,GACzB,GAAIgP,EAAUrI,EAAG3G,KAChBD,GAAS,GACJkP,GACJ,MAAM5E,iBAIFtK,GAMRZ,KAAM,SAAcgQ,GACnB,IAAIpP,EAAS,GAKb,OAJAoP,EAAM,IAAKA,GAAO,IAClB5P,KAAK0C,QAAQ,SAAU0E,EAAG3G,GACzBD,GAAiB,IAANC,EAAW2G,EAAIwI,EAAMxI,IAE1B5G,GAQRqP,QAAS,SAAiBpF,GAKzB,OAJAA,EAAQA,MACRzK,KAAK0C,QAAQ,SAAU0E,GACtBqD,EAAMwD,KAAK7G,KAELqD,GAMRqF,SAAU,SAAkBvP,GAK3B,OAJAA,EAAMA,MACNP,KAAK0C,QAAQ,SAAU0E,GACtB7G,EAAI6G,EAAE,IAAMA,EAAE,KAER7G,GASR8O,QAAS,WACR,OAAO,IAAItE,SAAS/K,KAAK6P,UAAUR,YAQpCU,OAAQ,SAAgBC,GACvB,OAAO,IAAIjF,SAAS/K,KAAK6P,UAAUhB,KAAKmB,KAQzCC,aAAc,SAAsBpP,GACnCA,GAAM,EACN,IAAIqP,EAAOlQ,KAAK6P,UACfnO,EAAIwO,EAAKxP,OACV,GAAIG,EAAI,GAAKA,EAAIa,EAChB,OAAOqJ,SAASuD,MAEhB,IAAItC,EAAQlF,KAAKO,UAAU3F,GAAKoF,KAAKO,UAAU3F,EAAIb,GACnD,OAAO,IAAIkK,SAAS,WACnB,IAAIoF,EAAU,EACbC,EAAUrF,SAASsF,MAAM3O,GAAGmO,UAC7B,OAAO,WACN,GAAIM,EAAUnE,EAAO,CAIpB,IAHA,IAAIxL,EAAS,IAAIjB,MAAMsB,GACtByP,EAAKF,EAAQ3Q,QACbgB,EAAI0P,EACIxB,EAAI,EAAGA,EAAI9N,IAAK8N,EACxBnO,EAAOmO,GAAKuB,EAAKI,EAAG1B,OAAOnO,GAAKiB,EAAIiN,GAAI,GAAG,IAC3ClO,EAAKA,GAAKiB,EAAIiN,GAAK,EAGpB,QADEwB,EACK3P,EAEP,MAAMsK,mBAaXtD,aAAc,SAAsB3G,GACnCA,GAAM,EACN,IAAIqP,EAAOlQ,KAAK6P,UACfnO,EAAIwO,EAAKxP,OACV,OAAIG,EAAI,GAAKA,EAAIa,EACTqJ,SAASuD,MAET,IAAIvD,SAAS,WACnB,IAAIqF,EAAUrF,SAASsF,MAAMxP,GAAGgP,UAC/BM,EAAUC,EAAQhN,IAAI,SAAU3C,GAAK,OAAOyP,EAAKzP,KAClD,OAAO,WACN,IAAK0P,EAAS,MAAMrF,eAEpB,IADA,IAAItK,EAAS2P,EACJ1P,EAAII,EAAE,EAAGJ,GAAK,GAClB2P,EAAQ3P,KAAOA,EAAIiB,EAAIb,IADAJ,GAG5B,GAAIA,EAAI,EACP0P,EAAU,SACJ,CACNC,EAAQ3P,IAAM,EACd,IAAK,IAAI8P,EAAI9P,EAAE,EAAG8P,EAAI1P,IAAK0P,EAC1BH,EAAQG,GAAKH,EAAQG,EAAE,GAAK,EAE7BJ,EAAUC,EAAQhN,IAAI,SAAU3C,GAAK,OAAOyP,EAAKzP,KAElD,OAAOD,MASXgQ,OAAQ,SAAgBC,GACvB,IAAIxP,EAAQjB,KAEZ,OADAyQ,EAAO/J,MAAM+J,IAASA,EAAO,EAAI,EAAS,EAALA,EAC9B,IAAI1F,SAAS,WACnB,IAA2BtL,EAAvBmO,EAAK3M,EAAM+J,WACf,OAAO,WACNvL,KACA,IACC,IAAK,IAAIgB,EAAI,EAAGA,EAAIgQ,IAAQhQ,EAC3BhB,EAAMwO,KAAKL,KAEX,MAAO9B,GACR,GAAIA,IAAQhB,eACX,MAAMgB,EAGR,GAAIrM,EAAMiB,OAAS,EAClB,OAAOjB,EAEP,MAAMqL,mBAWV4F,QAAS,SAAiBtO,GACzB,IAAIwL,EAAK5N,KACT,OAAO,IAAI+K,SAAS,WACnB,IACuB4F,EADnBzE,EAAO0B,EAAG5C,WACb4F,EAAgB,KACjB,IACCA,GAAiB1E,KACjByE,EAAavO,EAAMA,EAAIwO,EAAc,IAAMA,EAAc,GACxD,MAAO9E,GACR8B,EAAG7B,UAAUD,GAEd,OAAO,WACN,IAAIzJ,EAAOwO,EAAUC,EACrB,GAAKF,EAEE,OACN,IAGC,GAFAvO,EAAQ6J,KACR2E,EAAWzO,EAAMA,EAAIC,GAASA,KACbsO,EAMhB,OAHAG,GAAQH,EAAYC,GACpBD,EAAaE,EACbD,GAAiBvO,GACVyO,EALPF,EAAc3C,KAAK5L,GAOnB,MAAOyJ,GAIR,OAHA8B,EAAG7B,UAAUD,GACbgF,GAAQH,EAAYC,GACpBA,EAAgB,KACTE,OAjBRlD,EAAGR,WA6BP2D,SAAU,WACT,SAASC,EAAY5J,GACpB,OAAOA,EAAE,GAEV,SAAS6J,EAAcC,EAAI9J,GAG1B,OAFA8J,EAAKA,OACFjD,KAAK7G,GACD8J,EAER,OAAO,SAAkB9O,EAAK+O,GAC7B,IAAI3Q,KAOJ,OANA4B,EAAMA,GAAO4O,EACbG,EAAQA,GAASF,EACjBjR,KAAK0C,QAAQ,SAAU0O,EAAM3Q,GAC5B,IAAII,EAAIuB,EAAIgP,EAAM3Q,GAClBD,EAAOK,GAAKsQ,EAAM3Q,EAAOK,GAAIuQ,EAAM3Q,KAE7BD,GAjBC,GA2BV6Q,iBAAkB,SAAiBjS,GAClC,IAAIkS,EAAM/R,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGyD,IAAImO,UACvD,OAAO,IAAIxG,SAAS,WACnB,IAAIyG,EAAYF,EAAIlO,IAAI,SAAUwK,GACjC,OAAOA,EAAG5C,aAEX,OAAO,WACN,IAAI0D,EAAI8C,EAAUpO,IAAI,SAAUqO,GAC/B,OAAOA,MAER,OAAOrS,EAAIA,EAAEW,MAAM,KAAM2O,GAAKA,MAKjCgD,QAAS,SAAiBtS,GACzB,IAAI+B,GAAQ/B,EAAGY,MAAMuB,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,IAClE,OAAOK,KAAK8B,YAAY4P,QAAQ3R,MAAMC,KAAK8B,YAAaX,IAGzDwQ,aAAc,WACb,IAAIxQ,GAAQ,MAAMI,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,YACpD,OAAOK,KAAK0R,QAAQ3R,MAAMC,KAAMmB,IAGjCyQ,IAAK,WACJ,IAAIzQ,GAAQ,KAAMnB,MAAMuB,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,YAC1D,OAAOK,KAAK8B,YAAY4P,QAAQ3R,MAAMC,KAAK8B,YAAaX,IAOzD0Q,QAAS,WACR,IAAIP,EAAM/R,MAAMC,UAAUC,MAAMC,KAAKC,WAAWyD,IAAImO,UAEpD,OADAD,EAAIQ,QAAQ9R,MACL,IAAI+K,SAAS,WACnB,IAAIyG,EAAWO,EACf,OAAO,WACN,GAAKP,EAOE,CAAA,IAAKO,EACX,MAAMjH,eAEN,IAAK,IAAIrK,EAAI+Q,EAAU9Q,OAAS,EAAGD,GAAK,IAAKA,EAC5C,IACCsR,EAAMtR,GAAK+Q,EAAU/Q,KACrB,MACC,MAAOqL,GACR,KAAIrL,EAAI,GAAKqL,IAAQhB,gBAKpB,MADAiH,EAAQ,KACFjG,EAJN0F,EAAU/Q,GAAK6Q,EAAI7Q,GAAGuK,WACtB+G,EAAMtR,GAAK+Q,EAAU/Q,WAhBxB+Q,EAAYF,EAAIlO,IAAI,SAAUwK,GAC7B,OAAOA,EAAG5C,aAEX+G,EAAQP,EAAUpO,IAAI,SAAU8I,GAC/B,OAAOA,MAoBT,OAAO6F,EAAMtS,MAAM,OAKtBuS,iBAAkB,SAAUpE,GAE3B,OADAA,EAAKA,EAAK2D,SAAS3D,GAAM5N,KAAKsO,MACvBtO,KAAKR,UAAUqS,QAAQ9R,MAAM6N,EAAIrO,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,KAM/EsS,MAAO,WACN,IAAIX,EAAM/R,MAAMC,UAAUC,MAAMC,KAAKC,WAAWyD,IAAImO,UAEpD,OADAD,EAAIQ,QAAQ9R,MACL,IAAI+K,SAAS,WACnB,IAAItK,EAAI,EAAGgR,EAAWH,EAAI,GAAGtG,WAC7B,OAAO,WACN,OAAa,IACZ,OAAOyG,IACN,MAAO3F,GACR,KAAIA,IAAQhB,gBAAkBrK,EAAI,EAAI6Q,EAAI5Q,QAIzC,MAAMoL,EAFN2F,EAAWH,IADX7Q,GACkBuK,WAKpB,MAAMF,mBAKToH,eAAgB,SAAUtE,GAEzB,OADAA,EAAKA,EAAK2D,SAAS3D,GAAM5N,KAAKsO,MACvBtO,KAAKR,UAAUyS,MAAMlS,MAAM6N,EAAIrO,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,KAK7EwS,QAAS,WACR,IAAIC,EAAOpS,KACX,OAAO,IAAI+K,SAAS,WACnB,IAAI6C,EAAKwE,EAAKpH,WACbyG,EAAWzR,KAAKoN,KACjB,OAAO,WACN,OAAa,IACZ,OAAOqE,IACN,MAAO3F,GACJA,IAAQhB,iBACX2G,EAAWF,SAAS3D,KAAM5C,YAG5B,MAAMF,mBAaTuH,IAAK,SAAaC,GACjB,IAAI7D,KACJ,OAAOzO,KAAKoM,OAAO,SAAUhF,GAC5B,GAAIkL,GACH,IAAK,IAAI7R,EAAIgO,EAAO/N,OAAO,EAAGD,GAAK,IAAKA,EACvC,GAAI6R,EAAK7D,EAAOhO,GAAI2G,GACnB,OAAO,OAGH,GAAIqH,EAAOhM,QAAQ2E,IAAM,EAC/B,OAAO,EAGR,OADAqH,EAAOR,KAAK7G,IACL,KAUTmL,MAAO,WACN,IAAIpR,QAAQ,GAAQI,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,YACtD,OAAOK,KAAKwS,QAAQzS,MAAMC,KAAMmB,IAGjCqR,QAAS,SAAiBF,GACzB,OAAOtS,KAAKiS,MAAMlS,MAAMC,KAAMT,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,IAAI0S,IAAIC,IAS7EG,aAAc,WACb,IAAItR,QAAQ,GAAQI,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,YACtD,OAAOK,KAAK0S,eAAe3S,MAAMC,KAAMmB,IAGxCuR,eAAgB,SAAwBJ,GAEvC,IADA,IAAI7D,EAASzO,KAAK6P,UACTpP,EAAI,EAAGA,EAAId,UAAUe,SAAUD,EACvCgO,EAAS8C,SAAS5R,UAAUc,IAAI2L,OAAO,SAAUhF,GAChD,GAAIkL,EAAM,CACT,IAAK,IAAI7R,EAAIgO,EAAO/N,OAAO,EAAGD,GAAK,IAAKA,EACvC,GAAI6R,EAAK7D,EAAOhO,GAAI2G,GACnB,OAAO,EAGT,OAAO,EAEP,OAAOqH,EAAOhM,QAAQ2E,IAAM,IAE3ByI,UAEJ,OAAO0B,SAAS9C,IASjBkE,WAAY,WACX,IAAIxR,QAAQ,GAAQI,OAAOhC,MAAMC,UAAUC,MAAMC,KAAKC,YACtD,OAAOK,KAAK4S,aAAa7S,MAAMC,KAAMmB,IAGtCyR,aAAc,SAAsBN,GAGnC,IAFA,IACC7D,EADGjO,EAASR,KAEJS,EAAI,EAAGA,EAAId,UAAUe,SAAUD,EACvCgO,EAAS8C,SAAS5R,UAAUc,IAAIoP,UAChCrP,EAASA,EAAO4L,OAAO,SAAUhF,GAChC,GAAIkL,EAAM,CACT,IAAK,IAAI7R,EAAIgO,EAAO/N,OAAO,EAAGD,GAAK,IAAKA,EACvC,GAAI6R,EAAK7D,EAAOhO,GAAI2G,GACnB,OAAO,EAGT,OAAO,EAEP,OAAOqH,EAAOhM,QAAQ2E,GAAK,IAI9B,OAAO5G,GAQRqS,eAAgB,SAAe5G,EAAM6G,EAAIC,GACxC,OAAQpT,UAAUe,QACjB,KAAK,EAAGuL,EAAO,EAAG6G,EAAK,EAAGC,EAAO,EAAG,MACpC,KAAK,EAAGD,EAAK7G,EAAMA,EAAO,EAAG8G,EAAO,EAAG,MACvC,KAAK,EAAGA,EAAO,EAEhB,OAAO,IAAIhI,SAAS,WACnB,IAAc2D,EAAVjO,EAAIwL,EACR,OAAO,WACN,GAAIvF,MAAMjG,IAAMiG,MAAMoM,IAAOrS,GAAKqS,EACjC,MAAMhI,eAIN,OAFA4D,EAAIjO,EACJA,GAAQsS,EACDrE,MASXsE,gBAAiB,SAAgB5L,EAAG1F,GAEnC,OADAA,EAAIgF,MAAMhF,GAAKyL,EAAAA,GAAYzL,EACpB,IAAIqJ,SAAS,WACnB,IAAItK,EAAIiB,EACR,OAAO,WAEN,KADAjB,EACQ,EACP,MAAMqK,eAEN,OAAO1D,MASX6L,iBAAkB,SAAiB7T,EAAGgI,EAAG1F,GAExC,OADAA,EAAIgF,MAAMhF,GAAKyL,EAAAA,GAAYzL,EACpB,IAAIqJ,SAAS,WACnB,IAAItK,EAAIiB,EAAGW,EAAQ+E,EACnB,OAAO,WAEN,KADA3G,EACQ,EACP,MAAMqK,eAEN,IAAItK,EAAS6B,EAEb,OADAA,EAAQjD,EAAEiD,GACH7B,MASX0S,MAAO,SAAexR,GACrBA,OAAU8B,IAAN9B,EAAkByL,EAAAA,GAAazL,EACnC,IAAI6P,EAAWvR,KACf,OAAO,IAAI+K,SAAS,WACnB,IAAItK,EAAIiB,EAAGwK,EAAOqF,EAASvG,WAC3B,OAAO,WACN,KAAOvK,EAAI,GAAG,IACb,OAAOyL,IACN,MAAOJ,GACR,KAAIA,IAAQhB,gBAAkBrK,EAAI,GAIjC,MAAMqL,EAHNrL,IACAyL,EAAOqF,EAASvG,WAKlB,MAAMF,mBAUTvG,SAAU,SAAkB7C,GAC3BA,EAAO,EAAFA,GAAQ,EACb,IAAIyR,EAAQnT,KAAKqN,KAAK3L,EAAI,GAAGmO,UAC7B,OAAIsD,EAAMzS,OAASgB,GAClByR,EAAM3Q,MACC,YAAa4Q,KAAKC,UAAUF,GAAOzO,QAAO,MAAQ,SAAS,KAE3D,YAAa0O,KAAKC,UAAUF,GAAO,OAO7CpI,SAASuD,MAAQ,IAAIvD,SAAS,WAC7B,OAAOA,SAASvL,UAAU4N,OAK3B,IAAImE,SAAW3S,QAAQ2S,SAAW,SAAkBhR,GACnD,YAAsB,IAARA,GAA+B,OAARA,GAAwC,mBAAjBA,EAAIyK,SAA0BzK,EAAM,IAAIwK,SAASxK,ICztC1G+S,OAAS1U,QAAQ0U,OAAShQ,SAI7BxB,YAAa,SAAgBO,GAC5BrC,KAAKuT,MAAQ,EACbvT,KAAKwT,qBACD7T,UAAUe,OAAS,GACtBV,KAAKyT,QAAQpR,IAQfqR,WAAY,WACX,OAAO1T,MAGR2T,sBAAuB,SAAsBpT,GAC5C,YAAsB,IAARA,GAA+B,OAARA,GAA0C,mBAAnBA,EAAImT,YAiBjEE,QAAQ,UAAY,WAAY,WAAY,aAE5CC,UAAW,WACV,OAAsB,IAAf7T,KAAKuT,OAGbO,WAAY,WACX,OAAsB,IAAf9T,KAAKuT,OAGbQ,WAAY,WACX,OAAsB,IAAf/T,KAAKuT,OAGbS,YAAa,WACZ,OAAsB,IAAfhU,KAAKuT,OAQbU,aAAc,SAAsBC,EAAS7R,EAAOkR,GAWnD,OATmB,IAAfvT,KAAKuT,QACRvT,KAAKuT,MAAQA,EACbvT,KAAKmU,gBAAkBD,EAAS7R,GAChCrC,KAAKwT,UAAUD,EAAQ,GAAG7Q,QAAQ,SAAU0R,GACnB,mBAAbA,GACVC,WAAWD,EAASpT,KAAKkT,EAAS7R,GAAQ,MAItCrC,MAMRyT,QAAS,SAAiBpR,EAAO6R,GAChC,OAAsB,IAAflU,KAAKuT,MAAcvT,KAAKiU,aAAaC,GAAWlU,KAAMqC,EAAO,GAAKrC,MAS1EsU,OAAQ,SAAgBC,EAAQL,GAC/B,GAAmB,IAAflU,KAAKuT,QACRvT,KAAKiU,aAAaC,GAAWlU,KAAMuU,EAAQ,GACvCvU,KAAKwT,UAAU,GAAG9S,OAAS,GAC9B,MAAI6T,aAAkBjV,MACfiV,EAEA,IAAIjV,MAAMiV,GAInB,OAAOvU,MAMRwU,OAAQ,SAAgBD,GACvB,OAAsB,IAAfvU,KAAKuT,MAAcvT,KAAKiU,aAAajU,KAAMuU,EAAQ,GAAKvU,MAGhEuE,SAAU,WACT,MAAO,UAAWvE,KAAK4T,OAAO5T,KAAKuT,QASpCkB,aAAc,SAAsBL,EAAUb,GAC7C,GAAwB,mBAAba,EAMV,OALmB,IAAfpU,KAAKuT,MACRvT,KAAKwT,UAAUD,EAAQ,GAAGtF,KAAKmG,GACrBpU,KAAKuT,QAAUA,GACzBc,WAAWD,EAASpT,KAAKhB,KAAKmU,eAAe,GAAInU,KAAKmU,eAAe,IAAK,GAEpEnU,KAEP,MAAM,IAAIV,MAAK,yCAA2C8U,EAAS,OAOrEM,KAAM,WACL,IAAK,IAAIjU,EAAI,EAAGA,EAAId,UAAUe,OAAQD,IACrCT,KAAKyU,aAAa9U,UAAUc,GAAI,GAEjC,OAAOT,MAMR2U,KAAM,WACL,IAAK,IAAIlU,EAAI,EAAGA,EAAId,UAAUe,OAAQD,IACrCT,KAAKyU,aAAa9U,UAAUc,GAAI,GAEjC,OAAOT,MAMR4U,aAAc,WACb,IAAK,IAAInU,EAAI,EAAGA,EAAId,UAAUe,OAAQD,IACrCT,KAAKyU,aAAa9U,UAAUc,GAAI,GAEjC,OAAOT,MAMR6U,OAAQ,WACP,OAAO7U,KAAK0U,KAAK3U,MAAMC,KAAML,WAAWgV,KAAK5U,MAAMC,KAAML,YAM1DqB,KAAM,SAAc8T,GAInB,OAHAA,EAAOJ,KAAK1U,KAAKyT,QAAQzS,KAAKhB,OAC9B8U,EAAOH,KAAK3U,KAAKsU,OAAOtT,KAAKhB,OAC7B8U,EAAOF,aAAa5U,KAAKwU,OAAOxT,KAAKhB,OAC9BA,MAUR+U,KAAM,SAAcC,EAAYC,GAC/B,IAAIzU,EAAS,IAAI8S,OA+BjB,OA9BAtT,KAAK0U,KAAK,SAAUrS,GAEnB,IACCA,EAAQ2S,EAAaA,EAAW3S,GAASA,EACrC6S,aAAa7S,GAChB7B,EAAOQ,KAAKqB,EAAMqR,cAElBlT,EAAOiT,QAAQpR,GAEf,MAAOyJ,GACRtL,EAAO8T,OAAOxI,MAGhB9L,KAAK2U,KAAK,SAAUJ,GACnB,GAAKU,EAGJ,IACCV,EAASU,EAAWV,GAChBW,aAAaX,GAChB/T,EAAOQ,KAAKuT,EAAOb,cAEnBlT,EAAOiT,QAAQc,GAEf,MAAOzI,GACRtL,EAAO8T,OAAOxI,QAVftL,EAAO8T,OAAOC,KAchBvU,KAAK4U,aAAapU,EAAOgU,OAAOxT,KAAKR,IAC9BA,GAQR2U,cAAe,SAAc9S,GAC5B,OAAO6S,aAAa7S,GAASA,EAAMqR,aAAe,IAAIJ,OAAOjR,IAW9D+S,cAAe,SAAc/S,EAAO2S,EAAYC,GAC/C,OAAOC,aAAa7S,GAASA,EAAMqR,aAAaqB,KAAKC,EAAYC,GAAcD,EAAW3S,IAM3FgT,gBAAiB,SAAgBC,EAAIrU,GACpC,IACC,OAAOsU,KAAKD,EAAGvV,MAAMkB,EAAO1B,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,KACjE,MAAO6V,GACR,IAAIhV,EAAS,IAAI8S,OAEjB,OADA9S,EAAO8T,OAAOkB,GACPhV,IAOTiV,aAAc,SAAaC,GAC1BA,EAAUnW,MAAMmL,QAAQgL,GAAWA,EAAUnE,SAASmE,GAAS7F,UAC/D,IAE4BiF,EAFxBtU,EAAS,IAAI8S,OAChBtH,EAAQ0J,EAAQhV,OAChBkK,EAAS,IAAIrL,MAAMyM,GACnB2J,EAAe,SAAUC,EAAOvT,GAC/BuI,EAAOgL,GAASvT,IACV2J,EAAQ,GACbxL,EAAOiT,QAAQ7I,IAGlB,GAAIoB,EAAQ,EACXxL,EAAOiT,iBACD,IAAK,IAAIhT,EAAI,EAAGA,EAAIiV,EAAQhV,OAAQD,KAC1CqU,EAASS,KAAKG,EAAQjV,KACfiU,KAAKiB,EAAa3U,KAAKhB,KAAMS,IACpCqU,EAAOH,KAAKnU,EAAO8T,OAAOtT,KAAKR,IAC/BsU,EAAOF,aAAapU,EAAOgU,OAAOxT,KAAKR,IAExC,OAAOA,GAMRqV,aAAc,SAAaH,GAC1BA,EAAUI,UAAUvE,SAASmE,GAAS7F,UACtC,IAE4BiF,EAFxBtU,EAAS,IAAI8S,OAChBtH,EAAQ0J,EAAQhV,OAChBkK,EAAS,IAAIrL,MAAMyM,GACpB,GAAIA,EAAQ,EACXxL,EAAO8T,cACD,IAAK,IAAI7T,EAAI,EAAGA,EAAIiV,EAAQhV,OAAQD,KAC1CqU,EAASS,KAAKG,EAAQjV,KACfkU,KAAI,SAAYiB,GACtB,OAAO,SAAUvT,GAChBuI,EAAOgL,GAASvT,IAChB2J,EACY,GACXxL,EAAO8T,OAAOjS,IALN,CAQR5B,IACHqU,EAAOJ,KAAKlU,EAAOiT,QAAQzS,KAAKR,IAChCsU,EAAOF,aAAapU,EAAOgU,OAAOxT,KAAKR,IAExC,OAAOA,GAMRuV,kBAAmB,SAAkB7E,EAAI9R,GACxC,IAA2BgI,EAAvB5G,EAAS,IAAI8S,OAChB0C,EAAYxV,EAAO8T,OAAOtT,KAAKR,GAC/BoN,EAAK2D,SAASL,GAAIlG,WAkBnB,OAjBU,SAASiL,EAAOC,GACxB,IAEC,OADA9O,EAAIwG,IACAxO,EACImW,KAAKnO,GAAG2N,KAAK3V,EAAG4W,GAAWjB,KAAKkB,EAAQD,GAExCT,KAAKnO,GAAG2N,KAAKkB,EAAQD,GAE5B,MAAOlK,GACJA,IAAQhB,eACXtK,EAAOiT,QAAQyC,GAEf1V,EAAO8T,OAAOxI,IAIlBmK,GACOzV,GAUR2V,iBAAkB,SAAiBF,EAAQnW,GAC1CA,EAAYA,GAAa,SAAUuC,GAClC,QAASA,GAEV,IAAI+T,EAAU,IAAI9C,OACjBgB,EAAS8B,EAAQ9B,OAAOtT,KAAKoV,GAW9B,OADA9C,OAAO+C,OAAOJ,GAAQlB,KATtB,SAASuB,EAAKjU,GACbiR,OAAO+C,OAAOvW,EAAW,KAAMuC,GAAO0S,KAAK,SAAUwB,GAChDA,EACHjD,OAAO+C,OAAOJ,EAAQ,KAAM5T,GAAO0S,KAAKuB,EAAMhC,GAE9C8B,EAAQ3C,QAAQpR,IAEfiS,IAE6BA,GAC1B8B,GAMRI,iBAAkB,SAAiB1W,EAAWmW,GAC7C,OAAO3C,OAAO+C,OAAOvW,GAAWiV,KAAK,SAAUwB,GAC9C,OAAOjD,OAAOmD,QAAQR,EAAQnW,MAQhC4W,eAAgB,SAAeC,EAAItU,GAClCsU,EAAKjQ,MAAMiQ,GAAM,GAAKzP,KAAKD,KAAK0P,EAAI,IACpCtU,OAAyB,IAAVA,EAAwB8C,KAAKyR,MAAQvU,EACpD,IAAI7B,EAAS,IAAI8S,OAEjB,OADAe,WAAW7T,EAAOiT,QAAQzS,KAAKR,EAAQ6B,GAAQsU,GACxCnW,GASRqW,kBAAmB,SAAkBzX,EAAG0X,EAAOC,EAAOC,EAAaC,GAElE,OADAH,EAAQpQ,MAAMoQ,GAAS,IAAMA,GACd,EAAIxD,OAAO+C,OAAOjX,GAAKkU,OAAO+C,OAAOjX,GAAG2V,UAAKvR,EAAW,WAItE,OAHAuT,EAAQrQ,MAAMqQ,GAAS,KAAOA,EAC9BC,EAActQ,MAAMsQ,GAAe,GAAOA,EAC1CC,EAAWvQ,MAAMuQ,GAAY,KAAUA,EAChC3D,OAAOyD,MAAMA,GAAOhC,KAAK,WAC/B,OAAOzB,OAAO4D,SAAS9X,EAAG0X,EAAQ,EAAG5P,KAAKF,IAAIiQ,EAAUF,EAAQC,GAAcA,EAAaC,QAS9FE,iBAAkB,WACjB,IAAI3W,EAAS,IAAI8S,OAMjB,OALA8D,QAAQ7X,MAAMC,UAAUC,MAAMC,KAAKC,WAAY,WAC9Ca,EAAOiT,QAAQlU,MAAMC,UAAUC,MAAMC,KAAKC,aACxC,SAAUmM,GACZtL,EAAO8T,OAAOxI,KAERtL,KAIL+U,KAAOjC,OAAOiC,KACjBL,aAAe5B,OAAO4B,aCranBmC,YAAczY,QAAQyY,YAAc/T,SACvCxB,YAAa,WACZ9B,KAAKsX,YAAc,IAAIC,gBAOxBC,QAAS,SAAiBC,EAAQC,EAAKC,EAASC,EAASC,EAAMC,GAC9D,IAAIC,EAAM/X,KAAKsX,YACdxC,EAAS,IAAIxB,OAiBd,OAhBAyE,EAAIC,KAAKP,EAAQC,GAAK,EAAMG,EAAMC,GAC9BF,GACH7V,OAAOkW,oBAAoBL,GAASlV,QAAQ,SAAUW,GACrD0U,EAAIG,iBAAiB7U,EAAIuU,EAAQvU,MAGnC0U,EAAII,mBAAqB,WACF,GAAlBJ,EAAIK,aACW,KAAdL,EAAIM,OACPvD,EAAOrB,QAAQsE,GAEfjD,EAAOR,OAAOyD,KAIjBA,EAAIO,KAAKX,GACF7C,GAMRjS,IAAK,SAAa6U,EAAKC,EAASC,EAASC,EAAMC,GAC9C,OAAO9X,KAAKwX,QAAO,MAAQE,EAAKC,EAASC,EAASC,EAAMC,IAMzDS,QAAS,SAAiBb,EAAKC,EAASC,EAASC,EAAMC,GACtD,OAAO9X,KAAK6C,IAAI6U,EAAKC,EAASC,EAASC,EAAMC,GAAU/C,KAAK,SAAUgD,GACrE,OAAOA,EAAIS,gBAObC,QAAS,SAAiBf,EAAKC,EAASC,EAASC,EAAMC,GACtD,OAAO9X,KAAK6C,IAAI6U,EAAKC,EAASC,EAASC,EAAMC,GAAU/C,KAAK,SAAUgD,GACrE,OAAO3E,KAAKsF,MAAMX,EAAIS,iBAOxBG,KAAM,SAAcjB,EAAKC,EAASC,EAASC,EAAMC,GAChD,OAAO9X,KAAKwX,QAAO,OAASE,EAAKC,EAASC,EAASC,EAAMC,IAM1Dc,SAAU,SAAkBlB,EAAKC,EAASC,EAASC,EAAMC,GAGxD,OAFAF,EAAUA,OACH,gBAAmB,mBACnB5X,KAAK2Y,KAAKjB,EAAKtE,KAAKC,UAAUsE,IAAY,OAAQC,EAASC,EAAMC,OAO1E,UAAY,MAAO,UAAW,UAAW,OAAQ,YAC/CpV,QAAQ,SAAUW,GACnBgU,YAAYhU,GAAM,WACjB,OAAOgU,YAAY7X,UAAU6D,GAAItD,MAAM,IAAIsX,YAAe1X,cChF5D,IAAIkZ,SAAWja,QAAQia,SAAWvV,SAIjCxB,YAAa,SAAS+W,EAASC,GACzBA,IACJA,EAASD,EAASE,aAEnBD,EAAOE,UAAYhZ,KAAKiZ,cAAcjY,KAAKhB,MAC3CA,KAAK8Y,OAASA,GAMfI,mBAAoB,SAASH,YAC5B,IAAII,IAAM,gBAAiBva,QAAQF,SAAS,yBACpB,SAAW0a,KAChC,IACChH,KAAKiH,KAAK/F,OAAOiC,KAAK+D,KAAKF,IAAIG,OAAOxE,KAAK,SAAUvU,GACpD4R,KAAKoH,YAAYpG,KAAKC,WAAY7S,OAAQA,OAE1C,MAAOsL,GACRsG,KAAKoH,YAAYpG,KAAKC,WAAYmC,MAAO1J,EAAI,QAE5C,KACJ2N,KAAO,IAAIC,MAAMP,MAAQQ,KAAM,oBAChC,OAAO,IAAIC,OAAOC,IAAIC,gBAAgBL,QAMvCR,cAAe,SAAuBG,GACrC,IAAItE,EAAS9U,KAAK0T,WAClB,GAAIoB,EAAQ,CACX9U,KAAK0T,WAAa,KAClB,IACC,IAAI6F,EAAOnG,KAAKsF,MAAMU,EAAIG,MACtBA,EAAK/D,MACRV,EAAOR,OAAOiF,EAAK/D,OAEnBV,EAAOrB,QAAQ8F,EAAK/Y,QAEpB,MAAOsL,GACRgJ,EAAOR,OAAOxI,MAUjBiO,IAAK,SAAaC,GACjB,GAAIha,KAAK0T,WACR,MAAM,IAAIpU,MAAK,sBAIhB,OAFAU,KAAK0T,WAAa,IAAIJ,OACtBtT,KAAK8Y,OAAOU,YAAYQ,EAAK,IACtBha,KAAK0T,YAObuG,aAAc,SAAaD,GAC1B,IAAIE,EAAW,IAAIrB,SACnB,OAAOqB,EAASH,IAAIC,GAAMnF,OAAO,WAChCqF,EAASpB,OAAOqB,eAMlBC,cAAe,WACd,OAAOpa,KAAK+Z,IAAG,iBACdxa,MAAMC,UAAUC,MAAMC,KAAKC,WAAWyD,IAAIgQ,KAAKC,WAAWzT,KAAI,KAAM,OAMtEya,WAAY,SAAoBC,EAAQC,GACvC,IAAIL,EAAWla,KACf,OAAOsT,OAAOkH,SAASD,EAAYD,EAAOvb,oBAAuB,SAAU0b,GAC1E,OAAOP,EAASG,WAAWI,EAAKF,KAC9BxF,KAAK,WACP,OAAOmF,EAASH,IAAG,QAAUO,EAAOxb,SAAS,aAAewb,EAAOxb,SAAS,KAC3Ewb,EAAO5b,SAAS,KAAQ4b,EAAOvb,iBAAiBqE,IAAI,SAAUqX,GAC7D,OAAOA,EAAI3b,WACTc,KAAI,KAAM,eAQhB8a,WAAY,SAAoBV,GAC/B,IAAI5a,EAAIY,KAAK+Z,IAAIC,GAEjB,OADA5a,EAAEsV,KAAKiG,QAAQC,KACRxb,KCxGLyb,OAASjc,QAAQic,OAASvX,SAW7BxB,YAAa,SAAgBgZ,GAC5BC,WAAW/a,KAAM8a,GACf1Q,OAAM,gBAAmBlB,aAAciE,EAAAA,EAAU9D,QAAQ,EAAMK,QAAS,IACxEO,KAAI,UAAaf,cAAc,IACjC,IAAI8R,EAAgBhb,KAAKgb,iBACrBF,GAAUvb,MAAMmL,QAAQoQ,EAAOG,SAClCH,EAAOG,OAAOvY,QAAQ,SAAUwY,GAC/BF,EAAcE,SAQjBC,UAAW,SAAmBD,GAC7B,OAAIlb,KAAKgb,cAAcja,eAAema,GAC9Blb,KAAKgb,cAAcE,GAAWzb,YAYvC2b,KAAM,SAAcF,GACnB,IAAI/Z,EACJ,GAAI5B,MAAMmL,QAAQwQ,GAAY,CAC7B,IAAID,EAASjb,KACbmB,EAAO5B,MAAMC,UAAUC,MAAMC,KAAKC,WAClCub,EAAUxY,QAAQ,SAAUkB,GAC3BzC,EAAK,GAAKyC,EACVqX,EAAOG,KAAKrb,MAAMC,KAAMmB,KAG1B,IAAKnB,KAAKgb,cAAcja,eAAema,GACtC,OAAO,EAER/Z,EAAO5B,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAC7BK,KAAKgb,cAAcE,GAanC,OAZAlb,KAAKgb,cAAcE,GAAalb,KAAKgb,cAAcE,GACjD9O,OAAO,SAAUiP,GACjB,OAAIA,EAAS,GAAK,IACjBhH,WAAW,WACV,OAAOgH,EAAS,GAAGtb,MAAMb,OAAQiC,IAC/B,GACHka,EAAS,KACFA,EAAS,GAAK,MAKjB,GAMRC,GAAI,SAAYJ,EAAW9G,EAAU0C,GACpC,GAAIvX,MAAMmL,QAAQwQ,GAAY,CAC7B,IAAID,EAASjb,KACbkb,EAAUxY,QAAQ,SAAUkB,GAC3BqX,EAAOK,GAAG1X,EAAMwQ,EAAU0C,SAErB,CACD9W,KAAKgb,cAAcja,eAAema,KACtCrb,SAASG,KAAKub,OAAQ,SAAUL,EAAW,oBAC3Clb,KAAKgb,cAAcE,OAEpB,IAAIC,EAAYnb,KAAKgb,cAAcE,GACnCrb,QAAQG,KAAKmb,UAAUza,QAAUV,KAAKwb,aACrC,yBAA0Bxb,KAAKwb,aAAc,wBAAyBN,EAAW,KAClFpE,GAAUA,GAAU3J,EAAAA,EACpBgO,EAAUlN,MAAMmG,EAAU0C,MAO5B2E,KAAM,SAAcP,EAAW9G,GAC9B,OAAOpU,KAAKsb,GAAGJ,EAAW9G,EAAU,IAKrCsH,IAAK,SAAaR,EAAW9G,GAC5B,GAAI7U,MAAMmL,QAAQwQ,GAAY,CAC7B,IAAID,EAASjb,KACbkb,EAAUxY,QAAQ,SAAUkB,GAC3BqX,EAAOS,IAAI9X,EAAMwQ,UAERpU,KAAKgb,cAAcja,eAAema,KAC5Clb,KAAKgb,cAAcE,GAAalb,KAAKgb,cAAcE,GACjD9O,OAAO,SAAUiP,GACjB,OAAOA,EAAS,KAAOjH,QC5GxB7F,WAAa3P,QAAQ2P,WAAajL,SAKrCxB,YAAa,SAAoB6Z,GACP,mBAAdA,IACV3b,KAAK4b,WAAaD,IAIpBC,WAAY1U,KAAKmH,OAOjBA,OAAQ,WACP,IAAI3M,EAAI1B,KAAK4b,aACb,OAAQjc,UAAUe,QACjB,KAAK,EAAG,OAAOgB,EACf,KAAK,EAAG,OAAOA,EAAI/B,UAAU,GAC7B,QAAS,OAAQ,EAAI+B,GAAK/B,UAAU,GAAK+B,EAAI/B,UAAU,KAMzDkc,UAAW,WACV,OAAO3U,KAAKqD,MAAMvK,KAAKqO,OAAOtO,MAAMC,KAAML,aAM3Cmc,WAAY,SAAoBC,GAC/B,OAAO/b,KAAKqO,UAAY3H,MAAMqV,GAAQ,IAAOA,IAQ9CC,QAAS,SAAiBta,GACzB,IACcjB,EADVU,EAAO5B,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAChDa,KAED,IADAkB,GAAKA,EACAjB,EAAI,EAAGA,EAAIiB,EAAGjB,IAClBD,EAAOyN,KAAKjO,KAAKqO,OAAOtO,MAAMC,KAAMmB,IAErC,OAAOX,GAMRyb,OAAQ,SAAgBhQ,GAIvB,OAHAA,EAAOtM,UAAUe,OAAS,EAAInB,MAAMC,UAAUC,MAAMC,KAAKC,WACxDJ,MAAMmL,QAAQuB,GAAQA,EACtBsF,SAAStF,GAAM4D,WACJnP,OAAS,OAAI8C,EAAYyI,EAAKjM,KAAK6b,UAAU5P,EAAKvL,UAM/Dwb,QAAS,SAAiBxa,EAAGuK,GAC5B,OAAOjM,KAAKK,MAAMN,MAAMC,KAAML,WAAW,IAO1CU,MAAO,SAAeqB,EAAGuK,GACxBA,EAAOtM,UAAUe,OAAS,EAAInB,MAAMC,UAAUC,MAAMC,KAAKC,WAAa4R,SAAStF,GAAM4D,UACrF,IAAInB,KACJ,IAAKhN,EAAIwF,KAAKF,IAAIiF,EAAKvL,OAAQwG,KAAKD,KAAKvF,EAAG,IAAKA,EAAI,EAAGA,IACvDgN,EAAIA,EAAEnN,OAAO0K,EAAK2C,OAAO5O,KAAK6b,UAAU5P,EAAKvL,QAAS,IAEvD,OAAQgO,EAAGzC,IAKZkQ,QAAS,SAAiBhJ,GACzB,OAAOnT,KAAKkc,QAAQ/I,EAAMzS,OAAQyS,IASnCiJ,iBAAkB,SAA0BC,GAE3C,IAAI9M,EAAM,EAAG7O,EAAS,EAMtB,OAPA2b,EAAiB9K,SAAS8K,IAEX3P,aAAa,SAAUrK,EAAOia,GAC5Czc,QAAQyc,EAAS,EAAG,2CACpB/M,GAAO+M,EACP5b,MAEM2b,EAAexP,SAAS,SAAUxK,EAAOia,GAC/C,OAAQja,EAAe,IAARkN,EAAY,EAAI7O,EAAS4b,EAAS/M,MAOnDgN,eAAgB,SAAwBF,GACvC,IAA4B7b,EAAxBgc,EAASxc,KAAKqO,SAQlB,OAPAkD,SAAS8K,GAAgB3P,aAAa,SAAUrK,EAAOia,IACtDE,GAAUF,IACI,IACb9b,EAAS6B,EACT0I,SAASqC,UAGJ5M,GAKRic,gBAAiB,SAAyB/a,EAAG2a,GAC5CA,EAAiB9K,SAAS8K,GAAgBxM,UAE1C,IADA,IAA+BxB,EAA3BqO,EAAU,EAAGC,KACRlc,EAAI,EAAGA,EAAIiB,IAAKjB,EACxB4N,EAASrO,KAAKqO,OAAOqO,GACrBnL,SAAS8K,GAAgB3P,aAAa,SAAUrK,EAAOia,EAAQ7b,IAC9D4N,GAAUiO,IACI,IACbK,EAAQ1O,KAAK5L,GACbqa,GAAWJ,EACXD,EAAezN,OAAOnO,EAAG,GACzBsK,SAASqC,UAIZ,OAAOuP,GAURC,qBAAsB,SAA8Blb,GACnDA,EAAIwF,KAAKD,KAAKvF,EAAG,GACjB,IAAImb,EAAa7c,KAAK4b,WACtB,OAAO,IAAIrN,WAAW,WAErB,IADA,IAAIuO,EAAI,EACCrc,EAAI,EAAGA,EAAIiB,EAAGjB,IACtBqc,GAAKD,IAEN,OAAOC,EAAIpb,KAQbqb,qBACCC,WAAY,aACZC,WAAY,SAA8B1c,GACzC,OAAOA,EAAIqb,aAAe1U,KAAKmH,QAAU9N,EAAIqb,gBAE9CsB,aAAc,SAAgC3c,EAAKY,GAClD,OAAOA,IAASA,EAAKT,OAAS,EAAI6N,WAAWC,QAAU,IAAID,WAAWpN,EAAK,SAU9EoN,WAAWC,QAAU,IAAID,YAEzB,SAAW,YAAa,aAAc,SAAU,QAAS,UAAW,UACnE,wBACC7L,QAAQ,SAAUW,GACnBkL,WAAWlL,GAAMkL,WAAWC,QAAQnL,GAAIrC,KAAKuN,WAAWC,WAWzD,IAAI2O,mBAAqB5O,WAAW4O,mBAAqB7Z,QAAQiL,YAChEzM,YAAa,SAA4Bsb,EAAGC,EAAG1Y,EAAG2Y,GACjD,IAAI7c,EAAIiG,MAAM4W,GAAQnY,KAAKyR,MAAQ1P,KAAKqD,MAAM+S,GAC9Ctd,KAAKud,eAAiBH,EAAGC,EAAG1Y,EAAGlE,GAC/BT,KAAK4b,WAAa,WACjB,OAAQnb,GAAK4c,EAAI5c,EAAIkE,GAAKyY,GAAKA,IAIjCL,qBACCC,WAAY,qBACZC,WAAY,SAAuC1c,GAClD,OAAOA,EAAIgd,gBAObC,2BAA4B,SAAUF,GACrC,OAAO,IAAIH,mBAAmB,WAAY,QAAS,WAAYG,IAMhEG,kBAAmB,SAAUH,GAC5B,OAAO,IAAIH,mBAAmB,WAAY,SAAU,EAAGG,IAMxDI,eAAgB,SAAUJ,GACzB,OAAO,IAAIH,mBAAmB,WAAY,WAAY,MAAOG,MAS/D/O,WAAWoP,gBAAkB,WAI5B,SAASC,EAASlc,GACjB,OAAOA,EAAI,EAAIA,EAAI,WAAcA,EAuBlC,OAAO4B,QAAQiL,YACdzM,YAAa,SAAyBwb,GACrCtd,KAAK6d,SAAWnX,MAAM4W,GAAQnY,KAAKyR,MAAQ1P,KAAKqD,MAAM+S,GACtD,IAAIQ,EAvBN,SAAoBR,GACnB,IACC3P,EADGmQ,EAAU,IAAIve,MAAM,KAExBue,EAAQ,GAAKnQ,EAAO2P,EACpB,IAAK,IAAI7c,EAAI,EAAGA,EAAI,MAAOA,EAC1Bqd,EAAQrd,GAAKkN,GAAQ,WAAaiQ,EAASjQ,EAAQA,GAAQ,IAAOlN,GAAK,WAExE,OAAOqd,EAgBQ/C,CAAW/a,KAAK6d,UAC7BjI,EAAQ,EACT5V,KAAK4b,WAAa,WACH,IAAVhG,GAhBP,SAAkBkI,GACjB,IAAI,IAAIrd,EAAI,EAAGA,EAAI,MAAOA,EAAG,CAC5B,IAAIkI,EAAkB,WAAbmV,EAAQrd,GAA2C,WAAvBqd,GAASrd,EAAE,GAAK,KACrDqd,EAAQrd,GAAKmd,EAASE,GAASrd,EAAI,KAAO,KAAY,EAAJkI,GAClC,IAAP,EAAJA,KACJmV,EAAQrd,GAAKmd,EAAsB,WAAbE,EAAQrd,MAY7Bsd,CAASD,GAEV,IAAInV,EAAImV,EAAQlI,GAMhB,OAFAjN,EAAIiV,GADJjV,EAAIiV,GADJjV,EAAIiV,GADJjV,EAAIiV,EAASjV,EAAKA,GAAK,KACJA,IAAM,EAAK,aACXA,IAAM,GAAM,aACbA,GAAK,IACvBiN,GAASA,EAAQ,GAAK,IACfjN,EAAI,aAIboU,qBACCC,WAAY,kBACZC,WAAY,SAAoC1c,GAC/C,OAAQA,EAAIsd,cAlDa,GCrP7B,IAAIG,YAAcpf,QAAQof,YAAc1a,SAIvCxB,YAAa,SAAqBsG,GACjCpI,KAAKie,MAAM7V,IAMZ6V,MAAO,SAAe7V,GACrB,OAAOpI,KAAKke,cAAgB9V,GAAKjD,KAAKyR,OAMvCuH,KAAM,WACL,OAAOhZ,KAAKyR,MAAQ5W,KAAKke,eAM1BE,KAAM,SAAchW,GACnB,IAAI5H,EAASR,KAAKme,OAElB,OADAne,KAAKie,MAAM7V,GACJ5H,GAQR6d,YAAa,SAAqBjf,EAAG0X,GACpCA,EAAQA,GAAS,EAEjB,IADA,IAAIwH,EAAQ,EACH7d,EAAI,EAAGA,EAAIqW,EAAOrW,IAC1BT,KAAKie,QACL7e,EAAEM,KAAKM,MACPse,GAASte,KAAKme,OAEf,OAAOG,EAAQxH,KC5CbyH,UAAY3f,QAAQ2f,UAAYjb,SAKnCxB,YAAa,SAAmBqB,QACX,IAATA,IACVnD,KAAKmD,KAAuB,iBAATA,EAA+B,OAATA,EAAgBA,EAAO,GAAMA,EAAK,IAE5EnD,KAAKie,SAKNA,MAAO,WAQN,OAPAje,KAAKwe,UAAY,EACjBxe,KAAKye,QAAU,EACfze,KAAK0e,WAAa,EAClB1e,KAAK2e,QAAUxR,EAAAA,EACfnN,KAAK4e,SAAWzR,EAAAA,EAChBnN,KAAK6e,iBAAcrb,EACnBxD,KAAK8e,iBAActb,EACZxD,MAOR+e,QAAS,SAAiB5b,GACzB,QAAoB,IAATA,EACV,OAAO,EAIR,GAHoB,OAATA,IACVA,EAAO,SAEiB,IAAdnD,KAAKmD,KACf,OAAO,EACD,GAAyB,iBAAdnD,KAAKmD,KAAmB,CACzC,IAAI1C,EACJ,GAAoB,iBAAT0C,EAAmB,CAC7B,GAAI5D,MAAMmL,QAAQ1K,KAAKmD,OAAS5D,MAAMmL,QAAQvH,IAC7C,IAAK1C,KAAK0C,EACT,GAAInD,KAAKmD,KAAKV,QAAQU,EAAK1C,IAAM,EAChC,OAAO,OAIT,IAAKA,KAAK0C,EACT,QAA4B,IAAjBnD,KAAKmD,KAAK1C,IAAsB0C,EAAK1C,KAAOT,KAAKmD,KAAK1C,GAChE,OAAO,EAIV,OAAO,EAEP,OAAO,EAGR,MAAuB,iBAAT0C,GAAqBnD,KAAKmD,OAASA,EAAK,IAQxD6I,MAAO,WACN,OAAOhM,KAAKwe,WAKbjP,IAAK,WACJ,OAAOvP,KAAKye,SAKbO,UAAW,WACV,OAAOhf,KAAK0e,YAKbhV,QAAS,WACR,OAAO1J,KAAK2e,SAKbhV,QAAS,WACR,OAAO3J,KAAK4e,SAMbK,QAAS,WACR,OAAOjf,KAAK6e,aAMbK,QAAS,WACR,OAAOlf,KAAK8e,aAKbK,QAAS,WACR,IAAInT,EAAQhM,KAAKgM,QACjB,OAAOA,EAAQ,EAAIhM,KAAKuP,MAAQvD,EAAQ,GAOzCrE,SAAU,SAAkByX,EAAQC,GAC/B3Y,MAAM2Y,KACTA,EAASrf,KAAKmf,WAEf,IAAInT,EAAQhM,KAAKgM,QAChBK,EAAIL,EAAQ,EAAIqT,EAASA,GAAUrf,KAAKgf,YAAc,EAAIK,EAASrf,KAAKuP,OAASvD,EAAQ,EAC1F,OAAOoT,GAAUpT,EAAQ,EAAIK,EAAIA,EAAIL,GAASA,EAAQ,IAMvDpE,kBAAmB,SAA2BwX,EAAQC,GACrD,OAAOnY,KAAKW,KAAK7H,KAAK2H,SAAS0X,GAASD,IAQzC9a,IAAK,SAAajC,EAAOkX,GAiBxB,YAhBc/V,IAAVnB,EACHA,EAAQ,EACEqE,MAAMrE,IAChBhD,MAAK,2BAA6BgD,EAAO,qBAE1CrC,KAAKwe,WAAa,EAClBxe,KAAKye,SAAWpc,EAChBrC,KAAK0e,YAAcrc,EAAQA,EACvBrC,KAAK2e,QAAUtc,IAClBrC,KAAK2e,QAAUtc,EACfrC,KAAK6e,YAActF,GAEhBvZ,KAAK4e,QAAUvc,IAClBrC,KAAK4e,QAAUvc,EACfrC,KAAK8e,YAAcvF,GAEbvZ,MAKRsf,OAAQ,SAAgB1U,EAAQ2O,GAC/B,IAAK,IAAI9Y,EAAI,EAAGA,EAAImK,EAAOlK,OAAQD,IAClCT,KAAKsE,IAAIsG,EAAOnK,GAAI8Y,GAErB,OAAOvZ,MAORuf,KAAM,SAAcld,EAAOmd,EAAQjG,GAKlC,OAJAiG,EAAS9Y,MAAM8Y,GAAUxf,KAAKyf,qBAAuBD,EACrDxf,KAAKwe,WAAagB,EAClBxf,KAAKye,SAAWe,EAChBxf,KAAK0e,YAAcc,EACZxf,KAAKsE,IAAIjC,EAAOkX,IAKxBkG,oBAAqB,IAKrBC,QAAS,SAAiB9U,EAAQ4U,EAAQjG,GACzC,IAAK,IAAI9Y,EAAI,EAAGA,EAAImK,EAAOlK,OAAQD,IAClCT,KAAKuf,KAAK3U,EAAOnK,GAAI+e,EAAQjG,GAE9B,OAAOvZ,MAKR2f,aAAc,SAAsBC,GAYnC,OAXA5f,KAAKwe,WAAaoB,EAAKpB,UACvBxe,KAAKye,SAAWmB,EAAKnB,QACrBze,KAAK0e,YAAckB,EAAKlB,WACpBkB,EAAKjB,QAAU3e,KAAK2e,UACvB3e,KAAK2e,QAAUiB,EAAKjB,QACpB3e,KAAK8e,YAAcc,EAAKd,aAErBc,EAAKhB,QAAU5e,KAAK4e,UACvB5e,KAAK4e,QAAUgB,EAAKhB,QACpB5e,KAAK8e,YAAcc,EAAKd,aAElB9e,MAOR6f,UAAW,SAAmBC,GAE7B,OADkB9f,KAAK+f,kBAAoB/f,KAAK+f,gBAAkB,IAAI/B,cACnDC,MAAM6B,IAK1BE,QAAS,SAAiBzG,GAEzB,OADA1Z,SAASG,KAAK+f,gBAAiB,iDACxB/f,KAAKsE,IAAItE,KAAK+f,gBAAgB5B,OAAQ5E,IAM9C0G,QAAS,SAAiB1G,GAEzB,OADA1Z,SAASG,KAAK+f,gBAAiB,iDACxB/f,KAAKsE,IAAItE,KAAK+f,gBAAgB3B,OAAQ7E,IAQ9C2G,gBAAiB,SAAgBxY,EAAMC,EAAUwY,EAAaC,GAC7D,IAAI1R,KACHxG,EAAIwG,EAAExG,GAAKkY,EAAa1Y,GAAQR,KAAKW,KAAKF,EAAWwY,GACrDxR,EAAI7H,KAAKwB,UAAUJ,GAIpB,OAHAwG,EAAE2R,WAAgBnY,EAAI,EAAIyG,EAAI,EAC9BD,EAAE4R,cAAgBpY,EAAI,EAAI,EAAIyG,EAAI,EAClCD,EAAE6R,WAAsB,IAANrY,EAAU,EAAIhB,KAAKD,IAAIyH,EAAE2R,WAAY3R,EAAE4R,eAAiB,EACnE5R,GAMR8R,OAAQ,SAAgB9Y,EAAMC,GAE7B,OADAA,EAAWjB,MAAMiB,GAAY3H,KAAK2H,YAAcA,EACzC4W,UAAUiC,OAAO9Y,EAAMC,EAAU3H,KAAKgM,QAAShM,KAAKmf,YAO5DsB,iBAAkB,SAAiB/Y,EAAMyY,EAAaC,EAAYM,GACjE,OACCtY,GAAIgY,EAAa1Y,GAAQgZ,EAA0BxZ,KAAKW,KAAKsY,KAO/DQ,QAAS,SAAiBjZ,EAAMyY,EAAaC,EAAYM,GACxD,OAAOnC,UAAUoC,QAChBja,MAAMgB,GAAQ,GAAOA,EACrBhB,MAAMyZ,GAAengB,KAAKgM,SAAWmU,EACrCzZ,MAAM0Z,GAAcpgB,KAAKmf,WAAaiB,EACtC1Z,MAAMga,GAA2B1gB,KAAK4H,qBAAuB8Y,IAQ/DE,iBAAkB,SAAiBC,EAAcC,EAC/CC,EAAaC,EAAaC,EAAiBC,GAC5C,IAAIC,IAAoBN,EAAe,GAAKI,GAAmBH,EAAe,GAAKI,IACjFL,EAAeC,EAAe,GAChC,OACC1Y,GAAI2Y,EAAcC,GAAe9Z,KAAKW,KAAKsZ,GAAkB,EAAIN,EAAe,EAAIC,MAOtFM,QAAS,SAAiBC,GACzB,OAAO9C,UAAU6C,QAChBphB,KAAKgM,QAASqV,EAAMrV,QACpBhM,KAAKmf,UAAWkC,EAAMlC,UACtBnf,KAAK2H,WAAY0Z,EAAM1Z,aASzBpD,SAAU,SAAkBqL,GAM3B,OALAA,EAAM,IAAKA,GAAO,OACc,iBAAd5P,KAAKmD,KAAoBnD,KAAKmD,KAAO,GACtDoO,SAASvR,KAAKmD,MAAMC,IAAI,SAAUke,GACjC,OAAOA,EAAG,GAAG,IAAMA,EAAG,KACpB1hB,KAAI,MACMI,KAAKgM,QAAShM,KAAK0J,UAAW1J,KAAKmf,UAChDnf,KAAK2J,UAAW3J,KAAK4H,qBAAqBhI,KAAKgQ,IAMjDmN,qBACCC,WAAY,YACZC,WAAY,SAA6B1c,GACxC,IAAIC,GAAUD,EAAI4C,MAAQ,KAAM5C,EAAIie,UAAWje,EAAIke,QAASle,EAAIme,WAAYne,EAAIoe,QAASpe,EAAIqe,SAC7F,YAA+B,IAApBre,EAAIse,YACPre,EAAOe,QAAQhB,EAAIse,YAAate,EAAIue,cAEpCte,GAGT0c,aAAc,SAA+B3c,EAAKY,GACjD,IAAKA,EACJ,OAAO,KAER,IAAIye,EAAOze,EAAK,GAAK,IAAIod,UAAUpd,EAAK,IAAM,IAAIod,UAUlD,OATAqB,EAAKpB,WAAard,EAAK,GACvBye,EAAKnB,SAAWtd,EAAK,GACrBye,EAAKlB,YAAcvd,EAAK,GACxBye,EAAKjB,SAAWxd,EAAK,GACrBye,EAAKhB,SAAWzd,EAAK,GACjBye,EAAKpB,UAAY,IACpBoB,EAAKf,YAAc1d,EAAK,GACxBye,EAAKd,YAAc3d,EAAK,IAElBye,MC3VN2B,WAAa3iB,QAAQ2iB,WAAaje,SAGrCxB,YAAa,WACZ9B,KAAKwhB,cAMNC,OAAQ,SAAgBte,GACvB,MAAoB,iBAATA,GAA8B,OAATA,EAC3B5D,MAAMmL,QAAQvH,GACViQ,KAAKC,UAAUlQ,EAAK1D,QAAQoP,QAE5B9M,OAAOoB,KAAKA,GAAM0L,OAAOzL,IAAI,SAAU1B,GAC7C,OAAO0R,KAAKC,UAAU3R,GAAG,IAAM0R,KAAKC,UAAUlQ,EAAKzB,MACjD9B,KAAI,KAGDwT,KAAKC,UAAUlQ,GAAI,IAM5Bue,MAAO,SAAeve,GACrB,OAAOoO,SAASvR,KAAKwhB,WAAWpe,IAAI,SAAUue,GAC7C,OAAOA,EAAO,IACZ,SAAU/B,GACZ,OAAOA,EAAKb,QAAQ5b,KAClB0M,WAKJ+P,KAAM,SAAczc,GACnB,IAAIE,EAAKrD,KAAKyhB,OAAOte,GACrB,OAAOnD,KAAKwhB,UAAUne,KAAQrD,KAAKwhB,UAAUne,GAAM,IAAIkb,UAAUpb,KAMlEye,UAAW,SAAmBrhB,EAAKgZ,GAElC,IAAK,IAAI3V,KADT/D,SAASU,EAAK,qBAAsB6S,KAAKC,UAAU9S,GAAK,KACvCA,EACZhB,MAAMmL,QAAQnK,EAAIqD,IACrB5D,KAAKsf,OAAO1b,EAAMrD,EAAIqD,GAAO2V,GAE7BvZ,KAAKsE,IAAIV,EAAMrD,EAAIqD,GAAO2V,GAG5B,OAAOvZ,MAOR2f,aAAc,SAAsBC,EAAMzc,GACzC,OAAOnD,KAAK4f,UAAqB,IAATzc,EAAuBA,EAAOyc,EAAKzc,MAAMwc,aAAaC,IAM/EiC,cAAe,SAAuBH,EAAOve,GAC5C,IAAIiP,EAAOpS,KAIX,OAHA0hB,EAAMA,MAAMve,GAAMT,QAAQ,SAAUkd,GACnCxN,EAAKwN,KAAKA,EAAKzc,MAAMwc,aAAaC,KAE5B5f,MAORie,MAAO,SAAe9a,GAIrB,OAHAnD,KAAK0hB,MAAMve,GAAMT,QAAQ,SAAUkd,GAClCA,EAAK3B,UAECje,MAKRsE,IAAK,SAAanB,EAAMd,EAAOkX,GAC9B,OAAOvZ,KAAK4f,KAAKzc,GAAMmB,IAAIjC,EAAOkX,IAKnCgG,KAAM,SAAcpc,EAAMd,EAAOmd,EAAQjG,GACxC,OAAOvZ,KAAK4f,KAAKzc,GAAMoc,KAAKld,EAAOmd,EAAQjG,IAK5C+F,OAAQ,SAAgBnc,EAAMyH,EAAQ2O,GACrC,OAAOvZ,KAAK4f,KAAKzc,GAAMmc,OAAO1U,EAAQ2O,IAKvCmG,QAAS,SAAiBvc,EAAMyH,EAAQ4U,EAAQjG,GAC/C,OAAOvZ,KAAK4f,KAAKzc,GAAMmc,OAAO1U,EAAQ2O,IAKvCsG,UAAW,SAAmB1c,EAAM2c,GACnC,OAAO9f,KAAK4f,KAAKzc,GAAM0c,UAAUC,IAMlCE,QAAS,SAAiB7c,EAAMoW,GAC/B,OAAOvZ,KAAK4f,KAAKzc,GAAM6c,QAAQzG,IAMhC0G,QAAS,SAAiB9c,EAAMoW,GAC/B,OAAOvZ,KAAK4f,KAAKzc,GAAM8c,QAAQ1G,IAQhCuI,aAAc,SAAsB3e,GACnC,IAAI4e,EAAM,IAAIxD,UAAUpb,GAIxB,OAHAnD,KAAK0hB,MAAMve,GAAMT,QAAQ,SAAUkd,GAClCmC,EAAIpC,aAAaC,KAEXmC,GAKR/V,MAAO,SAAe7I,GACrB,OAAOnD,KAAK8hB,aAAa3e,GAAM6I,SAKhCuD,IAAK,SAAapM,GACjB,OAAOnD,KAAK8hB,aAAa3e,GAAMoM,OAMhCyP,UAAW,SAAmB7b,GAC7B,OAAOnD,KAAK8hB,aAAa3e,GAAM6b,aAKhCtV,QAAS,SAAiBvG,GACzB,OAAOnD,KAAK8hB,aAAa3e,GAAMuG,WAKhCC,QAAS,SAAiBxG,GACzB,OAAOnD,KAAK8hB,aAAa3e,GAAMwG,WAKhCwV,QAAS,SAAiBhc,GACzB,OAAOnD,KAAK8hB,aAAa3e,GAAMgc,WAMhCxX,SAAU,SAAkBxE,EAAMkc,GACjC,OAAOrf,KAAK8hB,aAAa3e,GAAMwE,SAAS0X,IAMzCzX,kBAAmB,SAA2BzE,EAAMkc,GACnD,OAAOrf,KAAK8hB,aAAa3e,GAAMyE,kBAAkByX,IAQlD9a,SAAU,SAAkByd,EAAMC,GACjCD,EAAO,IAAKA,GAAQ,MACpBC,EAAO,IAAKA,GAAQ,MACpB,IAAIP,EAAQ1hB,KAAKwhB,UACjB,OAAOzf,OAAOoB,KAAKue,GAAOte,IAAI,SAAUQ,GACvC,OAAO8d,EAAM9d,GAAMW,SAASyd,KAC1BpiB,KAAKqiB,IAMTlF,qBACCC,WAAY,aACZC,WAAY,SAA8B1c,GACzC,IAAImhB,EAAQnhB,EAAIihB,UAChB,OAAOzf,OAAOoB,KAAKue,GAAOte,IAAI,SAAUvC,GACvC,OAAO6gB,EAAM7gB,MAGfqc,aAAc,SAAgC3c,EAAKY,GAClD,IAAKA,EACJ,OAAO,KAER,IAAIX,EAAS,IAAI+gB,WAIjB,OAHApgB,EAAKuB,QAAQ,SAAUkd,GACtBpf,EAAOmf,aAAaC,KAEdpf,MClON0hB,OAAStjB,QAAQsjB,OAAS5e,SAM7BxB,YAAa,SAASogB,EAAOte,EAAM/B,EAAQsgB,GAC1CniB,KAAK4D,KAAO,GAAIA,EAChB5D,KAAK6B,OAASA,GAAUqgB,EAAOE,KAC/BpiB,KAAKmiB,MAAQA,GAAS,OACtBniB,KAAKqiB,cAONzH,IAAK,SAAauH,GACjB,IAAIG,EAAStiB,KAAKuiB,OAAOviB,KAAKmiB,QAAUniB,KAAKuiB,OAAOJ,GACpD,GAAIG,EAAQ,CACX,IAAIE,EAASxiB,KACZyiB,EAAUljB,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,IACxDI,KAAKqiB,UAAU3f,QAAQ,SAAUggB,GAEhCA,GADaA,EAASzd,QAAUud,EAAOG,eACvBH,EAAO5e,KAAM,IAAIuB,KAAQgd,EAAOM,MAE7CziB,KAAK6B,QACR7B,KAAK6B,OAAO+Y,IAAI7a,MAAMC,KAAK6B,OAAQlC,WAGrC,OAAO2iB,GAORC,QACCK,OAAQzV,EAAAA,EAAU0V,OAAQ,EAAGC,KAAM,EAAGC,KAAM,EAAGC,MAAO,EAAGC,MAAO9V,EAAAA,EAChE+V,GAAI,EAAGC,KAAM,EAAGC,KAAM,EAAGC,MAAO,GAKjCC,MAAO,WACN,OAAOtjB,KAAK4a,IAAG,QAAUrb,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAKvE2jB,MAAO,WACN,OAAOvjB,KAAK4a,IAAG,QAAUrb,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAKvE4jB,KAAM,WACL,OAAOxjB,KAAK4a,IAAG,OAASrb,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAKtE6jB,KAAM,WACL,OAAOzjB,KAAK4a,IAAG,OAASrb,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAKtE4V,MAAO,WACN,OAAOxV,KAAK4a,IAAG,QAAUrb,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAKvE8jB,MAAO,WACN,OAAO1jB,KAAK4a,IAAG,QAAUrb,MAAMC,UAAUC,MAAMC,KAAKC,UAAW,GAAGC,KAAI,MAYvE+iB,cAAe,SAAuB/e,EAAMua,EAAMgE,EAAOM,GACxD,OAAQN,EAAOve,EAAMO,KAAKY,WAAWoZ,EAAM,cAAesE,GAAS7iB,KAAI,MAMxE+jB,WAAY,SAAoBC,EAAKC,GAGpC,OAFAD,EAAMA,GAAO,IACbC,EAAiBA,GAAkB,OAC5B,SAAUjgB,EAAMua,EAAMgE,EAAOM,GACnC,OAAO,IAAMmB,EAAK,WAAYC,EAAgB1B,EAAO,KACpD,gBAAiB0B,EAAgB,UAAW1B,EAAO,WACnD,gBAAiB0B,EAAgB,SAAUjgB,EAAM,WACjD,gBAAiBigB,EAAgB,SAAU1f,KAAKY,WAAWoZ,EAAM,cAAe,WAChF,gBAAiB0F,EAAgB,YAChC1f,KAAKK,UAAUie,GAAS/d,QAAO,MAAQ,SAASA,QAAO,MAAQ,sBAChE,UACA,KAAMkf,EAAK,KAAKhkB,KAAI,MAavBkkB,gBAAiB,WAChB,SAASC,EAAoBC,GAC5BrJ,QAAQC,IAAIoJ,GAEb,OAAO,WAEN,OADAhkB,KAAKqiB,UAAUpU,KAAK8V,GACbA,GANQ,GAcjBE,aAAc,SAAsBC,EAAUC,EAAOC,GACpDF,EAAWA,GAAY,SAAS,IAAK/e,MAAQF,OAAM,mBAAoB,OACvEkf,OAAkB3gB,IAAV2gB,EAAsBA,EAAQ,IACtCC,OAAwB5gB,IAAb4gB,EAAyBA,EAAW,QAC/C,IAAIC,EAASjN,QAAO,MAAOkN,kBAAkBJ,GAAWC,MAAOA,EAAOC,SAAUA,IAChF,SAASG,EAAaP,GACrBK,EAAOG,MAAMR,EAAM,MAGpB,OADAhkB,KAAKqiB,UAAUpU,KAAKsW,GACbA,GAURE,aAAc,SAAsBC,EAAaC,EAAYC,GAC5DD,GAAeA,GAAexX,EAAAA,EAC9ByX,IAAaA,EAEZF,EAD0B,iBAAhBA,EACKG,SAASC,eAAeJ,GAEzBA,GAAeG,SAASE,qBAAoB,QAAS,GAEpE,IAAIC,KACJ,SAASC,EAAajB,GACrB,GAAIY,EAEH,IADAI,EAAQlT,QAAQkS,GACTgB,EAAQtkB,OAASikB,GACvBK,EAAQxiB,WAIT,IADAwiB,EAAQ/W,KAAK+V,GACNgB,EAAQtkB,OAASikB,GACvBK,EAAQzhB,QAGVmhB,EAAYQ,UAAYF,EAAQplB,KAAI,MAGrC,OADAI,KAAKqiB,UAAUpU,KAAKgX,GACbA,GAORE,uBAAwB,SAAgCC,GAEvD,SAASC,EAAoBrB,GAC5B,IAAIvB,KACJA,EAAQ2C,GAAcpB,EACtB5R,KAAKoH,YAAYpG,KAAKC,UAAUoP,IAMjC,OAVA2C,EAAa,IAAKA,GAAc,OAMhCC,EAAoBpgB,OAAS,SAAgBrB,EAAMua,EAAMgE,EAAOM,GAC/D,OAAQ7e,KAAMA,EAAMua,KAAMA,EAAMgE,MAAOA,EAAOM,QAASA,IAExDziB,KAAKqiB,UAAUpU,KAAKoX,GACbA,GAQR3D,MAAO,WACN,OAAO1hB,KAAKwhB,YAAcxhB,KAAKwhB,UAAY,IAAID,eCxMhD,OD+MDW,OAAOE,KAAO,IAAIF,OAAM,KCrNrB3T,WAAYA,WAAW4O,mBAAoB5O,WAAWoP,gBACvDY,UAAWgD,YACV7e,QAAQ,SAAUiX,GACnBA,EAAK3a,WAAWge,WAAape,QAAQC,YAAY,IAAM8a,EAAK3a,WAAWge,WACvEpe,QAAQI,WAAWC,QAAQgP,KAAK0L,KAE1B/a","file":"creatartis-base.min.js","sourcesContent":["/** Package wrapper and layout.\n*/\nfunction __init__(Sermat) { \"use strict\";\n// Library layout. /////////////////////////////////////////////////////////////////////////////////\n\tvar exports = {\n\t\t__package__: 'creatartis-base',\n\t\t__name__: 'base',\n\t\t__init__: __init__,\n\t\t__dependencies__: [Sermat],\n\t\t__SERMAT__: { include: [] }\n\t};\n","/** # Core\n\nGeneric algorithms and utility definitions.\n*/\n\n/** Depending on the execution environment the global scope may be different: `window` in browsers,\n`global` under NodeJS, `self` in web workers, etc. `global` holds a reference to this \nobject.\n*/\nvar global = exports.global = (function () {\n\tvar f = Function;\n\treturn f('return this;')();\n})();\n\n/** `raise(message...)` builds a new instance of Error with the concatenation of the arguments as \nits message and throws it.\n*/\nvar raise = exports.raise = function raise() {\n\tthrow new Error(Array.prototype.slice.call(arguments, 0).join(''));\n};\n\n/** `raiseIf(condition, message...)` does the same as `raise` if `condition` is true.\n*/\nvar raiseIf = exports.raiseIf = function raiseIf(condition) {\n\tif (condition) {\n\t\traise.apply(this, Array.prototype.slice.call(arguments, 1));\n\t}\n};\n\n/** Browsers and different environments have different ways to obtain the current call stack. \n`callStack(error=none)` unifies these. Returns an array with the callstack of error or (if missing)\na new one is used, hence returning the current callStack.\n*/\nvar callStack = exports.callStack = function callStack(exception) {\n\tif (exception) {\n\t\treturn (exception.stack || exception.stacktrace || '').split('\\n');\n\t} else try {\n\t\tthrow new Error();\n\t} catch (e) {\n\t\texception = e;\n\t}\n\treturn (exception.stack || exception.stacktrace || '').split('\\n').slice(1);\n};\n\n/** Javascript object literals (as of ES5) cannot be built with expressions as keys. \n`obj(key, value...)` is an object constructor based on key-value pairs.\n*/\nvar obj = exports.obj = function obj() {\n\tvar result = ({});\n\tfor (var i = 0; i < arguments.length; i += 2) {\n\t\tresult[arguments[i] +''] = arguments[i+1];\n\t}\n\treturn result;\n};\n\n/** `copy(objTo, objFrom...)` copies all own properties of the given objects missing in `objTo` to \nit, and returns `objTo`. If only one object is given, a copy of the `objTo` object is returned.\n*/\nvar copy = exports.copy = function copy(objTo) {\n\tvar i = 1, k, objFrom;\n\tif (arguments.length < 2) {\n\t\tobjTo = {};\n\t\ti = 0;\n\t}\n\tfor (; i < arguments.length; i++) {\n\t\tobjFrom = arguments[i];\n\t\tfor (k in objFrom) {\n\t\t\tif (objFrom.hasOwnProperty(k) && !objTo.hasOwnProperty(k)) {\n\t\t\t\tobjTo[k] = objFrom[k];\n\t\t\t}\n\t\t}\n\t}\n\treturn objTo;\n};","/** # Polyfill\n\nThis part of the library contains all code meant to equalize Javascript \nexecution environments, to provide some sort of forward compatibility.\n*/ \n\n/** Some versions of Opera and Internet Explorer do not support \n[Function.bind](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n*/\nif (!Function.prototype.bind) {\n\tFunction.prototype.bind = function bind(_this) {\n\t\tif (typeof this !== \"function\") {\n\t\t\tthrow new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n\t\t}\n\t\tif (arguments.length < 1) {\n\t\t\treturn this;\n\t\t}\n\t\tvar args = Array.prototype.slice.call(arguments, 1), \n\t\t\tfToBind = this,\n\t\t\tF_NOP = function () {},\n\t\t\tfBound = function () {\n\t\t\t\treturn fToBind.apply(_this, args.concat(Array.prototype.slice.call(arguments)));\n\t\t\t};\n\t\tF_NOP.prototype = this.prototype;\n\t\tfBound.prototype = new F_NOP();\n\t\treturn fBound;\n\t};\n}\n\n/** [String.repeat](http://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/repeat)\nconcatenates a string a given amount of times.\n*/\nif (!String.prototype.repeat) {\n\tString.prototype.repeat = function repeat(n) {\n\t\tn = n | 0;\n\t\treturn n <= 0 ? \"\" : n & 1 ? this + this.repeat(n - 1) : (this + this).repeat(n >> 1);\n\t};\n}\n","/** # Objects\n\nOOP related functions and definitions.\n*/\nvar objects = exports.objects = (function () {\n\t/** Extending a constructor implies assigning as the subconstructor prototype an instance of the\n\tparent constructor. If no constructor is given, a new one is used.\n\t*/\n\tvar subconstructor = this.subconstructor = function subconstructor(parent, constructor) {\n\t\tvar proto, Placeholder;\n\t\tif (typeof constructor !== 'function') { // If no constructor is given ...\n\t\t\tconstructor = (function () { // ... provide a default constructor.\n\t\t\t\tparent.apply(this, arguments);\n\t\t\t});\n\t\t}\n\t\tconstructor.prototype = Object.create(parent.prototype);\n\t\tconstructor.prototype.constructor = constructor;\n\t\t/** The constructor function's prototype is changed so static properties are inherited as\n\t\twell.\n\t\t*/\n\t\tif (Object.setPrototypeOf) {\n\t\t\tObject.setPrototypeOf(constructor, parent);\n\t\t} else {\n\t\t\tconstructor.__proto__ = parent;\n\t\t}\n\t\treturn constructor;\n\t};\n\n\t/** `objects.addMember(constructor, key, value, force=false)` adds `value` as a member of the\n\tconstructor's prototype. If it already has a member with the `key`, it is overriden only if\n\t`force` is true.\n\n\tThe `key` may include modifiers for the member before the actual name and separated by\n\twhitespace. The implemented modifiers are:\n\n\t+ `static`: Adds the member to the constructor.\n\t+ `property`: Treats the `value` as a property descriptor to use with `Object.defineProperty()`.\n\t+ `const`: Adds the member as readonly. This also uses `Object.defineProperty()`, with a setter\n\tthat throws an error.\n\t*/\n\tvar addMember = this.addMember = function addMember(constructor, key, value, force) {\n\t\tvar modifiers = key.split(/\\s+/), scopes;\n\t\tkey = modifiers.pop();\n\t\tif (modifiers.indexOf('dual') >= 0) {\n\t\t\tscopes = [constructor, constructor.prototype];\n\t\t} else if (modifiers.indexOf('static') >= 0) {\n\t\t\tscopes = [constructor];\n\t\t} else {\n\t\t\tscopes = [constructor.prototype];\n\t\t}\n\t\tscopes.forEach(function (scope) {\n\t\t\tif (force || typeof scope[key] === 'undefined') {\n\t\t\t\tif (modifiers.indexOf('property') >= 0) {\n\t\t\t\t\treturn Object.defineProperty(scope, key, value);\n\t\t\t\t} else if (modifiers.indexOf('const') >= 0) {\n\t\t\t\t\treturn Object.defineProperty(scope, key, {\n\t\t\t\t\t\tget: function () { return value; },\n\t\t\t\t\t\tset: function () { throw new Error(key +\" is readonly!\"); },\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\tconfigurable: false\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn scope[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t/** `objects.addMembers(constructor, members, force=false)` adds all own properties of members\n\tto the constructor's prototype, using `objects.addMember`.\n\t*/\n\tvar addMembers = this.addMembers = function addMembers(constructor, members, force) {\n\t\tObject.keys(members).map(function (id) {\n\t\t\taddMember(constructor, id, members[id], force);\n\t\t});\n\t};\n\n\t/** The function `objects.declare(supers..., members={})` implements creatartis-base's object\n\toriented implementation, influenced by\n\t[Dojo's](http://dojotoolkit.org/reference-guide/1.9/dojo/_base/declare.html). The first super is\n\tconsidered the parent. The following supers add to the returned constructor's prototype, but do\n\tnot override. The given members always override.\n\t*/\n\tvar declare = exports.declare = this.declare = function declare() {\n\t\tvar args = Array.prototype.slice.call(arguments),\n\t\t\tparent = args.length > 1 ? args.shift() : Object,\n\t\t\tmembers = args.length > 0 ? args.pop() : {},\n\t\t\tconstructor = subconstructor(parent, members.hasOwnProperty('constructor') ? members.constructor : undefined), //WARN ({}).constructor == Object.\n\t\t\tinitializer = members[''];\n\t\tObject.keys(members).map(function (id) {\n\t\t\tif (id !== '' && id !== 'constructor') {\n\t\t\t\taddMember(constructor, id, members[id], true);\n\t\t\t}\n\t\t});\n\t\targs.forEach(function (members) {\n\t\t\tif (typeof members === 'function') {\n\t\t\t\tmembers = members.prototype;\n\t\t\t}\n\t\t\taddMembers(constructor, members, false);\n\t\t});\n\t\tif (typeof initializer === 'function') {\n\t\t\tinitializer.apply(constructor);\n\t\t}\n\t\treturn constructor;\n\t};\n\n\t/** Abstract methods can be quickly defined with `objects.unimplemented(cls, id)`. It returns a\n\tfunction that raises an \"unimplemented method\" exception. This is recommended, for better\n\tdebugging.\n\t*/\n\tvar unimplemented = this.unimplemented = function unimplemented(cls, id) {\n\t\treturn function () {\n\t\t\tthrow new Error((cls || this.constructor.name) +\".\"+ id +\" not implemented! Please override.\");\n\t\t};\n\t};\n\n\treturn this;\n}).call({}); //// objects.\n\nvar declare = objects.declare;\n","/** # Text\n\nText manipulation functions and definitions.\n*/\nvar XML_ENTITIES = { \n\t\t'<': '&lt;', \n\t\t'>': '&gt;', \n\t\t'&': '&amp;', \n\t\t'\"': '&quot;', \n\t\t\"'\": '&apos;' \n\t},\n\tText = exports.Text = declare({\n\t/** Text is similar to Java's [`StringBuilder`](http://docs.oracle.com/javase/7/docs/api/java/lang/StringBuilder.html), \n\tbut with extended formatting features.\n\t*/\n\tconstructor: function Text() {\n\t\tthis.clear();\n\t},\n\t\n\t/** `clear()` empties the text buffer, but returns the previous content.\n\t*/\n\tclear: function clear() {\n\t\tvar text = this.text;\n\t\tthis.text = '';\n\t\treturn text;\n\t},\n\t\n\t/** `add(...strings)` concatenates all arguments conversions to string to the buffer.\n\t*/\n\tadd: function add() {\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tthis.text += arguments[i];\n\t\t}\n\t},\n\t\n\t/** The default conversion to string returns the content of the buffer.\n\t*/\n\ttoString: function toString() {\n\t\treturn this.text;\n\t},\n\t\n\t// ## Formatting, encoding and decoding ########################################################\n\t\n\t// ### XML (and HTML for most intends and purposes) ############################################\n\t\n\t/** `escapeXML(str)` returns the string with XML reserved characters replaced by the \n\tcorresponding character entities.\n\t*/\n\tescapeXML: function escapeXML(str) {\n\t\tvar XML_ENTITIES = this.XML_ENTITIES;\n\t\treturn (str +'').replace(/[&<>\"']/g, function (c) {\n\t\t\treturn XML_ENTITIES[c];\n\t\t});\n\t},\n\t\n\t/** The XML character entities are defined in `XML_ENTITIES`:\n\t*/\n\tXML_ENTITIES: XML_ENTITIES,\n\t'static XML_ENTITIES': XML_ENTITIES,\n\n\t/** `addXML(...str)` appends all arguments string conversions after applying `escapeXML()`.\n\t*/\n\taddXML: function addXML() {\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tthis.text += this.escapeXML(arguments[i]);\n\t\t}\n\t},\n\t\n\t// ### Regular expressions #####################################################################\n\t\n\t/** `escapeRegExp(str)` returns the `str` string with the reserved characters of regular \n\texpressions escaped with `'\\'`.\n\t*/\n\tescapeRegExp: function escapeRegExp(str) {\n\t\treturn (str +'').replace(/[\\-\\[\\]{}()*+?.^$\\\\]/g, '\\\\$&');\n\t},\n\t\n\t// ### Dates ###################################################################################\n\t\n\t/** `formatDate(date=now, format=Date.toString, useUTC=false)` formats a Date. The `format` \n\tstring  may use `y` for year, `m` for month, `d` for day (in month), `h` for hour (24), `H` for\n\thour (am/pm), `n` for minutes, `s` for seconds, `S` for milliseconds, and `a` or `A` for am/pm.\n\t*/\n\tformatDate: function formatDate(date, format, useUTC) {\n\t\tdate = date || new Date();\n\t\tvar lpad = Text.lpad;\n\t\treturn !format ? date.toString() : format.replace(/(y+|m+|d+|h+|H+|n+|s+|S+|a+|A+|\"[^\"]*\")/g, \n\t\t\tfunction (match) {\n\t\t\t\tswitch (match.charAt(0)) {\n\t\t\t\tcase 'y': return lpad((useUTC ? date.getUTCFullYear() : date.getFullYear()) +'', match.length, '0');\n\t\t\t\tcase 'm': return lpad(((useUTC ? date.getUTCMonth() : date.getMonth()) + 1) +'', match.length, '0');\n\t\t\t\tcase 'd': return lpad((useUTC ? date.getUTCDate() : date.getDate()) +'', match.length, '0');\n\t\t\t\tcase 'h': return lpad((useUTC ? date.getUTCHours() : date.getHours()) +'', match.length, '0');\n\t\t\t\tcase 'H': return lpad((useUTC ? date.getUTCHours() : date.getHours()) % 12 +'', match.length, '0');\n\t\t\t\tcase 'n': return lpad((useUTC ? date.getUTCMinutes() : date.getMinutes()) +'', match.length, '0');\n\t\t\t\tcase 's': return lpad((useUTC ? date.getUTCSeconds() : date.getSeconds()) +'', match.length, '0');\n\t\t\t\tcase 'S': return lpad((useUTC ? date.getUTCMilliseconds() : date.getMilliseconds()) +'', match.length, '0');\n\t\t\t\tcase 'a': return ['am','pm'][~~((useUTC ? date.getUTCHours() : date.getHours()) / 12)].substr(0, match.length);\n\t\t\t\tcase 'A': return ['AM','PM'][~~((useUTC ? date.getUTCHours() : date.getHours()) / 12)].substr(0, match.length);\n\t\t\t\tcase '\"': return match.substr(1, match.length-2);\n\t\t\t\tdefault: return match;\n\t\t\t\t}\n\t\t\t});\n\t},\n\t\n\t/** `addDate(date=now, format=Date.toString, useUTC=false)` appends the `date` formatted using\n\t`formatDate()`.\n\t*/\n\taddDate: function addDate(date, format, useUTC) {\n\t\tthis.text += this.formatDate(date, format, useUTC);\n\t},\n\t\n\t// ## _Static_ members #########################################################################\n\t\n\t/** `lpad(str, len, pad=' ')` returns a copy of the `str` string padded with `pad` (or space by \n\tdefault) to the left upto `len` length.\n\t*/\n\t'static lpad': function lpad(str, len, pad) {\n\t\tif (isNaN(len) || str.length >= len) {\n\t\t\treturn str;\n\t\t} else {\n\t\t\tpad = (pad || ' ') +'';\n\t\t\treturn (pad.repeat((len - str.length) / pad.length + 1) + str).substr(-len);\n\t\t}\n\t},\n\n\t/** `rpad(str, len, pad=' ')` returns a copy of the `str` string padded with `pad` (or space by \n\tdefault) to the right upto `len` length.\n\t*/\n\t'static rpad': function rpad(str, len, pad) {\n\t\tif (isNaN(len) || str.length >= len) {\n\t\t\treturn str;\n\t\t} else {\n\t\t\tpad = (pad || ' ') +'';\n\t\t\treturn (str + pad.repeat((len - str.length) / pad.length + 1)).substr(0, len);\n\t\t}\n\t},\n\t\n\t/** `hashCode(str)` calculates a hash number for the given string.\n\t*/\n\t'static hashCode': function hashCode(str) {\n\t\tvar result = 0,\n\t\t\tlen = str.length;\n\t\tfor (var i = 0; i < len; ++i) { \n\t\t\tresult = (result * 31 + str.charCodeAt(i)) & 0x7FFFFFFF;\n\t\t}\n\t\treturn result;\n\t}\n}); // declare Text.\n\nText.escapeXML = Text.prototype.escapeXML;\nText.escapeRegExp = Text.prototype.escapeRegExp;\nText.formatDate = Text.prototype.formatDate;\n","/** # Math\n\nMathematical and numerical functions and utilities.\n*/\nvar math = exports.math = {};\n\n// ## Conditionals #################################################################################\n\n/** Clamps forces a `value` to be between `min` and `max`.\n*/\nmath.clamp = function clamp(value, min, max) {\n\treturn Math.min(max, Math.max(min, value));\n};\n\n/** A simple function to calculate the sign of a number. See [Math.sign](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign).\n*/\nmath.sign = function sign(x) {\n\tx = +x;\n\treturn (x === 0 || isNaN(x)) ? x : x > 0 ? 1 : -1;\n};\n\n// ## Combinatorics ################################################################################\n\n/** The `factorial` functions needs little introduction. It receives `n` and returns `n!`. Argument\n`b` can be used to stop the recursion before zero, which is useful to calculate `n!/b!` efficiently.\n*/\nvar factorial = math.factorial = function factorial(n, b) {\n\tn = n|0;\n\tb = Math.max(0, b|0);\n\tif (n < 0) {\n\t\treturn NaN;\n\t} else {\n\t\tfor (var f = 1; n > b; --n) {\n\t\t\tf *= n;\n\t\t}\n\t\treturn f;\n\t}\n};\n\n/** The `combinations` of selecting `k` elements from a set of `n`, not mattering in which order. It\nis calculated as `n!/k!/(n-k)!`.\n*/\nmath.combinations = function combinations(n, k) {\n\treturn factorial(n, k) / factorial(n - k);\n};\n\n// ## Probability ##################################################################################\n\n/** The probability density function (or PDF) of the normal (or gaussian) distribution. The \nparameters `mean` and `variance` default to the standard normal (i.e `mean=0` and `variance=1`).\n*/\nmath.gauss_pdf = function gauss_pdf(value, mean, variance) {\n\tmean = isNaN(mean) ? 0 : +mean;\n\tvariance = isNaN(variance) ? 1 : +variance;\n\tvar standardDeviation = Math.sqrt(variance);\n\n    return Math.exp(-Math.pow(x - mean, 2) / (2 * variance)) / \n\t\tstandardDeviation * Math.sqrt(2 * Math.PI);\n};\n\n/** Complementary error function routine based on Chebyshev fitting as explained in \n[Numerical Recipes in C (2nd edition)](http://www.nr.com/), with fractional error everywhere less \nthan 1.2e-7.\n*/\nmath.gauss_erfc = function gauss_erfc(value) {\n\tvar z = Math.abs(value),\n\t\tt = 1.0 / (1.0 + 0.5 * z),\n\t\tans = t * Math.exp(-z * z - 1.26551223 + t * (1.00002368 + t * (0.37409196 +\n\t\t\tt * (0.09678418 + t * (-0.18628806 + t * (0.27886807 + t * (-1.13520398 + \n\t\t\tt * (1.48851587 + t * (-0.82215223 + t * 0.17087277)))))))));\n    return value >= 0.0 ? ans : 2.0 - ans;\n};\n\n/** The cumulative density function (or CDF) of the normal (or gaussian) distribution. The \nparameters `mean` and `variance` default to the standard normal (i.e `mean=0` and `variance=1`).\n*/\nmath.gauss_cdf = function gauss_cdf(value, mean, variance) {\n\tmean = isNaN(mean) ? 0 : +mean;\n\tvariance = isNaN(variance) ? 1 : +variance;\n\tvar standardDeviation = Math.sqrt(variance);\n\t\n\treturn math.gauss_erfc(-(value - mean) / (standardDeviation * Math.sqrt(2))) / 2;\n};\n","/** # Functions\n\nUtilities to simplify functional programming in Javascript.\n*/\nvar functions = exports.functions = {};\n\n/** ## Premade functions. ##########################################################################\n\nWithout currying, is sometimes cumbersome to pass a simple functions (like Javascript operators) to\na higher order function like `Array.map`. These premade functions try to make this easier.\n*/\n\n/** Must have [SKI](https://en.wikipedia.org/wiki/SKI_combinator_calculus). The identity function\n`I` or `id` returns its argument as it is given.\n*/\nfunctions.I = functions.id = function id(x) {\n\treturn x;\n};\n\n/** The `K` function takes two arguments and returns the first one, ignoring the second one.\n*/\nfunctions.K = function id(x) {\n\treturn x;\n};\n\n/** The `S` function takes three arguments, the first two being functions. This may probably have\nlittle use, but it is added for cultural reasons.\n*/\nfunctions.S = function id(x, y, z) {\n\treturn x.call(this, z, y.call(this, z));\n};\n\n/** Almost all Javascript's operators are available as functions. A function for the comma does not\nmake much sense.\n */\nfunctions.__infixOperator__ = function (op) {\n\treturn new Function('x', 'y', 'return (x '+ op +' y);');\n};\n\n'+ * - / % < > <= >= == === != !== & | ^ << >> >>> && || in instanceof'.split(/\\s+/).forEach(function (op) {\n\tvar f = functions.__infixOperator__(op);\n\tfunctions[op] = f;\n\tfunctions['('+ op +')'] = f;\n});\n\nfunctions['~'] = functions['~()'] = new Function('x', 'return ~x;');\nfunctions['!'] = functions['!()'] = new Function('x', 'return !x;');\nfunctions['+()'] = new Function('x', 'return +x;');\nfunctions['-()'] = new Function('x', 'return -x;');\nfunctions['typeof'] = functions['typeof()'] = new Function('x', 'return typeof x;');\nfunctions['void'] = functions['void()'] = new Function('x', 'return void x;');\n\nfunctions['.'] = functions['(.)'] = new Function('x', 'y', 'return x[y];');\nfunctions['?:'] = functions['(?:)'] = new Function('x', 'y', 'z', 'return x ? y : z;');\n","/** ## Initializer\n\nInitializers are object builders, allowing the declaration of default values, type checks and\ncoercions, and other checks.\n*/\n\nvar Initializer = exports.Initializer = declare({\n\t/** An initializer modifies a `subject` taking values from `args`. All by default are new empty\n\tobjects.\n\t*/\n\tconstructor: function Initializer(subject, args) {\n\t\tthis.subject = subject || {};\n\t\tthis.args = args || {};\n\t},\n\n\t/** `get(id, options)` gets the value for `id`. If it is missing, `options.defaultValue` is\n\tused as the default value if defined. Else an error is raised.\n\n\tIf `options.type` is defined, the value is checked to be a member of said type. If \n\t`options.coerce` is true, the value may be coerced to said type.\tThe `option.check` function\n\tcan be defined to check the value further. It will be called with the value, and is expected to\n\traise errors on failed conditions.\n\n\tOther options include:\n\n\t+ `options.regexp`: the value is matched agains a regular expression.\n\n\t+ `options.minimum`: the value has to be greater than or equal to this value.\n\n\t+ `options.maximum`: the value has to be less than or equal to this value.\n\t*/\n\tget: function get(id, options) {\n\t\tvar value;\n\t\toptions = options || {};\n\t\tif (!this.args.hasOwnProperty(id)) {\n\t\t\traiseIf(!options.hasOwnProperty(\"defaultValue\"), \n\t\t\t\toptions.missingValueError || \"Missing argument `\"+ id +\"`!\");\n\t\t\tvalue = options.defaultValue;\n\t\t} else {\n\t\t\tvalue = this.args[id];\n\t\t}\n\t\tif (options.typeCheck) {\n\t\t\tvar coerced = options.typeCheck(value, !!options.coerce);\n\t\t\traiseIf(typeof coerced === 'undefined', options.typeMismatchError ||\n\t\t\t\t\"Incompatible value (\"+ value +\") for `\"+ id +\"`!\");\n\t\t\tvalue = coerced;\n\t\t}\n\t\traiseIf(options.regexp && !options.regexp.exec(value), options.invalidValueError || // Check further constraints.\n\t\t\t\"Value (\"+ value +\") for `\"+ id +\"` does not match \"+ options.regexp +\"!\");\n\t\traiseIf(options.hasOwnProperty(\"minimum\") && options.minimum > value, options.invalidValueError ||\n\t\t\t\"Value (\"+ value +\") for `\"+ id +\"` must be greater than or equal to \"+ options.minimum +\"!\");\n\t\traiseIf(options.hasOwnProperty(\"maximum\") && options.maximum < value, options.invalidValueError ||\n\t\t\t\"Value (\"+ value +\") for `\"+ id +\"` must be less than or equal to \"+ options.maximum +\"!\");\n\t\tif (typeof options.check === 'function') {\n\t\t\toptions.check.call(this.subject, value, id, options);\n\t\t}\n\t\treturn value;\n\t},\n\n\t/** `attr(id, options={})` assigns the `id` property, performing all necessary verifications.\n\tIf the subject already has the attribute defined and `options.overwrite` is false, an error is\n\traised. Any error is ignored and the assignment is skipped if `options.ignore` is true.\n\t*/\n\tattr: function attr(id, options) {\n\t\toptions = options || {};\n\t\ttry {\n\t\t\traiseIf(options.hasOwnProperty(\"overwrite\") && !options.overwrite && this.subject.hasOwnProperty(id),\n\t\t\t\toptions.attrOverwriteError || \"Attribute <\"+ id +\"> is already defined!\");\n\t\t\tthis.subject[id] = this.get(id, options);\n\t\t} catch (exception) {\n\t\t\tif (!options.ignore) {\n\t\t\t\tthrow exception; // Do not ignore the error and throw it.\n\t\t\t}\n\t\t}\n\t\treturn this; // For chaining.\n\t},\n\n\t/** ## Shortcuts ##############################################################################\n\n\tThe following methods simplify the definitions of properties using `attr()`:\n\t*/\n\n\t/** + `bool(id, options)` assigns the `id` property with a truth value.\n\t*/\n\tbool: function bool(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function bool_typeCheck(value, coerce) {\n\t\t\tif (typeof value === 'boolean' || \n\t\t\t\tvalue !== undefined && value !== null && value.constructor === Boolean) {\n\t\t\t\treturn value;\n\t\t\t} else if (coerce) {\n\t\t\t\treturn !!value;\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t},\n\n\t/** + `string(id, options)` assigns the `id` property with a string.\n\t*/\n\tstring: function string(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function string_typeCheck(value, coerce) {\n\t\t\tif (typeof value === 'string' || \n\t\t\t\tvalue !== undefined && value !== null && value.constructor === String) {\n\t\t\t\treturn value;\n\t\t\t} else if (coerce) {\n\t\t\t\treturn ''+ value;\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t},\n\n\t/** + `number(id, options)` assigns the `id` property with a numerical value.\n\t*/\n\tnumber: function number(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function number_typeCheck(value, coerce) {\n\t\t\tif (typeof value === 'number' || \n\t\t\t\tvalue !== undefined && value !== null && value.constructor === Number) {\n\t\t\t\treturn value;\n\t\t\t} else if (coerce) {\n\t\t\t\treturn +value;\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t},\n\n\t/** + `integer(id, options)` assigns the `id` property with an integer.\n\t*/\n\tinteger: function integer(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function integer_typeCheck(value, coerce) {\n\t\t\tif (Math.floor(value) === value) {\n\t\t\t\treturn value;\n\t\t\t} else if (coerce) {\n\t\t\t\treturn Math.floor(+value);\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t},\n\n\t/** + `func(id, options)` assigns the `id` property with a function.\n\t*/\n\tfunc: function func(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function func_typeCheck(value, coerce) {\n\t\t\tif (typeof value === 'function' || \n\t\t\t\tvalue !== undefined && value !== null && value.constructor === Function) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t},\n\n\t/** + `array(id, options)` assigns the `id` property with an array.\n\t*/\n\tarray: function array(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function array_typeCheck(value, coerce) {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\t//TODO Check length and element types.\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t},\n\n\t/** + `object(id, options)` assigns the `id` property with an object. Options may include:\n\n\t\t* `options.objectType`: object's class.\n\t*/\n\tobject: function object(id, options) {\n\t\toptions = options || {};\n\t\toptions.typeCheck = function object_typeCheck(values, coerce) {\n\t\t\tif (typeof value === 'object' && (typeof options.objectType !== 'function' || \n\t\t\t\tvalue instanceof options.objectType)) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\treturn this.attr(id, options);\n\t}\n}); // declare Initializer.\n","/** # Iterables\n\nStandard implementation of iterables and iterators (a.k.a. enumerations or sequences), and many\nfunctions that can be built with it. This implementation is inspired in the Python iterables. An\niterable is an object with a method `__iter__()` which returns an iterator function. An iterator\nfunction returns the next element in the sequence, or raises `STOP_ITERATION` if the sequence has\nended.\n*/\nvar STOP_ITERATION = new Error('Sequence has ended.');\n\nvar Iterable = exports.Iterable = declare({\n\t/** The Iterable constructor builds different types of sequences depending on the given object.\n\tIt supports strings (iterating over each character), arrays, objects (key-value pairs) and\n\tfunctions (assuming it is the iterator maker). A value of `null` or `undefined` is not allowed.\n\tEverything else is assumed to be the only value of a singleton sequence. If the object has an\n\t`__iter__` method it is assumed to be an Iterable already. In this case a copy of that Iterable\n\tis built.\n\t*/\n\tconstructor: function Iterable(obj) {\n\t\tif (obj === null || obj === undefined) {\n\t\t\tthrow new Error('Iterable source is null or undefined.');\n\t\t} else if (typeof obj === 'function') {\n\t\t\tthis.__iter__ = obj;\n\t\t} else if (typeof obj === 'string') {\n\t\t\tthis.__iter__ = Iterable.__iteratorFromString__(obj);\n\t\t} else if (Array.isArray(obj)) {\n\t\t\tthis.__iter__ = Iterable.__iteratorFromArray__(obj);\n\t\t} else if (typeof obj === 'object') {\n\t\t\tif (typeof obj.__iter__ === 'function') {\n\t\t\t\tthis.__iter__ = obj.__iter__.bind(obj);\n\t\t\t} else {\n\t\t\t\tthis.__iter__ = Iterable.__iteratorFromObject__(obj);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.__iter__ = Iterable.__iteratorSingleton__(obj);\n\t\t}\n\t},\n\n\t/** `STOP_ITERATION` is the singleton error raised when an sequence\thas finished. It is catched\n\tby all Iterable's functions.\n\t*/\n\t\"dual STOP_ITERATION\": STOP_ITERATION,\n\n\t/** `stop()` raises the STOP_ITERATION exception. If used inside an iterator it breaks the\n\titeration.\n\t*/\n\t\"dual stop\": function stop() {\n\t\tthrow STOP_ITERATION;\n\t},\n\n\t/** `catchStop(exception)` does nothing `exception` is `STOP_ITERATION`, but if it isn't the\n\texception is thrown.\n\t*/\n\t\"dual catchStop\": function catchStop(exception) {\n\t\tif (exception !== STOP_ITERATION) {\n\t\t\tthrow exception;\n\t\t}\n\t},\n\n\t// ## Iterables from common datatypes ##########################################################\n\n\t/** `__iteratorFromArray__(array)` returns the `__iter__` function that builds the iterators of\n\titerables based on arrays.\n\t*/\n\t\"static __iteratorFromArray__\": function __iteratorFromArray__(array) {\n\t\treturn function __iter__() {\n\t\t\tvar i = 0, iterable = this;\n\t\t\treturn function __arrayIterator__() {\n\t\t\t\tif (i < array.length) {\n\t\t\t\t\treturn array[i++];\n\t\t\t\t} else {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t},\n\n\t/** The iterables based on strings iterate character by character. `__iteratorFromString__(str)`\n\treturns the `__iter__` function that builds iterators over the `str` string.\n\t*/\n\t\"static __iteratorFromString__\": function __iteratorFromString__(str) {\n\t\treturn function __iter__() {\n\t\t\tvar i = 0, iterable = this;\n\t\t\treturn function __stringIterator__() {\n\t\t\t\tif (i < str.length) {\n\t\t\t\t\treturn str.charAt(i++);\n\t\t\t\t} else {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t},\n\n\t/** Iterables over objects iterate over pairs `[name, value]` for each property of the object.\n\t`__iteratorFromObject__(obj)` return the `__iter__` function for these sequences.\n\t*/\n\t\"static __iteratorFromObject__\": function __iteratorFromObject__(obj) {\n\t\treturn function __iter__() {\n\t\t\tvar keys = Object.keys(obj), iterable = this;\n\t\t\treturn function __objectIterator__() {\n\t\t\t\tif (keys.length > 0) {\n\t\t\t\t\tvar k = keys.shift();\n\t\t\t\t\treturn [k, obj[k]];\n\t\t\t\t} else {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t},\n\n\t/** Singleton iterables have only one value in their sequence. Their `__iter__` function can be\n\tobtained with `__iteratorSingleton__(x)`.\n\t*/\n\t\"static __iteratorSingleton__\": function __iteratorSingleton__(x) {\n\t\treturn function __iter__() {\n\t\t\tvar finished = false, iterable = this;\n\t\t\treturn function __singletonIterator__() {\n\t\t\t\tif (!finished) {\n\t\t\t\t\tfinished = true;\n\t\t\t\t\treturn x;\n\t\t\t\t} else {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t},\n\n\t// ## Sequence predicates ######################################################################\n\n\t/** `isEmpty()` returns if the sequence has no elements.\n\t*/\n\tisEmpty: function isEmpty() {\n\t\ttry {\n\t\t\tthis.__iter__()();\n\t\t\treturn false;\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t\treturn true;\n\t\t}\n\t},\n\n\t// ## Sequence information #####################################################################\n\n\t/** `count()` counts the number of elements in the sequence.\n\t*/\n\tcount: function count() {\n\t\tvar result = 0;\n\t\tthis.forEach(function (x) {\n\t\t\tresult++;\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `length()` is just a synonym for `count()`.\n\t*/\n\tlength: function length() {\n\t\treturn this.count();\n\t},\n\n\t/** `indexOf(value, from=0)` is analogous to the array's namesake method. Returns the first\n\tposition of the given `value`, or -1 if it is not found.\n\t*/\n\tindexOf: function indexOf(value, from) {\n\t\tfrom = from|0;\n\t\tvar iter = this.__iter__(), x, i = 0;\n\t\ttry {\n\t\t\tfor (x = iter(); true; x = iter(), ++i) {\n\t\t\t\tif (i >= from && x === value) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t}\n\t\treturn -1;\n\t},\n\n\t/** `indexesOf(value, from=0)` is a sequence of the positions of the value in this iterable.\n\t*/\n\tindicesOf: function indexesOf(value, from) {\n\t\tfrom = from|0;\n\t\treturn this.filter(function (v, i) {\n\t\t\treturn i >= from && v === value;\n\t\t}, function (v, i) {\n\t\t\treturn i;\n\t\t});\n\t},\n\n\t/** `indexWhere(condition, from=0)` returns the position of the first value of this iterable\n\tthat complies with the given `condition`, or -1 if there is none.\n\t*/\n\tindexWhere: function indexWhere(condition, from) {\n\t\tfrom = from|0;\n\t\tvar iter = this.__iter__(), x, i = 0;\n\t\ttry {\n\t\t\tfor (x = iter(); true; x = iter(), ++i) {\n\t\t\t\tif (i >= from && condition(x, i)) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t}\n\t\treturn -1;\n\t},\n\n\t/** `indexesWhere(condition, from=0)` is a sequence of the positions in this iterable of values\n\tthat comply with the given `condition`.\n\t*/\n\tindicesWhere: function indexesWhere(condition, from) {\n\t\tfrom = from|0;\n\t\treturn this.filter(function (v, i) {\n\t\t\treturn i >= from && condition(v);\n\t\t}, function (v, i) {\n\t\t\treturn i;\n\t\t});\n\t},\n\n\t// ## Iteration methods ########################################################################\n\n\t/** `forEach(doFunction, ifFunction)` applies `doFunction` to all elements complying with\n\t`ifFunction`, and returns the last result. If no `ifFunction` is given, it iterates through all\n\tthe elements in the sequence. Both functions get the current value and position as arguments.\n\t*/\n\tforEach: function forEach(doFunction, ifFunction) {\n\t\tvar iter = this.__iter__(), x, i = 0, result;\n\t\ttry {\n\t\t\tfor (x = iter(); true; x = iter(), i++) {\n\t\t\t\tif (!ifFunction || ifFunction(x, i)) {\n\t\t\t\t\tresult = doFunction(x, i);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t}\n\t\treturn result;\n\t},\n\n\t/** `forEachApply(doFunction, ifFunction, _this)` is similar to `forEach` but instead of calling\n\t`doFunction`, it uses `apply`. It assumes the elements in the sequence are arrays of arguments\n\tto pass to the functions.\n\t*/\n\tforEachApply: function forEachApply(doFunction, ifFunction, _this) {\n\t\t_this = _this || this;\n\t\treturn this.forEach(function (args, i) {\n\t\t\treturn doFunction.apply(_this, args.concat([i]));\n\t\t}, ifFunction);\n\t},\n\n\t/** `map(mapFunction, filterFunction)` returns an iterable iterating on the results of applying\n\t`mapFunction` to each of this iterable elements. If `filterFunction` is given, only elements for\n\twhich `filterFunction` returns true are considered.\n\t*/\n\tmap: function map(mapFunction, filterFunction) {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__(), x, i = -1;\n\t\t\treturn function __mapIterator__() {\n\t\t\t\tfor (x = iter(); true; x = iter()) {\n\t\t\t\t\ti++;\n\t\t\t\t\tx = mapFunction ? mapFunction(x, i) : x;\n\t\t\t\t\tif (!filterFunction || filterFunction(x, i)) {\n\t\t\t\t\t\treturn x;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow STOP_ITERATION;\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `mapApply(mapFunction, filterFunction, _this)` is similar to `map` but instead of calling\n\t`mapFunction`, it uses `apply`. It assumes the elements in the sequence are arrays of arguments\n\tto pass to the functions.\n\t*/\n\tmapApply: function mapApply(mapFunction, filterFunction, _this) {\n\t\t_this = _this || this;\n\t\treturn this.map(function (args, i) {\n\t\t\treturn mapFunction.apply(_this, args.concat([i]));\n\t\t}, filterFunction);\n\t},\n\n\t/** `select(members)` is a shortcut for a map that extracts a member or members from the objects\n\tin the sequence. If `members` is an object, then for each value in the sequence another object\n\tis built with a selection for each key in the object. Arrays can also be built in a similar\n\tfashion.\n\t*/\n\tselect: (function () {\n\t\tfunction __selection__(from, member) {\n\t\t\tif (Array.isArray(member)) {\n\t\t\t\treturn member.map(__selection__.bind(null, from));\n\t\t\t} else if (typeof member === 'object') {\n\t\t\t\tvar result = {};\n\t\t\t\tObject.keys(member).forEach(function (k) {\n\t\t\t\t\tresult[k] = __selection__.call(null, from, member[k]);\n\t\t\t\t});\n\t\t\t\treturn result;\n\t\t\t} else if (typeof member === 'function') {\n\t\t\t\treturn member(from);\n\t\t\t} else {\n\t\t\t\treturn from[member];\n\t\t\t}\n\t\t}\n\t\treturn function select(members) {\n\t\t\treturn this.map(function (obj) {\n\t\t\t\treturn __selection__(obj, members);\n\t\t\t});\n\t\t};\n\t})(),\n\n\t// ## Sequence selection and filtering #########################################################\n\n\t/** `filter(filterFunction, mapFunction)` returns an iterable of this iterable elements for\n\twhich `filterFunction` returns true. If `mapFunction` is given it is applied before yielding the\n\telements.\n\t*/\n\tfilter: function filter(filterFunction, mapFunction) {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__(), x, i = -1;\n\t\t\treturn function __mapIterator__() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tx = iter();\n\t\t\t\t\ti++;\n\t\t\t\t\tif (filterFunction ? filterFunction(x, i) : x) {\n\t\t\t\t\t\treturn mapFunction ? mapFunction(x, i) : x;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow STOP_ITERATION;\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `filterApply(filterFunction, mapFunction, _this)` is similar to `filter` but instead of\n\tcalling the given functions, it uses `apply`. It assumes the elements in the sequence are arrays\n\tof arguments to pass to the functions.\n\t*/\n\tfilterApply: function filterApply(filterFunction, mapFunction, _this) {\n\t\t_this = _this || this;\n\t\treturn this.filter(function (args, i) {\n\t\t\treturn filterFunction.apply(_this, args.concat([i]));\n\t\t}, mapFunction && function (args, i) {\n\t\t\treturn mapFunction.apply(_this, args.concat([i]));\n\t\t});\n\t},\n\n\t/** `takeWhile(condition)` return an iterable with the first elements that verify the given\n\tcondition.\n\t*/\n\ttakeWhile: function takeWhile(condition) {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__(),\n\t\t\t\ti = 0;\n\t\t\treturn function __takeWhileIterator__() {\n\t\t\t\tif (i >= 0) {\n\t\t\t\t\tvar x = iter();\n\t\t\t\t\tif (condition(x, i)) {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\treturn x;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti = -Infinity;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfrom.stop();\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `take(n=1)` return an iterable with the first `n` elements of this one.\n\t*/\n\ttake: function take(n) {\n\t\tn = isNaN(n) ? 1 : n | 0;\n\t\treturn this.takeWhile(function (x, i) {\n\t\t\treturn i < n;\n\t\t});\n\t},\n\n\t/** `dropWhile(condition)` returns an iterable with the same elements than this, except the\n\tfirst ones that comply with the condition.\n\t*/\n\tdropWhile: function dropWhile(condition) {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__(),\n\t\t\t\ti = 0,\n\t\t\t\tdropping = true;\n\t\t\treturn function __dropWhileIterator__() {\n\t\t\t\tvar x;\n\t\t\t\tdo {\n\t\t\t\t\tx = iter();\n\t\t\t\t\tdropping = dropping && condition(x, i);\n\t\t\t\t\ti++;\n\t\t\t\t} while (dropping);\n\t\t\t\treturn x;\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `drop(n=1)` returns an iterable with the same elements than this, except the first `n` ones.\n\t*/\n\tdrop: function drop(n) {\n\t\tn = isNaN(n) ? 1 : n | 0;\n\t\treturn this.dropWhile(function (x, i) {\n\t\t\treturn i < n;\n\t\t});\n\t},\n\n\t/** `head(defaultValue)` returns the first element. If the sequence is empty it returns\n\t`defaultValue`, or raise an exception if one is not given.\n\t*/\n\thead: function head(defaultValue) {\n\t\ttry {\n\t\t\treturn this.__iter__()();\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t\tif (arguments.length < 1) {\n\t\t\t\tthrow new Error(\"Tried to get the head value of an empty Iterable.\");\n\t\t\t} else {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t}\n\t},\n\n\t/** `tail()` returns an iterable with the same elements than this, except the first one.\n\t*/\n\ttail: function tail() {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__();\n\t\t\ttry {\n\t\t\t\titer();\n\t\t\t} catch (err) {\n\t\t\t\tthis.catchStop(err);\n\t\t\t\tthrow new Error(\"Tried to get the tail of an empty Iterable.\");\n\t\t\t}\n\t\t\treturn iter;\n\t\t});\n\t},\n\n\t/** `last(defaultValue)` returns the last element. If the sequence is empty it returns\n\t`defaultValue`, or raise an exception if one is not given.\n\t*/\n\tlast: function last(defaultValue) {\n\t\tvar result, isEmpty = true, it = this.__iter__();\n\t\ttry {\n\t\t\tfor (isEmpty = true; true; isEmpty = false) {\n\t\t\t\tresult = it();\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t\tif (!isEmpty) {\n\t\t\t\treturn result;\n\t\t\t} else if (arguments.length < 1) {\n\t\t\t\tthrow new Error(\"Tried to get the last value of an empty Iterable.\");\n\t\t\t} else {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t}\n\t},\n\n\t/** `init()` returns an iterable with the same elements than this, except the last one.\n\t*/\n\tinit: function init() {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__(), last;\n\t\t\ttry {\n\t\t\t\tlast = iter();\n\t\t\t} catch (err) {\n\t\t\t\tthis.catchStop(err);\n\t\t\t\tthrow new Error(\"Tried to get the init of an empty Iterable.\");\n\t\t\t}\n\t\t\treturn function __mapIterator__() {\n\t\t\t\tvar result = last;\n\t\t\t\tlast = iter();\n\t\t\t\treturn result;\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `greater(evaluation)` returns an array with the elements of the iterable with greater\n\tevaluation (or numerical conversion by default).\n\t*/\n\tgreater: function greater(evaluation) {\n\t\tevaluation = typeof evaluation === 'function' ? evaluation : function (x) {\n\t\t\t\treturn +x;\n\t\t\t};\n\t\tvar maxEval = -Infinity, result = [], e;\n\t\tthis.forEach(function (x) {\n\t\t\te = evaluation(x);\n\t\t\tif (maxEval < e) {\n\t\t\t\tmaxEval = e;\n\t\t\t\tresult = [x];\n\t\t\t} else if (maxEval == e) {\n\t\t\t\tresult.push(x);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `lesser(evaluation)` returns an array with the elements of the iterable with lesser\n\tevaluation (or numerical conversion by default).\n\t*/\n\tlesser: function lesser(evaluation) {\n\t\tevaluation = typeof evaluation === 'function' ? evaluation : function (x) {\n\t\t\t\treturn +x;\n\t\t\t};\n\t\tvar minEval = Infinity, result = [], e;\n\t\tthis.forEach(function (x) {\n\t\t\te = evaluation(x);\n\t\t\tif (minEval > e) {\n\t\t\t\tminEval = e;\n\t\t\t\tresult = [x];\n\t\t\t} else if (minEval == e) {\n\t\t\t\tresult.push(x);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `sample(n, random=Randomness.DEFAULT)` returns an iterable with `n` elements of this\n\titerable randomly selected. The order of the elements is maintained.\n\t*/\n\tsample: function sample(n, random) {\n\t\tn = n|0;\n\t\tif (n < 1) {\n\t\t\treturn Iterable.EMPTY;\n\t\t}\n\t\trandom = random || Randomness.DEFAULT;\n\t\tvar buffer = [];\n\t\tthis.forEach(function (x, i) {\n\t\t\tvar r = random.random();\n\t\t\tfor (var p = buffer.length; p > 0 && buffer[p-1][0] < r; --p); // Ordered insertion.\n\t\t\tbuffer.splice(p, 0, [r, x, i]);\n\t\t\twhile (buffer.length > n) {\n\t\t\t\tbuffer.pop();\n\t\t\t}\n\t\t});\n\t\tbuffer.sort(function (t1, t2) { // Order by index.\n\t\t\treturn t1[2] - t2[2];\n\t\t});\n\t\treturn new Iterable(buffer.map(function (t) { // Keep only the elements.\n\t\t\treturn t[1];\n\t\t}));\n\t},\n\n\t// ## Sequence aggregation #####################################################################\n\n\t/** `foldl(foldFunction, initial)` folds the elements of this iterable with `foldFunction` as a\n\tleft associative operator. The `initial` value is used as a starting point, but if it is not\n\tdefined, then the first element in the sequence is used.\n\t*/\n\tfoldl: function foldl(foldFunction, initial) {\n\t\tvar iter = this.__iter__(), x;\n\t\ttry {\n\t\t\tinitial = initial === undefined ? iter() : initial;\n\t\t\tfor (x = iter(); true; x = iter()) {\n\t\t\t\tinitial = foldFunction(initial, x);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.catchStop(err);\n\t\t}\n\t\treturn initial;\n\t},\n\n\t/** `scanl(foldFunction, initial)` folds the elements of this iterable with `foldFunction` as a\n\tleft associative operator. Instead of returning the last result, it iterates over the\n\tintermediate values in the folding sequence.\n\t*/\n\tscanl: function scanl(foldFunction, initial) {\n\t\tvar from = this; // for closures.\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = from.__iter__(), value, count = -1;\n\t\t\treturn function __scanlIterator__() {\n\t\t\t\tcount++;\n\t\t\t\tif (count === 0) {\n\t\t\t\t\tvalue = initial === undefined ? iter() : initial;\n\t\t\t\t} else {\n\t\t\t\t\tvalue = foldFunction(value, iter());\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `foldr(foldFunction, initial)` folds the elements of this iterable with `foldFunction` as a\n\tright associative operator. The `initial` value is used as a starting point, but if it is not\n\tdefined the first element in the sequence is used.\n\n\tWarning! This is the same as doing a `foldl` in a reversed iterable.\n\t*/\n\tfoldr: function foldr(foldFunction, initial) {\n\t\tfunction flippedFoldFunction(x,y) {\n\t\t\treturn foldFunction(y,x);\n\t\t}\n\t\treturn this.reverse().foldl(flippedFoldFunction, initial);\n\t},\n\n\t/** `scanr(foldFunction, initial)` folds the elements of this iterable with `foldFunction` as a\n\tright associative operator. Instead of returning the last result, it iterates over the\n\tintermediate values in the folding sequence.\n\n\tWarning! This is the same as doing a `scanl` in a reversed iterable.\n\t*/\n\tscanr: function scanr(foldFunction, initial) {\n\t\tfunction flippedFoldFunction(x,y) {\n\t\t\treturn foldFunction(y,x);\n\t\t}\n\t\treturn this.reverse().scanl(flippedFoldFunction, initial);\n\t},\n\n\t/** `sum(n=0)` returns the sum of all elements in the sequence, or `n` if the sequence is empty.\n\t*/\n\tsum: function sum(n) {\n\t\tvar result = isNaN(n) ? 0 : +n;\n\t\tthis.forEach(function (x) {\n\t\t\tresult += (+x);\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `min(n=Infinity)` returns the minimum element of all elements in the sequence, or `Infinity`\n\tif the sequence is empty.\n\t*/\n\tmin: function min(n) {\n\t\tvar result = isNaN(n) ? Infinity : +n;\n\t\tthis.forEach(function (x) {\n\t\t\tx = (+x);\n\t\t\tif (x < result) {\n\t\t\t\tresult = x;\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `max(n=-Infinity)` returns the maximum element of all elements in the sequence, or\n\t`-Infinity` if the sequence is empty.\n\t*/\n\tmax: function max(n) {\n\t\tvar result = isNaN(n) ? -Infinity : +n;\n\t\tthis.forEach(function (x) {\n\t\t\tx = (+x);\n\t\t\tif (x > result) {\n\t\t\t\tresult = x;\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `all(predicate, strict=false)` returns true if for all elements in the sequence `predicate`\n\treturns true, or if the sequence is empty.\n\t*/\n\tall: function all(predicate, strict) {\n\t\tpredicate = typeof predicate === 'function' ? predicate : function (x) { return !!x; };\n\t\tvar result = true;\n\t\tthis.forEach(function (x, i) {\n\t\t\tif (!predicate(x, i)) {\n\t\t\t\tresult = false;\n\t\t\t\tif (!strict) {\n\t\t\t\t\tthrow STOP_ITERATION; // Shortcircuit.\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `any(predicate, strict=false)` returns false if for all elements in the sequence `predicate`\n\treturns false, or if the sequence is empty.\n\t*/\n\tany: function any(predicate, strict) {\n\t\tpredicate = typeof predicate === 'function' ? predicate : function (x) { return !!x; };\n\t\tvar result = false;\n\t\tthis.forEach(function (x, i) {\n\t\t\tif (predicate(x, i)) {\n\t\t\t\tresult = true;\n\t\t\t\tif (!strict) {\n\t\t\t\t\tthrow STOP_ITERATION; // Shortcut.\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/** `join(sep='')` concatenates all strings in the sequence using `sep` as separator. If `sep`\n\tis not given, '' is assumed.\n\t*/\n\tjoin: function join(sep) {\n\t\tvar result = '';\n\t\tsep = ''+ (sep || '');\n\t\tthis.forEach(function (x, i) {\n\t\t\tresult += (i === 0) ? x : sep + x;\n\t\t});\n\t\treturn result;\n\t},\n\n\t// ## Sequence conversions #####################################################################\n\n\t/** `toArray(array=[])`: appends to `array` the elements of the sequence and returns it. If no\n\tarray is given, a new one is used.\n\t*/\n\ttoArray: function toArray(array) {\n\t\tarray = array || [];\n\t\tthis.forEach(function (x) {\n\t\t\tarray.push(x);\n\t\t});\n\t\treturn array;\n\t},\n\n\t/** `toObject(obj={})` takes an iterable of 2 element arrays and assigns to the given object (or\n\ta new one by default) each key-value pairs as a property.\n\t*/\n\ttoObject: function toObject(obj) {\n\t\tobj = obj || {};\n\t\tthis.forEach(function (x) {\n\t\t\tobj[x[0]] = x[1];\n\t\t});\n\t\treturn obj;\n\t},\n\n\t// ## Whole sequence operations ################################################################\n\n\t/** `reverse()` returns an iterable with this iterable elements in reverse order.\n\n\tWarning! It stores all this iterable's elements in memory.\n\t*/\n\treverse: function reverse() {\n\t\treturn new Iterable(this.toArray().reverse());\n\t},\n\n\t/** `sorted(sortFunction)` returns an iterable that goes through this iterable's elements in\n\torder.\n\n\tWarning! This iterable's elements are stored in memory for sorting.\n\t*/\n\tsorted: function sorted(sortFunction) {\n\t\treturn new Iterable(this.toArray().sort(sortFunction));\n\t},\n\n\t/** `permutations(k)` returns an iterable that runs over the permutations of `k` elements of\n\tthis iterable. Permutations are not generated in any particular order.\n\n\tWarning! It stores all this iterable's elements in memory.\n\t*/\n\tpermutations: function permutations(k) {\n\t\tk = k|0;\n\t\tvar pool = this.toArray(),\n\t\t\tn = pool.length;\n\t\tif (k < 1 || k > n) {\n\t\t\treturn Iterable.EMPTY;\n\t\t} else {\n\t\t\tvar count = math.factorial(n) / math.factorial(n - k);\n\t\t\treturn new Iterable(function () {\n\t\t\t\tvar current = 0,\n\t\t\t\t\tindices = Iterable.range(n).toArray();\n\t\t\t\treturn function __permutationsIterator__() {\n\t\t\t\t\tif (current < count) {\n\t\t\t\t\t\tvar result = new Array(k),\n\t\t\t\t\t\t\tis = indices.slice(), // copy indices array.\n\t\t\t\t\t\t\ti = current;\n\t\t\t\t\t\tfor (var p = 0; p < k; ++p) {\n\t\t\t\t\t\t\tresult[p] = pool[is.splice(i % (n - p), 1)[0]];\n\t\t\t\t\t\t\ti = (i / (n - p)) |0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t++current;\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\n\t/** `combinations(k)` returns an iterable that runs over the combinations of `k` elements of\n\tthis iterable. Combinations are generated in lexicographical order. The implementations is\n\tinspired in [Python's itertools](https://docs.python.org/3/library/itertools.html#itertools.combinations).\n\n\tWarning! It stores all this iterable's elements in memory.\n\t*/\n\tcombinations: function combinations(k) {\n\t\tk = k|0;\n\t\tvar pool = this.toArray(),\n\t\t\tn = pool.length;\n\t\tif (k < 1 || k > n) {\n\t\t\treturn Iterable.EMPTY;\n\t\t} else {\n\t\t\treturn new Iterable(function () {\n\t\t\t\tvar indices = Iterable.range(k).toArray(),\n\t\t\t\t\tcurrent = indices.map(function (i) { return pool[i]; });\n\t\t\t\treturn function __combinationsIterator__() {\n\t\t\t\t\tif (!current) throw STOP_ITERATION;\n\t\t\t\t\tvar result = current;\n\t\t\t\t\tfor (var i = k-1; i >= 0; --i) {\n\t\t\t\t\t\tif (indices[i] !== i + n - k) break;\n\t\t\t\t\t}\n\t\t\t\t\tif (i < 0) {\n\t\t\t\t\t\tcurrent = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindices[i] += 1;\n\t\t\t\t\t\tfor (var j = i+1; j < k; ++j) {\n\t\t\t\t\t\t\tindices[j] = indices[j-1] + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrent = indices.map(function (i) { return pool[i]; });\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\n\t/** `slices(size=1)` builds another iterable that enumerates arrays of the given size of\n\telements of this iterable.\n\t*/\n\tslices: function slices(size) {\n\t\tvar _this = this;\n\t\tsize = isNaN(size) || size < 1 ? 1 : size|0;\n\t\treturn new Iterable(function __iter__(){\n\t\t\tvar it = _this.__iter__(), slice;\n\t\t\treturn function __sliceIterator__() {\n\t\t\t\tslice = [];\n\t\t\t\ttry {\n\t\t\t\t\tfor (var i = 0; i < size; ++i) {\n\t\t\t\t\t\tslice.push(it());\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err !== STOP_ITERATION) {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (slice.length > 0) {\n\t\t\t\t\treturn slice;\n\t\t\t\t} else {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `groupBy(key)` returns an iterable that runs over the subsequent elements of this iterable\n\tthat when applied the `key` function return the same value. If no `key` function is given, the\n\tactual values are used. Each element in the grouped iterable is a pair, with the key value first\n\tand an array second.\n\t*/\n\tgroupBy: function groupBy(key) {\n\t\tvar it = this;\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iter = it.__iter__(),\n\t\t\t\tcurrentValues = null, currentKey;\n\t\t\ttry {\n\t\t\t\tcurrentValues = [iter()];\n\t\t\t\tcurrentKey = key ? key(currentValues[0]) : currentValues[0];\n\t\t\t} catch (err) {\n\t\t\t\tit.catchStop(err);\n\t\t\t}\n\t\t\treturn function __groupByIterator__() {\n\t\t\t\tvar value, valueKey, pair;\n\t\t\t\tif (!currentValues) {\n\t\t\t\t\tit.stop();\n\t\t\t\t} else while (true) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = iter();\n\t\t\t\t\t\tvalueKey = key ? key(value) : value;\n\t\t\t\t\t\tif (valueKey === currentKey) {\n\t\t\t\t\t\t\tcurrentValues.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpair = [currentKey, currentValues];\n\t\t\t\t\t\t\tcurrentKey = valueKey;\n\t\t\t\t\t\t\tcurrentValues = [value];\n\t\t\t\t\t\t\treturn pair;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tit.catchStop(err);\n\t\t\t\t\t\tpair = [currentKey, currentValues];\n\t\t\t\t\t\tcurrentValues = null;\n\t\t\t\t\t\treturn pair;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `groupAll(key, accum)` returns an object with one member per group of elements. The\n\telements' keys are calculated by the `key` function, or the default string conversion by\n\tdefault. If a `accum` function is given, it is used to accumulate the groups. By default an\n\tarray is built.\n\t*/\n\tgroupAll: (function () {\n\t\tfunction DEFAULT_KEY(x) {\n\t\t\treturn x +'';\n\t\t}\n\t\tfunction DEFAULT_ACCUM(xs, x) {\n\t\t\txs = xs || [];\n\t\t\txs.push(x);\n\t\t\treturn xs;\n\t\t}\n\t\treturn function groupAll(key, accum) {\n\t\t\tvar result = {};\n\t\t\tkey = key || DEFAULT_KEY;\n\t\t\taccum = accum || DEFAULT_ACCUM;\n\t\t\tthis.forEach(function (elem, i) {\n\t\t\t\tvar k = key(elem, i);\n\t\t\t\tresult[k] = accum(result[k], elem, i);\n\t\t\t});\n\t\t\treturn result;\n\t\t};\n\t})(),\n\n\t// ## Operations on many sequences #############################################################\n\n\t/** `zip(iterables...)` builds an iterable that iterates over this and all the given iterables\n\tat the same time, yielding an array of the values of each and stopping at the first sequence\n\tfinishing.\n\t*/\n\t'static zipWith': function zipWith(f) {\n\t\tvar its = Array.prototype.slice.call(arguments, 1).map(iterable);\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iterators = its.map(function (it) {\n\t\t\t\treturn it.__iter__();\n\t\t\t});\n\t\t\treturn function __zipIterator__() {\n\t\t\t\tvar r = iterators.map(function (iterator) {\n\t\t\t\t\treturn iterator();\n\t\t\t\t});\n\t\t\t\treturn f ? f.apply(null, r) : r;\n\t\t\t};\n\t\t});\n\t},\n\n\tzipWith: function zipWith(f) {\n\t\tvar args = [f, this].concat(Array.prototype.slice.call(arguments, 1));\n\t\treturn this.constructor.zipWith.apply(this.constructor, args);\n\t},\n\n\t'static zip': function zip() {\n\t\tvar args = [null].concat(Array.prototype.slice.call(arguments));\n\t\treturn this.zipWith.apply(this, args);\n\t},\n\n\tzip: function zip() {\n\t\tvar args = [null, this].concat(Array.prototype.slice.call(arguments));\n\t\treturn this.constructor.zipWith.apply(this.constructor, args);\n\t},\n\n\t/** `product(iterables...)` builds an iterable that iterates over the\n\t[cartesian product](http://en.wikipedia.org/wiki/Cartesian_product) of this and all the given\n\titerables, yielding an array of the values of each.\n\t*/\n\tproduct: function product() {\n\t\tvar its = Array.prototype.slice.call(arguments).map(iterable);\n\t\tits.unshift(this);\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar iterators, tuple;\n\t\t\treturn function __productIterator__() {\n\t\t\t\tif (!iterators) { // First tuple.\n\t\t\t\t\titerators = its.map(function (it) {\n\t\t\t\t\t\treturn it.__iter__();\n\t\t\t\t\t});\n\t\t\t\t\ttuple = iterators.map(function (iter) {\n\t\t\t\t\t\treturn iter(); // If STOP_ITERATION is raised, it should not be catched.\n\t\t\t\t\t});\n\t\t\t\t} else if (!tuple) { // Sequence has ended.\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t} else {\n\t\t\t\t\tfor (var i = iterators.length - 1; i >= 0; --i) { // Subsequent tuples.\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\ttuple[i] = iterators[i]();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tif (i > 0 && err === STOP_ITERATION) {\n\t\t\t\t\t\t\t\titerators[i] = its[i].__iter__();\n\t\t\t\t\t\t\t\ttuple[i] = iterators[i]();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttuple = null; // So subsequent calls while still throw STOP_ITERATION.\n\t\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn tuple.slice(0); // Shallow array clone.\n\t\t\t};\n\t\t});\n\t},\n\n\t'static product': function (it) {\n\t\tit = it ? iterable(it) : this.EMPTY;\n\t\treturn this.prototype.product.apply(it, Array.prototype.slice.call(arguments, 1));\n\t},\n\n\t/** `chain(iterables...)` returns an iterable that iterates over the concatenation of this and\n\tall the given iterables.\n\t*/\n\tchain: function chain() {\n\t\tvar its = Array.prototype.slice.call(arguments).map(iterable);\n\t\tits.unshift(this);\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar i = 0, iterator = its[0].__iter__();\n\t\t\treturn function __chainIterator__() {\n\t\t\t\twhile (true) try {\n\t\t\t\t\treturn iterator();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err === STOP_ITERATION && i + 1 < its.length) {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\titerator = its[i].__iter__();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err; // Rethrow if not STOP_ITERATION or there aren't more iterables.\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow STOP_ITERATION;\n\t\t\t};\n\t\t});\n\t},\n\n\t'static chain': function (it) {\n\t\tit = it ? iterable(it) : this.EMPTY;\n\t\treturn this.prototype.chain.apply(it, Array.prototype.slice.call(arguments, 1));\n\t},\n\n\t/** `flatten()` chains all the iterables in the elements of this iterable.\n\t*/\n\tflatten: function flatten() {\n\t\tvar self = this;\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar it = self.__iter__(),\n\t\t\t\titerator = this.stop;\n\t\t\treturn function __flattenIterator__() {\n\t\t\t\twhile (true) try {\n\t\t\t\t\treturn iterator();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err === STOP_ITERATION) {\n\t\t\t\t\t\titerator = iterable(it()).__iter__();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow STOP_ITERATION;\n\t\t\t};\n\t\t});\n\t},\n\n\t// ## Set related ##############################################################################\n\n\t/** The `nub` of a sequence is another sequence with each element only appearing once. Basically\n\trepeated elements are removed. The argument `comp` may have a function to compare the sequence's\n\tvalues.\n\n\tWarning! All the elements of the result are stored in memory.\n\t*/\n\tnub: function nub(comp) {\n\t\tvar buffer = [];\n\t\treturn this.filter(function (x) {\n\t\t\tif (comp) {\n\t\t\t\tfor (var i = buffer.length-1; i >= 0; --i) {\n\t\t\t\t\tif (comp(buffer[i], x)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (buffer.indexOf(x) >= 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tbuffer.push(x);\n\t\t\treturn true;\n\t\t});\n\t},\n\n\t/** The `union(iterable...)` and `unionBy(comp, iterable...)` methods treat this and each\n\titerable argument as sets, and calculate the union of all. `unionBy` allows to define a specific\n\tequality criteria between the elements.\n\n\tWarning! All the elements of the result are stored in memory.\n\t*/\n\tunion: function union() {\n\t\tvar args = [void 0].concat(Array.prototype.slice.call(arguments));\n\t\treturn this.unionBy.apply(this, args);\n\t},\n\n\tunionBy: function unionBy(comp) {\n\t\treturn this.chain.apply(this, Array.prototype.slice.call(arguments, 1)).nub(comp);\n\t},\n\n\t/** The `intersection(iterable...)` and `intersectionBy(comp, iterable...)` methods intersection\n\tof the iterable arguments with `this`. This iterable is assumed not to have repeated elements.\n\t`intersectionBy` allows to define a specific equality criteria between the elements.\n\n\tWarning! All the elements of the result are stored in memory.\n\t*/\n\tintersection: function intersection() {\n\t\tvar args = [void 0].concat(Array.prototype.slice.call(arguments));\n\t\treturn this.intersectionBy.apply(this, args);\n\t},\n\n\tintersectionBy: function intersectionBy(comp) {\n\t\tvar buffer = this.toArray();\n\t\tfor (var i = 1; i < arguments.length; ++i) {\n\t\t\tbuffer = iterable(arguments[i]).filter(function (x) {\n\t\t\t\tif (comp) {\n\t\t\t\t\tfor (var i = buffer.length-1; i >= 0; --i) {\n\t\t\t\t\t\tif (comp(buffer[i], x)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn buffer.indexOf(x) >= 0;\n\t\t\t\t}\n\t\t\t}).toArray();\n\t\t}\n\t\treturn iterable(buffer);\n\t},\n\n\t/** The `difference(iterable...)` and `differenceBy(comp, iterable...)` methods difference of\n\tthe iterable arguments with `this`. This iterable is assumed not to have repeated elements.\n\t`differenceBy` allows to define a specific equality criteria between the elements.\n\n\tWarning! All the elements of given sequences are stored in memory.\n\t*/\n\tdifference: function difference() {\n\t\tvar args = [void 0].concat(Array.prototype.slice.call(arguments));\n\t\treturn this.differenceBy.apply(this, args);\n\t},\n\n\tdifferenceBy: function differenceBy(comp) {\n\t\tvar result = this,\n\t\t\tbuffer;\n\t\tfor (var i = 1; i < arguments.length; ++i) {\n\t\t\tbuffer = iterable(arguments[i]).toArray();\n\t\t\tresult = result.filter(function (x) {\n\t\t\t\tif (comp) {\n\t\t\t\t\tfor (var i = buffer.length-1; i >= 0; --i) {\n\t\t\t\t\t\tif (comp(buffer[i], x)) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn buffer.indexOf(x) < 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t},\n\n\t// ## Sequence builders ########################################################################\n\n\t/** `range(from=0, to, step=1)` builds an Iterable object with number from `from` upto `to` with\n\tthe given `step`. For example, `range(2,12,3)` represents the sequence `[2, 5, 8, 11]`.\n\t*/\n\t\"static range\": function range(from, to, step) {\n\t\tswitch (arguments.length) {\n\t\t\tcase 0: from = 0; to = 0; step = 1; break;\n\t\t\tcase 1: to = from; from = 0; step = 1; break;\n\t\t\tcase 2: step = 1; break;\n\t\t}\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar i = from, r;\n\t\t\treturn function __rangeIterator__() {\n\t\t\t\tif (isNaN(i) || isNaN(to) || i >= to) {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t} else {\n\t\t\t\t\tr = i;\n\t\t\t\t\ti = i + step;\n\t\t\t\t\treturn r;\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `repeat(x, n=Infinity)` builds an iterable that repeats the element `x`\t`n` times (or\n\tforever by default).\n\t*/\n\t\"static repeat\": function repeat(x, n) {\n\t\tn = isNaN(n) ? Infinity : +n;\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar i = n;\n\t\t\treturn function __repeatIterator__() {\n\t\t\t\ti--;\n\t\t\t\tif (i < 0) {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t} else {\n\t\t\t\t\treturn x;\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `iterate(f, x, n=Infinity)` returns an iterable that repeatedly applies the function `f` to\n\tthe value `x`, `n` times (or indefinitely by default).\n\t*/\n\t\"static iterate\": function iterate(f, x, n) {\n\t\tn = isNaN(n) ? Infinity : +n;\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar i = n, value = x;\n\t\t\treturn function __iterateIterator__() {\n\t\t\t\ti--;\n\t\t\t\tif (i < 0) {\n\t\t\t\t\tthrow STOP_ITERATION;\n\t\t\t\t} else {\n\t\t\t\t\tvar result = value;\n\t\t\t\t\tvalue = f(value);\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\t/** `cycle(n=Infinity)` returns an iterable that loops n times over the elements of this\n\t`Iterable` (or forever by default).\n\t*/\n\tcycle: function cycle(n) {\n\t\tn = n === undefined ? Infinity : (+n);\n\t\tvar iterable = this;\n\t\treturn new Iterable(function __iter__() {\n\t\t\tvar i = n, iter = iterable.__iter__();\n\t\t\treturn function __cycleIterator__() {\n\t\t\t\twhile (i > 0) try {\n\t\t\t\t\treturn iter();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err === STOP_ITERATION && i > 1) {\n\t\t\t\t\t\ti--;\n\t\t\t\t\t\titer = iterable.__iter__();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow STOP_ITERATION; // In case n < 1.\n\t\t\t};\n\t\t});\n\t},\n\n\t// ## Utility definitions. #####################################################################\n\n\t/** The string conversion of an iterable (`toString(n=5)`) returns a string with the first `n`\n\telements. It ends with `...` if there are more elements in the sequence.\n\t*/\n\ttoString: function toString(n) {\n\t\tn = (n|0) || 5;\n\t\tvar elems = this.take(n + 1).toArray();\n\t\tif (elems.length > n) {\n\t\t\telems.pop();\n\t\t\treturn \"Iterable(\"+ JSON.stringify(elems).replace(/\\]$/, \" ...]\") +\")\";\n\t\t} else {\n\t\t\treturn \"Iterable(\"+ JSON.stringify(elems) +\")\";\n\t\t}\n\t}\n}); //// declare Iterable.\n\n/** `Iterable.EMPTY` is a singleton holding an empty iterable.\n*/\nIterable.EMPTY = new Iterable(function () {\n\treturn Iterable.prototype.stop;\n});\n\n/** `iterable(obj)` returns an iterable, either if `obj` is already one or builds one from it.\n*/\nvar iterable = exports.iterable = function iterable(obj) {\n\treturn typeof obj !== 'undefined' && obj !== null && typeof obj.__iter__ === 'function' ? obj : new Iterable(obj);\n};\n","/** # Future \n\nAn implementation of [futures](http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html),\nalso known as [promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)\nor [deferreds](http://api.jquery.com/category/deferred-object/). These are constructions oriented to \nsimplify the interaction between parallel threads. \n\nA [future](http://en.wikipedia.org/wiki/Futures_and_promises) represents a value that is being \ncalculated asynchronously. Callbacks are registered for when the value becomes available or an error\nraised.\n*/\nvar Future = exports.Future = declare({\n\t/** The constructor builds a resolved future if a value is given, else it builds a pending \n\tfuture.\n\t*/\n\tconstructor: function Future(value) {\n\t\tthis.state = 0;\n\t\tthis.callbacks = [[],[],[]];\n\t\tif (arguments.length > 0) {\n\t\t\tthis.resolve(value);\n\t\t}\n\t},\n\n\t/** The method `__future__` is used to get a future from an object. Many methods of `Future` \n\tthat deal with object that may or may not be futures use this to solve the ambiguity. In this \n\tcase it returns this object, but other objects may implement it in other ways.\n\t*/\n\t__future__: function __future__() {\n\t\treturn this;\n\t},\n\t\n\t'static __isFuture__': function __isFuture__(obj) {\n\t\treturn typeof obj !== 'undefined' && obj !== null && typeof obj.__future__ === 'function';\n\t},\n\t\n\t// ## State ####################################################################################\n\t\n\t/** A future may be in any of 4 states:\n\t\n\t+ 0 or `pending` means that the asynchronous process this future represents has not finished.\n\t\t\n\t+ 1 or `resolved` means that the asynchronous process this future represents has finished \n\tsuccessfully.\n\t\t\n\t+ 2 or `rejected` means that the asynchronous process this future represents has finished \n\tunsuccessfully.\n\t\t\n\t+ 3 or `cancelled` means that the asynchronous process this future represents was aborted.\n\t*/\n\tSTATES: ['pending', 'resolved', 'rejected', 'cancelled'],\n\t\n\tisPending: function isPending() {\n\t\treturn this.state === 0;\n\t},\n\n\tisResolved: function isResolved() {\n\t\treturn this.state === 1;\n\t},\n\n\tisRejected: function isRejected() {\n\t\treturn this.state === 2;\n\t},\n\n\tisCancelled: function isCancelled() {\n\t\treturn this.state === 3;\n\t},\n\t\n\t/** When a future is completed (either resolved or rejected) all the corresponding callbacks are\n\tcalled asynchronously with the given context and value.\n\t\n\tA future may not be completed more than once. Repeated calls to completion methods are ignored.\n\t*/\n\t__complete__: function __complete__(context, value, state) {\n\t\tvar future = this;\n\t\tif (this.state === 0) {\n\t\t\tthis.state = state;\n\t\t\tthis.__completion__ = [context, value];\n\t\t\tthis.callbacks[state - 1].forEach(function (callback) {\n\t\t\t\tif (typeof callback === 'function') {\n\t\t\t\t\tsetTimeout(callback.bind(context, value), 1);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this; // for chaining.\n\t},\n\n\t/** `resolve(value, context=this)` completes the future as `resolved`. This method should be \n\tcalled by the producer when its process is finished successfully.\n\t*/\n\tresolve: function resolve(value, context) {\n\t\treturn this.state === 0 ? this.__complete__(context || this, value, 1) : this;\n\t},\n\n\t/** `reject(reason, context=this)` completes the future as `rejected`. This method should be \n\tcalled by the producer thread when its process is aborted with an error.\n\t\n\tIf there aren't any `onRejected` callbacks registered, an `Error` is raised. This can be \n\t`reason` (if it is already an `Error` instance) or a new `Error` with `reason` as its message.\n\t*/\n\treject: function reject(reason, context) {\n\t\tif (this.state === 0) {\n\t\t\tthis.__complete__(context || this, reason, 2);\n\t\t\tif (this.callbacks[1].length < 1) {\n\t\t\t\tif (reason instanceof Error) {\n\t\t\t\t\tthrow reason;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(reason);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\n\t/** `cancel(reason)` completes the future as `cancelled`, disregarding all callbacks. This \n\tmethod may be called by either the producer or the consumer.\n\t*/\t\n\tcancel: function cancel(reason) {\n\t\treturn this.state === 0 ? this.__complete__(this, reason, 3) : this;\n\t},\n\n\ttoString: function toString() {\n\t\treturn 'Future:'+ this.STATES[this.state];\n\t},\n\t\n\t// ## Callbacks ################################################################################\n\t\n\t/** For a future to have some use, callback functions are registered to be called when it is \n\tcompleted. Callbacks registered after the future's completion are called right away if the state \n\tmatches, or ignored otherwise.\n\t*/\n\t__register__: function __register__(callback, state) {\n\t\tif (typeof callback === 'function') {\n\t\t\tif (this.state === 0) { // If future is pending...\n\t\t\t\tthis.callbacks[state - 1].push(callback);\n\t\t\t} else if (this.state === state) {\n\t\t\t\tsetTimeout(callback.bind(this.__completion__[0], this.__completion__[1]), 1);\n\t\t\t}\n\t\t\treturn this;\n\t\t} else {\n\t\t\tthrow new Error(\"Callback must be a function, and not (\"+ callback +\")!\");\n\t\t}\n\t},\n\n\t/** `done(callback...)` registers one or more callbacks to be called if this future gets \n\tresolved.\n\t*/\n\tdone: function done() {\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tthis.__register__(arguments[i], 1);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/** `fail(callback...)` registers one or more callbacks to be called if this future gets \n\trejected.\n\t*/\n\tfail: function fail() {\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tthis.__register__(arguments[i], 2);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/** `__onCancel__(callback...)` registers one or more callbacks to be called if this future gets\n\tcancelled. This is unusual, yet provided for testing purposes.\n\t*/\n\t__onCancel__: function __onCancel__() {\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tthis.__register__(arguments[i], 3);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/** `always(callback...)` registers one or more callbacks to be called if this future gets \n\teither resolved or rejected.\n\t*/\n\talways: function always() {\n\t\treturn this.done.apply(this, arguments).fail.apply(this, arguments);\n\t},\n\n\t/** Binding one future to another ties the completion of the second one to the completion of the\n\tfirst one.\n\t*/\n\tbind: function bind(future) {\n\t\tfuture.done(this.resolve.bind(this));\n\t\tfuture.fail(this.reject.bind(this));\n\t\tfuture.__onCancel__(this.cancel.bind(this));\n\t\treturn this;\n\t},\n\n\t/** `then(onResolved, onRejected)` is probably the most used function of promises. It represents\n\ta kind of asynchronous sequence operation, returning a new future which is resolved when this \n\tfuture is resolved, and rejected in the same way. \n\t\n\tThe given callbacks are used to calculate a new value to either resolution or rejection of the \n\tnew future object, and they themselves may be asynchronous returning futures.\n\t*/\n\tthen: function then(onResolved, onRejected) {\n\t\tvar result = new Future();\n\t\tthis.done(function (value) {\n\t\t\tvar futureValue;\n\t\t\ttry {\n\t\t\t\tvalue = onResolved ? onResolved(value) : value;\n\t\t\t\tif (__isFuture__(value)) {\n\t\t\t\t\tresult.bind(value.__future__());\n\t\t\t\t} else {\n\t\t\t\t\tresult.resolve(value);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tresult.reject(err);\n\t\t\t}\t\t\t\n\t\t});\n\t\tthis.fail(function (reason) {\n\t\t\tif (!onRejected) {\n\t\t\t\tresult.reject(reason);\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\treason = onRejected(reason);\n\t\t\t\t\tif (__isFuture__(reason)) {\n\t\t\t\t\t\tresult.bind(reason.__future__());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.resolve(reason);\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tresult.reject(err);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.__onCancel__(result.cancel.bind(result));\n\t\treturn result;\n\t},\n\t\n\t// ## Functions dealing with futures ###########################################################\n\n\t/** `when(value)` unifies asynchronous and synchronous behaviours. If `value` is a future it is\n\treturned as it is. Else a new future is returned resolved with the given value.\n\t*/\n\t'static when': function when(value) {\n\t\treturn __isFuture__(value) ? value.__future__() : new Future(value);\n\t},\n\n\t/** The static version of `then(value, onResolved, onRejected)` is another way of unifying \n\tasynchronous and synchronous behaviours. If `value` is a future, it behaves like the instance \n\t`then()`. Else it calls `onResolved` with the given value. \n\t\n\tThe main difference with using `Future.when()` is that if value is not a future, the result may \n\tnot be a future neither. This may be useful for avoiding asynchronism overhead when synchronism \n\tis more probable.\n\t*/\n\t'static then': function then(value, onResolved, onRejected) {\n\t\treturn __isFuture__(value) ? value.__future__().then(onResolved, onRejected) : onResolved(value);\n\t},\n\t\n\t/** `invoke(fn, _this, args...)` calls the function synchronously, returning a future resolved \n\twith the call's result. If an exceptions is raised, the future is rejected with it.\n\t*/\n\t'static invoke': function invoke(fn, _this) {\n\t\ttry {\n\t\t\treturn when(fn.apply(_this, Array.prototype.slice.call(arguments, 2)));\n\t\t} catch (error) {\n\t\t\tvar result = new Future();\n\t\t\tresult.reject(error);\n\t\t\treturn result;\n\t\t}\n\t},\n\n\t/** `all(futures)` builds a future that is resolved if all the given futures get resolved, or \n\trejected if one gets rejected. If no futures are given, the result is resolved with [].\n\t*/\n\t'static all': function all(futures) {\n\t\tfutures = Array.isArray(futures) ? futures : iterable(futures).toArray();\n\t\tvar result = new Future(),\n\t\t\tcount = futures.length,\n\t\t\tvalues = new Array(count), future,\n\t\t\tdoneCallback = function (index, value) {\n\t\t\t\tvalues[index] = value;\n\t\t\t\tif (--count < 1) {\n\t\t\t\t\tresult.resolve(values);\n\t\t\t\t}\n\t\t\t};\n\t\tif (count < 1) {\n\t\t\tresult.resolve([]);\n\t\t} else for (var i = 0; i < futures.length; i++) {\n\t\t\tfuture = when(futures[i]);\n\t\t\tfuture.done(doneCallback.bind(this, i));\n\t\t\tfuture.fail(result.reject.bind(result));\n\t\t\tfuture.__onCancel__(result.cancel.bind(result));\n\t\t}\n\t\treturn result;\n\t},\n\n\t/** `any(futures)` builds a future that is resolved if any of the given futures are resolved, or\n\trejected if all are rejected. If no futures are given, the result is rejected with undefined.\n\t*/\n\t'static any': function any(futures) {\n\t\tfutures = iterables.iterable(futures).toArray();\n\t\tvar result = new Future(), \n\t\t\tcount = futures.length,\n\t\t\tvalues = new Array(count), future;\n\t\tif (count < 1) {\n\t\t\tresult.reject();\n\t\t} else for (var i = 0; i < futures.length; i++) {\n\t\t\tfuture = when(futures[i]);\n\t\t\tfuture.fail((function (index) {\n\t\t\t\treturn function (value) {\n\t\t\t\t\tvalues[index] = value;\n\t\t\t\t\tcount--;\n\t\t\t\t\tif (count < 1) {\n\t\t\t\t\t\tresult.reject(value);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t})(i));\n\t\t\tfuture.done(result.resolve.bind(result));\n\t\t\tfuture.__onCancel__(result.cancel.bind(result));\n\t\t}\n\t\treturn result;\n\t},\n\n\t/** `sequence(xs, f=None)` evaluates all values and futures in the iterable `xs` in sequence. If\n\tdefined, the function f is called for each value.\n\t*/\n\t'static sequence': function sequence(xs, f) {\n\t\tvar result = new Future(), x,\n\t\t\trejection = result.reject.bind(result),\n\t\t\tit = iterable(xs).__iter__(),\n\t\t\taction = function action(lastValue) {\n\t\t\t\ttry {\n\t\t\t\t\tx = it();\n\t\t\t\t\tif (f) {\n\t\t\t\t\t\treturn when(x).then(f, rejection).then(action, rejection);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn when(x).then(action, rejection);\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err === STOP_ITERATION) {\n\t\t\t\t\t\tresult.resolve(lastValue);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.reject(err);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\taction();\n\t\treturn result;\n\t},\n\n\t/** `doWhile(action, condition)` performs the action until the condition fails. The action is \n\tfirst called without arguments, and afterwards it is called with the previous value. The \n\tcondition is always called with the last value returned by action.\n\t\t\n\tBoth action and condition may return futures. The condition by default is the boolean conversion\n\tof the action's returned value.\n\t*/\n\t'static doWhile': function doWhile(action, condition) {\n\t\tcondition = condition || function (value) {\n\t\t\treturn !!value;\n\t\t};\n\t\tvar loopEnd = new Future(),\n\t\t\treject = loopEnd.reject.bind(loopEnd);\n\t\tfunction loop(value) {\n\t\t\tFuture.invoke(condition, null, value).then(function (checks) {\n\t\t\t\tif (checks) {\n\t\t\t\t\tFuture.invoke(action, null, value).then(loop, reject);\n\t\t\t\t} else {\n\t\t\t\t\tloopEnd.resolve(value);\n\t\t\t\t}\n\t\t\t}, reject);\n\t\t}\n\t\tFuture.invoke(action).then(loop, reject);\n\t\treturn loopEnd;\n\t},\n\n\t/** `whileDo(condition, action)` is similar to `doWhile`, but evaluates the condition first with\n\tno arguments.\n\t*/\n\t'static whileDo': function whileDo(condition, action) {\n\t\treturn Future.invoke(condition).then(function (checks) {\n\t\t\treturn Future.doWhile(action, condition);\n\t\t});\n\t},\n\n\t/** `delay(ms, value)` return a future that will be resolved with the given value after the \n\tgiven time in milliseconds. Time is forced to be at least 10ms. If value is undefined, the \n\ttimestamp when the function is called is used.\n\t*/\n\t'static delay': function delay(ms, value) {\n\t\tms = isNaN(ms) ? 10 : Math.max(+ms, 10);\n\t\tvalue = typeof value === 'undefined' ? Date.now() : value;\n\t\tvar result = new Future();\n\t\tsetTimeout(result.resolve.bind(result, value), ms);\n\t\treturn result;\n\t},\n\n\t/** `retrying(f, t=10, delay=100ms, delayFactor=2, maxDelay=5min)` calls the function `f` upto \n\t`t` times until it returns a value or a future that is resolved. Each time is separated by a \n\t`delay` that gets increased by `delayFactor` upto `maxDelay`.\n\t\n\tThis function is meant to simplify the implementation of retry schemes, e.g. AJAX calls.\n\t*/\n\t'static retrying': function retrying(f, times, delay, delayFactor, maxDelay) {\n\t\ttimes = isNaN(times) ? 10 : +times;\n\t\treturn times < 1 ? Future.invoke(f) : Future.invoke(f).then(undefined, function () {\n\t\t\tdelay = isNaN(delay) ? 100 : +delay;\n\t\t\tdelayFactor = isNaN(delayFactor) ? 2.0 : +delayFactor;\n\t\t\tmaxDelay = isNaN(maxDelay) ? 300000 : +maxDelay;\n\t\t\treturn Future.delay(delay).then(function () {\n\t\t\t\treturn Future.retrying(f, times - 1, Math.min(maxDelay, delay * delayFactor), delayFactor, maxDelay);\n\t\t\t});\n\t\t});\n\t},\n\n\t/** `imports(...modules)` returns a future that loads the given modules using \n\t[RequireJS'](http://requirejs.org/) `require` function, and resolves to an array of the loaded \n\tmodules.\n\t*/\n\t'static imports': function imports() {\n\t\tvar result = new Future();\n\t\trequire(Array.prototype.slice.call(arguments), function () {\n\t\t\tresult.resolve(Array.prototype.slice.call(arguments));\n\t\t}, function (err) {\n\t\t\tresult.reject(err);\n\t\t});\n\t\treturn result;\n\t}\n}); // declare Future.\n\nvar when = Future.when,\n\t__isFuture__ = Future.__isFuture__;","/** # HttpRequest\n\nA wrapper of XMLHttpRequest, adding some functionality and dealing with\tasynchronism \nwith futures.\n*/\nvar HttpRequest = exports.HttpRequest = declare({ \n\tconstructor: function HttpRequest() {\n\t\tthis.__request__ = new XMLHttpRequest();\n\t},\n\t\n\t/** `request(method, url, content, headers, user, password)` opens the \n\trequest with the given method at the given url, sends the contents and \n\treturns a future that gets resolved when the request is responded.\n\t*/\n\trequest: function request(method, url, content, headers, user, password) {\n\t\tvar xhr = this.__request__,\n\t\t\tfuture = new Future();\n\t\txhr.open(method, url, true, user, password); // Always asynchronously.\n\t\tif (headers) {\n\t\t\tObject.getOwnPropertyNames(headers).forEach(function (id) {\n\t\t\t\txhr.setRequestHeader(id, headers[id]);\n\t\t\t});\n\t\t}\n\t\txhr.onreadystatechange = function () { // See <http://www.w3schools.com/ajax/ajax_xmlhttprequest_onreadystatechange.asp>.\n\t\t\tif (xhr.readyState == 4) {\n\t\t\t\tif (xhr.status == 200) {\n\t\t\t\t\tfuture.resolve(xhr);\n\t\t\t\t} else {\n\t\t\t\t\tfuture.reject(xhr);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(content);\n\t\treturn future;\n\t},\n\t\n\t/** `get(url, content, headers, user, password)` is a shortcut for a request \n\twith the GET method.\n\t*/\n\tget: function get(url, content, headers, user, password) {\n\t\treturn this.request('GET', url, content, headers, user, password);\n\t},\n\t\n\t/** `getText(url, content, headers, user, password)` makes a GET request and\n\treturns the response's text.\n\t*/\n\tgetText: function getText(url, content, headers, user, password) {\n\t\treturn this.get(url, content, headers, user, password).then(function (xhr) {\n\t\t\treturn xhr.responseText;\n\t\t});\n\t},\n\t\n\t/** `getJSON(url, content, headers, user, password)` makes a GET request and\n\tparses the response text as JSON.\n\t*/\n\tgetJSON: function getJSON(url, content, headers, user, password) {\n\t\treturn this.get(url, content, headers, user, password).then(function (xhr) {\n\t\t\treturn JSON.parse(xhr.responseText);\n\t\t});\n\t},\n\t\n\t/** `post(url, content, headers, user, password)` is a shortcut for a \n\trequest with the POST method.\n\t*/\n\tpost: function post(url, content, headers, user, password) {\n\t\treturn this.request('POST', url, content, headers, user, password);\n\t},\n\t\n\t/** `postJSON(url, content, headers, user, password)` makes a POST request \n\twith the content encoded with `JSON.stringify()`.\n\t*/\n\tpostJSON: function postJSON(url, content, headers, user, password) {\n\t\theaders = headers || {};\n\t\theaders['Content-Type'] = \"application/json\";\n\t\treturn this.post(url, JSON.stringify(content) || 'null', headers, user, password);\n\t}\t\n}); // declare HttpRequest.\n\n/** Most methods of HttpRequest have \"static\" analogues to simplify creating an\ninstance and using a method right away.\n*/\n['request', 'get', 'getJSON', 'getText', 'post', 'postJSON'\n].forEach(function (id) {\n\tHttpRequest[id] = function () {\n\t\treturn HttpRequest.prototype[id].apply(new HttpRequest(), arguments);\n\t};\n});","/** # Parallel\n\nWrapper for standard web workers, that includes bootstraping and a future oriented interface.\n*/\nvar Parallel = exports.Parallel = declare({\n\t/** The constructor may take a worker instance to deal with. If not given, a new worker is build \n\tusing `newWorker()`. If given, it must be properly initialized.\n\t*/\n\tconstructor: function Parallel(worker) {\n\t\tif (!worker) {\n\t\t\tworker = Parallel.newWorker();\n\t\t}\n\t\tworker.onmessage = this.__onmessage__.bind(this);\n\t\tthis.worker = worker;\n\t},\n\t\n\t/** `newWorker()` builds a new web worker. Loading `creatartis-base` in its environment. Sets up\n\ta message handler that evaluates posted messages as code, posting the results back.\n\t*/\n\t\"static newWorker\": function newWorker() {\n\t\tvar src = 'self.base = ('+ exports.__init__ +')();'+\n\t\t\t\t'self.onmessage = ('+ (function (msg) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.base.Future.when(eval(msg.data)).then(function (result) {\n\t\t\t\t\t\t\tself.postMessage(JSON.stringify({ result: result }));\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tself.postMessage(JSON.stringify({ error: err +'' }));\n\t\t\t\t\t}\n\t\t\t\t}) +');',\n\t\t\tblob = new Blob([src], { type: 'text/javascript' });\n\t\treturn new Worker(URL.createObjectURL(blob));\n\t},\t\n\t\n\t/** The handler for the `worker.onmessage` event is the `__onmessage__(msg)` method. It deals \n\twith the futures issued by `run()`.\n\t*/\n\t__onmessage__: function __onmessage__(msg) {\n\t\tvar future = this.__future__;\n\t\tif (future) {\n\t\t\tthis.__future__ = null;\n\t\t\ttry {\n\t\t\t\tvar data = JSON.parse(msg.data);\n\t\t\t\tif (data.error) {\n\t\t\t\t\tfuture.reject(data.error);\n\t\t\t\t} else {\n\t\t\t\t\tfuture.resolve(data.result);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tfuture.reject(err);\n\t\t\t}\n\t\t}\n\t},\n\t\n\t/** `run(code)` sends the code to run in the web worker in parallel.\n\t\n\tWarning! This method will raise an error if it is called while a previous execution is still \n\trunning.\n\t*/\n\trun: function run(code) {\n\t\tif (this.__future__) {\n\t\t\tthrow new Error('Worker is working!');\n\t\t}\n\t\tthis.__future__ = new Future();\n\t\tthis.worker.postMessage(code +'');\n\t\treturn this.__future__;\n\t}, \n\t\n\t/** A _\"static\"_ version of `run(code)` is provided also. It creates a web worker to run this \n\tcode in parallel, and returns a future for its result. After its finished the web worker is \n\tterminated.\n\t*/\n\t\"static run\": function run(code) {\n\t\tvar parallel = new Parallel();\n\t\treturn parallel.run(code).always(function () {\n\t\t\tparallel.worker.terminate();\n\t\t});\n\t},\n\t\n\t/** The method `importScripts` runs the same call in the worker.\n\t*/\n\timportScripts: function importScripts() {\n\t\treturn this.run('importScripts('+ \n\t\t\tArray.prototype.slice.call(arguments).map(JSON.stringify).join(',') +');');\n\t},\n\t\n\t/** `loadModule` loads a module in the worker. The module has to have a `__name__`, an \n\t`__init__` function that builds the module and a `__dependencies__` array of modules.\n\t*/\n\tloadModule: function loadModule(module, recursive) {\n\t\tvar parallel = this;\n\t\treturn Future.sequence(recursive ? module.__dependencies__ : [], function (dep) {\n\t\t\treturn parallel.loadModule(dep, recursive);\n\t\t}).then(function () {\n\t\t\treturn parallel.run('self.'+ module.__name__ +' || (self.'+ module.__name__ +'=('+ \n\t\t\t\tmodule.__init__ +')('+ \tmodule.__dependencies__.map(function (dep) {\n\t\t\t\t\treturn dep.__name__;\n\t\t\t\t}).join(',') +')), \"OK\"'\n\t\t\t);\n\t\t});\n\t},\n\t\n\t/** `consoleLog` is a version of `run` that logs the resulting value in the `console`. It is \n\tuseful for testing.\n\t*/\n\tconsoleLog: function consoleLog(code) {\n\t\tvar f = this.run(code);\n\t\tf.done(console.log);\n\t\treturn f;\n\t}\n}); // declare Parallel.","/** # Events\n\nEvents is a simple event handler that manages callbacks registered as listeners.\n*/\nvar Events = exports.Events = declare({\n/** The constructor argument may include:\n\n+ `maxListeners=Infinity`: Maximum amount of listeners these events can have.\n\t\n+ `isOpen=true`: An open Events accepts listeners to any event. Otherwise \n\tevent names\thave to be specified previously via the 'events' property in the \n\tconfiguration.\n\t\n+ `events=[]`: An array of event identifiers to be managed.\n*/\n\tconstructor: function Events(config) {\n\t\tinitialize(this, config)\n\t\t\t.number('maxListeners', { defaultValue: Infinity, coerce: true, minimum: 1 })\n\t\t\t.bool('isOpen', { defaultValue: true });\n\t\tvar __listeners__ = this.__listeners__ = {};\n\t\tif (config && Array.isArray(config.events)) {\n\t\t\tconfig.events.forEach(function (eventName) {\n\t\t\t\t__listeners__[eventName] = [];\n\t\t\t});\n\t\t}\n\t},\n\n\t/** `listeners(eventName)` returns an array with the listeners for the \n\tevent with the given identifier.\n\t*/\n\tlisteners: function listeners(eventName) {\n\t\tif (this.__listeners__.hasOwnProperty(eventName)) {\n\t\t\treturn this.__listeners__[eventName].slice(); // Return a copy of the array.\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t},\n\t\n\t/** `emit(eventName, ...args)` emits an event with the given arguments. \n\tListeners' callbacks are called asynchronously with the provided args. \n\t\n\tIf `eventName` is an array instead of a string, all events in the array are\n\temitted with the given args.\n\t*/\n\temit: function emit(eventName) {\n\t\tvar args;\n\t\tif (Array.isArray(eventName)) {\n\t\t\tvar events = this;\n\t\t\targs = Array.prototype.slice.call(arguments);\n\t\t\teventName.forEach(function (name) {\n\t\t\t\targs[0] = name;\n\t\t\t\tevents.emit.apply(this, args);\n\t\t\t});\n\t\t}\n\t\tif (!this.__listeners__.hasOwnProperty(eventName)) {\n\t\t\treturn false;\n\t\t}\n\t\targs = Array.prototype.slice.call(arguments, 1);\n\t\tvar listeners = this.__listeners__[eventName];\n\t\tthis.__listeners__[eventName] = this.__listeners__[eventName]\n\t\t\t.filter(function (listener) {\n\t\t\t\tif (listener[1] > 0) {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\treturn listener[0].apply(global, args);\n\t\t\t\t\t}, 1);\n\t\t\t\t\tlistener[1]--;\n\t\t\t\t\treturn listener[1] > 0;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\treturn true;\n\t},\n\t\n\t/** `on(eventName, callback, times=Infinity)` registers a callback function\n\tto listen to the event the given number of times, or always by default.\n\t*/\n\ton: function on(eventName, callback, times) {\n\t\tif (Array.isArray(eventName)) {\n\t\t\tvar events = this;\n\t\t\teventName.forEach(function (name) {\n\t\t\t\tevents.on(name, callback, times);\n\t\t\t});\n\t\t} else {\n\t\t\tif (!this.__listeners__.hasOwnProperty(eventName)) {\n\t\t\t\traiseIf(!this.isOpen, \"Event \", eventName, \" is not defined.\");\n\t\t\t\tthis.__listeners__[eventName] = [];\n\t\t\t}\n\t\t\tvar listeners = this.__listeners__[eventName];\n\t\t\traiseIf(this.listeners.length >= this.maxListeners,\n\t\t\t\t\"Cannot have more than \", this.maxListeners, \" listeners for event \", eventName, \".\");\n\t\t\ttimes = (+times) || Infinity;\n\t\t\tlisteners.push([callback, times]);\n\t\t}\n\t},\n\n\t/** `once(eventName, callback)` registers a callback to listen to the event\n\tonly once.\n\t*/\n\tonce: function once(eventName, callback) {\n\t\treturn this.on(eventName, callback, 1);\n\t},\n\n\t/** `off(eventName, callback)` deregisters the callback from the event.\n\t*/\n\toff: function off(eventName, callback) {\n\t\tif (Array.isArray(eventName)) {\n\t\t\tvar events = this;\n\t\t\teventName.forEach(function (name) {\n\t\t\t\tevents.off(name, callback);\n\t\t\t});\n\t\t} else if (this.__listeners__.hasOwnProperty(eventName)) {\n\t\t\tthis.__listeners__[eventName] = this.__listeners__[eventName]\n\t\t\t\t.filter(function (listener) {\n\t\t\t\t\treturn listener[0] !== callback;\n\t\t\t\t});\n\t\t}\n\t}\n}); // declare Events.\n","/** # Randomness\n\nRandomness is the base class for pseudorandom number generation algorithms and related functions. A \nlimitation with Javascript's `Math.random` function is that it cannot be seeded. This hinders its \nuse for simulations and simular purposes.\n*/\nvar Randomness = exports.Randomness = declare({\n\t/** The `Randomness` instances are build with a `generator` function. This is a function that is \n\tcalled without any parameters and returns a random number between 0 (inclusive) and 1 \n\t(exclusive). If none is given the standard `Math.random´ is used.\n\t*/\n\tconstructor: function Randomness(generator) {\n\t\tif (typeof generator === 'function') {\n\t\t\tthis.__random__ = generator;\n\t\t}\n\t},\n\n\t__random__: Math.random,\n\t\n\t/** The basic use of the pseudorandom number generator is through the method `random`. Called \n\twithout arguments returns a random number in [0,1). Called with only the first argument x, \n\treturns a random number in [0, x). Called with two arguments (x, y) return a random number in \n\t[x,y).\n\t*/\n\trandom: function random() {\n\t\tvar n = this.__random__();\n\t\tswitch (arguments.length) {\n\t\t\tcase 0: return n;\n\t\t\tcase 1: return n * arguments[0];\n\t\t\tdefault: return (1 - n) * arguments[0] + n * arguments[1];\n\t\t}\n\t},\n\n\t/** The method `randomInt` behaves the same way `random` does, but returns an integer instead.\n\t*/\n\trandomInt: function randomInt() {\n\t\treturn Math.floor(this.random.apply(this, arguments));\n\t},\n\n\t/** The method `randomBool` tests against a probability (50% by default), yielding true with the \n\tgiven chance, or else false.\n\t*/\n\trandomBool: function randomBool(prob) {\n\t\treturn this.random() < (isNaN(prob) ? 0.5 : +prob);\n\t},\n\n\t// ## Sequence handling ########################################################################\n\n\t/** A shortcut for building an array of n random numbers calling is `randoms`. Numbers are \n\tgenerated calling `random` many times.\n\t*/\n\trandoms: function randoms(n) {\n\t\tvar args = Array.prototype.slice.call(arguments, 1),\n\t\t\tresult = [], i;\n\t\tn = +n;\n\t\tfor (i = 0; i < n; i++) {\n\t\t\tresult.push(this.random.apply(this, args));\n\t\t}\n\t\treturn result;\n\t},\n\n\t/** To randomnly selects an element from a sequence `xs` use `choice(xs)`. If more than one \n\targument is given, the element is chosen from the argument list.\n\t*/\n\tchoice: function choice(from) {\n\t\tfrom = arguments.length > 1 ? Array.prototype.slice.call(arguments) : \n\t\t\tArray.isArray(from) ? from : \n\t\t\titerable(from).toArray();\n\t\treturn from.length < 1 ? undefined : from[this.randomInt(from.length)];\n\t},\n\n\t/** To randomnly selects `n` elements from a sequence `xs` use `choices(n, xs)`. If more than \n\ttwo arguments are given, the elements are taken from the second arguments on.\n\t*/\n\tchoices: function choices(n, from) {\n\t\treturn this.split.apply(this, arguments)[0];\n\t},\n\t\n\t/** To take `n` elements from a sequence `xs` randomnly use `split(n, xs)`. It returns an array \n\t`[A, B]` with `A` being the taken elements and `B` the remaining ones. If more than two \n\targuments are given, elements are taken from the second argument on.\n\t*/\n\tsplit: function split(n, from) {\n\t\tfrom = arguments.length > 2 ? Array.prototype.slice.call(arguments) : iterable(from).toArray();\n\t\tvar r = [];\n\t\tfor (n = Math.min(from.length, Math.max(+n, 0)); n > 0; n--) {\n\t\t\tr = r.concat(from.splice(this.randomInt(from.length), 1));\n\t\t}\n\t\treturn [r, from];\n\t},\n\n\t/** The method `shuffle(xs)` randomnly rearranges elements in xs; returning a copy.\n\t*/\n\tshuffle: function shuffle(elems) { //TODO This can be optimized by making random swaps.\n\t\treturn this.choices(elems.length, elems);\n\t},\n\n\t// ## Weighted choices #########################################################################\n\t\n\t/** Given a sequence of `weightedValues` (pairs `[value, weight]`), a normalization scales all \n\tweights proportionally, so they add up to 1 and hence can be treated as probabilities. If any\n\tweight is negative, an error is raised.\n\t*/\n\tnormalizeWeights: function normalizeWeights(weightedValues) {\n\t\tweightedValues = iterable(weightedValues);\n\t\tvar sum = 0, length = 0;\n\t\tweightedValues.forEachApply(function (value, weight) {\n\t\t\traiseIf(weight < 0, \"Cannot normalize with negative weights!\");\n\t\t\tsum += weight;\n\t\t\tlength++;\n\t\t});\n\t\treturn weightedValues.mapApply(function (value, weight) {\n\t\t\treturn [value, sum === 0 ? 1 / length : weight / sum];\n\t\t});\n\t},\n\t\n\t/** A `weightedChoice` is a choice where each value has its own probability. The given \n\t`weightedValues` must be normalized, i.e. the weights must add up to 1.\n\t*/\n\tweightedChoice: function weightedChoice(weightedValues) {\n\t\tvar chance = this.random(), result;\n\t\titerable(weightedValues).forEachApply(function (value, weight) {\n\t\t\tchance -= weight;\n\t\t\tif (chance <= 0) {\n\t\t\t\tresult = value;\n\t\t\t\tIterable.stop();\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\t\n\t/** The method `weightedChoices` performs `n` weighted choices, without repeating values.\n\t*/\n\tweightedChoices: function weightedChoices(n, weightedValues) {\n\t\tweightedValues = iterable(weightedValues).toArray();\n\t\tvar maxProb = 1, results = [], random;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\trandom = this.random(maxProb);\n\t\t\titerable(weightedValues).forEachApply(function (value, weight, i) {\n\t\t\t\trandom -= weight;\n\t\t\t\tif (random <= 0) {\n\t\t\t\t\tresults.push(value);\n\t\t\t\t\tmaxProb -= weight;\n\t\t\t\t\tweightedValues.splice(i, 1); // Remove selected element.\n\t\t\t\t\tIterable.stop();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn results;\n\t},\n\n\t// ## Distributions ############################################################################\n\n\t/** An `averagedDistribution(times)` of a `Randomness` instance is another `Randomness` instance \n\tbased on this one, but generating numbers by averaging its random values a given number of \n\t`times` (2 by default). The result is an aproximation of the normal distribution as times\n\tincreases.\n\t*/\n\taveragedDistribution: function averagedDistribution(n) {\n\t\tn = Math.max(+n, 2);\n\t\tvar randomFunc = this.__random__;\n\t\treturn new Randomness(function () { \n\t\t\tvar s = 0.0;\n\t\t\tfor (var i = 0; i < n; i++) {\n\t\t\t\ts += randomFunc();\n\t\t\t}\n\t\t\treturn s / n;\n\t\t});\n\t},\n\t\n\t// ## Utilities ################################################################################\n\t\n\t/** Serialization and materialization using Sermat.\n\t*/\n\t'static __SERMAT__': {\n\t\tidentifier: 'Randomness',\n\t\tserializer: function serialize_Randomness(obj) {\n\t\t\treturn obj.__random__ !== Math.random ? [obj.__random__] : [];\n\t\t},\n\t\tmaterializer: function materialize_Randomness(obj, args) {\n\t\t\treturn args && (args.length < 1 ? Randomness.DEFAULT : new Randomness(args[0]));\n\t\t}\n\t}\n}); //- declare Randomness.\n\n// ## Default generator ############################################################################\n\n/** `Randomness.DEFAULT` holds the default static instance, provided for convenience. Uses \n`Math.random()`.\n*/\nRandomness.DEFAULT = new Randomness();\n\n['random', 'randomInt', 'randomBool', 'choice', 'split', 'choices', 'shuffle',\n 'averagedDistribution'\n].forEach(function (id) {\n\tRandomness[id] = Randomness.DEFAULT[id].bind(Randomness.DEFAULT);\n});\n\n// ## Algorithms ###################################################################################\n\n// ### Linear congruential #########################################################################\n\n/** `Randomness.LinearCongruential` builds a pseudorandom number generator constructor implemented \nwith the [linear congruential algorithm](http://en.wikipedia.org/wiki/Linear_congruential_generator).\nIt also contain the following shortcuts to build common variants:\n*/\nvar LinearCongruential = Randomness.LinearCongruential = declare(Randomness, {\n\tconstructor: function LinearCongruential(m, a, c, seed) {\n\t\tvar i = isNaN(seed) ? Date.now() : Math.floor(seed);\n\t\tthis.__arguments__ = [m, a, c, i];\n\t\tthis.__random__ = function __random__() {\n\t\t\treturn (i = (a * i + c) % m) / m;\n\t\t};\n\t},\n\t\n\t'static __SERMAT__': {\n\t\tidentifier: 'LinearCongruential',\n\t\tserializer: function serializer_LinearCongruential(obj) {\n\t\t\treturn obj.__arguments__;\n\t\t}\n\t},\n\t\n\t/** + `numericalRecipies(seed)`: builds a linear congruential pseudorandom number generator as \n\t\tit is specified in [Numerical Recipies](http://www.nr.com/).\n\t*/\n\t'static numericalRecipies': function (seed) {\n\t\treturn new LinearCongruential(0xFFFFFFFF, 1664525, 1013904223, seed);\n\t},\n\t\n\t/** + `borlandC(seed)`: builds a linear congruential pseudorandom number generator as it used by\n\t\tBorland C/C++.\n\t*/\n\t'static borlandC': function (seed) {\n\t\treturn new LinearCongruential(0xFFFFFFFF, 22695477, 1, seed);\n\t},\n\t\n\t/** + `glibc(seed)`: builds a linear congruential pseudorandom number generator as it used by\n\t\t[glibc](http://www.mscs.dal.ca/~selinger/random/).\n\t*/\n\t'static glibc': function (seed) {\n\t\treturn new LinearCongruential(0xFFFFFFFF, 1103515245, 12345, seed);\n\t}\n});\n\n// ### Mersenne twister ############################################################################\n\n/** The method `Randomness.mersenneTwister` returns a pseudorandom number generator constructor \nimplemented with the [Mersenne Twister algorithm](http://en.wikipedia.org/wiki/Mersenne_twister#Pseudocode).\n*/\nRandomness.MersenneTwister = (function (){\n\t/** Bit operations in Javascript deal with signed 32 bit integers. This algorithm deals with\n\tunsigned 32 bit integers. That is why this function is necessary.\n\t*/\n\tfunction unsigned(n) {\n\t\treturn n < 0 ? n + 0x100000000 : n;\n\t}\n\t\n\tfunction initialize(seed) {\n\t\tvar numbers = new Array(624),\n\t\t\tlast;\n\t\tnumbers[0] = last = seed;\n\t\tfor (var i = 1; i < 624; ++i) {\n\t\t\tnumbers[i] = last = (0x6C078965 * unsigned(last ^ (last << 30)) + i) % 0xFFFFFFFF;\n\t\t}\n\t\treturn numbers;\n\t}\n\t\n\tfunction generate(numbers) {\n\t\tfor(var i = 0; i < 624; ++i) {\n\t\t\tvar y = (numbers[i] & 0x80000000) | (numbers[(i+1) % 624] & 0x7FFFFFFF);\n\t\t\tnumbers[i] = unsigned(numbers[(i + 397) % 624] ^ (y * 2));\n\t\t\tif ((y & 1) !== 0) {\n\t\t\t\tnumbers[i] = unsigned(numbers[i] ^ 0x9908B0DF);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn declare(Randomness, {\n\t\tconstructor: function MersenneTwister(seed) {\n\t\t\tthis.__seed__ = isNaN(seed) ? Date.now() : Math.floor(seed);\n\t\t\tvar numbers = initialize(this.__seed__),\n\t\t\t\tindex = 0;\n\t\t\tthis.__random__ = function () {\n\t\t\t\tif (index === 0) {\n\t\t\t\t\tgenerate(numbers);\n\t\t\t\t}\n\t\t\t\tvar y = numbers[index];\n\t\t\t\ty = unsigned(y ^ (y << 11));\n\t\t\t\ty = unsigned(y ^ ((y >>> 7) & 0x9D2C5680));\n\t\t\t\ty = unsigned(y ^ ((y >>> 15) & 0xEFC60000));\n\t\t\t\ty = unsigned(y ^ (y << 18));\n\t\t\t\tindex = (index + 1) % 624;\n\t\t\t\treturn y / 0xFFFFFFFF;\n\t\t\t};\n\t\t},\n\t\t\n\t\t'static __SERMAT__': {\n\t\t\tidentifier: 'MersenneTwister',\n\t\t\tserializer: function serializer_MersenneTwister(obj) {\n\t\t\t\treturn [obj.__seed__];\n\t\t\t}\n\t\t},\n\t});\n})();","/** # Chronometer\n\nA Chronometer is a simple tool to measure time.\n*/\nvar Chronometer = exports.Chronometer = declare({\n\t/** The constructor may take a timestamp to initiate the chronometer, \n\totherwise it uses the current time.\n\t*/\n\tconstructor: function Chronometer(t) {\n\t\tthis.reset(t);\n\t},\n\t\n\t/** Resetting the chronometer sets its `__timestamp__` property to the given\n\ttime or now by default.\n\t*/\n\treset: function reset(t) {\n\t\treturn this.__timestamp__ = t || Date.now();\n\t},\n\n\t/** `time()` gets the elapsed time since the creation or resetting of the\n\tchronometer.\n\t*/\n\ttime: function time() {\n\t\treturn Date.now() - this.__timestamp__;\n\t},\n\n\t/** `tick(t=now)` gets the elapsed time since the creation or resetting of \n\tthe chronometer, and resets it.\n\t*/\n\ttick: function tick(t) {\n\t\tvar result = this.time();\n\t\tthis.reset(t);\n\t\treturn result;\n\t},\n\n\t/** `chronometer(f, times=1)` executes the parameterless function `f` the \n\tgiven number of `times` (1 by default) and logs the time each run takes. \n\t\n\tFinally, returns the average of all those measurements.\n\t*/\n\tchronometer: function chronometer(f, times) {\n\t\ttimes = times || 1;\n\t\tvar total = 0.0;\n\t\tfor (var i = 0; i < times; i++) {\n\t\t\tthis.reset();\n\t\t\tf.call(this);\n\t\t\ttotal += this.time();\n\t\t}\n\t\treturn total / times;\n\t}\n}); // declare Chronometer.\n","/** # Statistic\n\nComponent representing statistical accounting for one concept.\n*/\nvar Statistic = exports.Statistic = declare({\n\t/** Every statistic object has a set of keys that identify the numerical value it represents. \n\tThis can be as simple as one string, or an object with many values for different aspects of the \n\tstatistic.\n\t*/\n\tconstructor: function Statistic(keys) {\n\t\tif (typeof keys !== 'undefined') {\n\t\t\tthis.keys = typeof keys === 'object' ? \t(keys !== null ? keys : '') : keys +'';\n\t\t}\n\t\tthis.reset(); // At first all stats must be reset.\n\t},\n\t\n\t/** Resetting a statistic deletes all registered values and sets all properties to zero.\n\t*/\n\treset: function reset() {\n\t\tthis.__count__ = 0; \n\t\tthis.__sum__ = 0.0; \n\t\tthis.__sqrSum__ = 0.0; \n\t\tthis.__min__ = Infinity;\n\t\tthis.__max__ = -Infinity;\n\t\tthis.__minData__ = undefined;\n\t\tthis.__maxData__ = undefined;\n\t\treturn this; // For chaining.\n\t},\n\n\t/** An Statistic object may apply to a certain concept or not, depending on its `keys`. When \n\tdealing with sets of keys (objects), `applies(keys)` checks if all the given keys are this \n\tstatistic's keys.\n\t*/\n\tapplies: function applies(keys) {\n\t\tif (typeof keys === 'undefined') {\n\t\t\treturn false;\n\t\t} else if (keys === null) {\n\t\t\tkeys = '';\n\t\t}\n\t\tif (typeof this.keys === 'undefined') {\n\t\t\treturn false;\n\t\t} else if (typeof this.keys === 'object') {\n\t\t\tvar i;\n\t\t\tif (typeof keys === 'object') {\n\t\t\t\tif (Array.isArray(this.keys) && Array.isArray(keys)) {\n\t\t\t\t\tfor (i in keys) {\n\t\t\t\t\t\tif (this.keys.indexOf(keys[i]) < 0) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else { \n\t\t\t\t\tfor (i in keys) {\n\t\t\t\t\t\tif (typeof this.keys[i] === 'undefined' || keys[i] !== this.keys[i]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\treturn typeof keys !== 'object' && this.keys === keys +'';\n\t\t}\n\t},\n\t\n\t// ## Querying statistics ######################################################################\n\t\n\t/** `count()` gets the current count, or 0 if values have not been added.\n\t*/\n\tcount: function count() {\n\t\treturn this.__count__;\n\t},\n\t\n\t/** `sum()` gets the current sum, or zero if values have not been added.\n\t*/\n\tsum: function sum() {\n\t\treturn this.__sum__;\n\t},\n\t\n\t/** `squareSum()` gets the current sum of squares, or zero if values have not been added.\n\t*/\n\tsquareSum: function squareSum() {\n\t\treturn this.__sqrSum__;\n\t},\n\t\n\t/** `minimum()` gets the current minimum, or Infinity if values have not been added.\n\t*/\n\tminimum: function minimum() {\n\t\treturn this.__min__;\n\t},\n\t\n\t/** `maximum()` gets the current maximum, or -Infinity if values have not been added.\n\t*/\n\tmaximum: function maximum() {\n\t\treturn this.__max__;\n\t},\n\t\n\t/** `minData()` gets the data associated with the current minimum, or `undefined` if there is \n\tnot one.\n\t*/\n\tminData: function minData() {\n\t\treturn this.__minData__;\n\t},\n\t\n\t/** `maxData()` gets the data associated with the current maximum, or `undefined` if there is \n\tnot one.\n\t*/\n\tmaxData: function maxData() {\n\t\treturn this.__maxData__;\n\t},\n\n\t/** `average()` calculates the current average, or zero if values have not been added.\n\t*/\n\taverage: function average() {\t\n\t\tvar count = this.count();\n\t\treturn count > 0 ? this.sum() / count : 0.0;\n\t},\n\t\n\t/** `variance(center=average)` calculates current variance, as the average squared difference of\n\teach element with the center, which is equal to the average by default. Returns zero if values \n\thave not been added.\n\t*/\n\tvariance: function variance(biased, center) {\n\t\tif (isNaN(center)) {\n\t\t\tcenter = this.average();\n\t\t}\n\t\tvar count = this.count(),\n\t\t\tv = count > 1 ? center * center + (this.squareSum() - 2 * center * this.sum()) / count : 0.0;\n\t\treturn biased || count < 2 ? v : v * count / (count - 1);\n\t},\n\n\t/** `standardDeviation(center=average)` calculates current standard deviation, as the square \n\troot of the current variance.\n\t*/\n\tstandardDeviation: function standardDeviation(biased, center) {\n\t\treturn Math.sqrt(this.variance(center), biased);\n\t},\n\t\n\t// ## Updating statistics ######################################################################\n\t\n\t/** Values are added to a statistic with `add(value, data=none)`, which updates the statistic. \n\tOptionally data about the instances can be attached.\n\t*/\n\tadd: function add(value, data) {\n\t\tif (value === undefined) {\n\t\t\tvalue = 1;\n\t\t} else if (isNaN(value)) {\n\t\t\traise(\"Statistics.add(): Value \", value, \" cannot be added.\"); \n\t\t}\n\t\tthis.__count__ += 1;\n\t\tthis.__sum__ += value;\n\t\tthis.__sqrSum__ += value * value;\n\t\tif (this.__min__ > value) {\n\t\t\tthis.__min__ = value;\n\t\t\tthis.__minData__ = data;\n\t\t}\n\t\tif (this.__max__ < value) {\n\t\t\tthis.__max__ = value;\n\t\t\tthis.__maxData__ = data;\n\t\t}\n\t\treturn this; // For chaining.\n\t},\n\n\t/** `addAll(values, data=none)` adds all the given values (using `add()`).\n\t*/\n\taddAll: function addAll(values, data) {\t\n\t\tfor (var i = 0; i < values.length; i++) {\n\t\t\tthis.add(values[i], data);\n\t\t}\n\t\treturn this; // For chaining.\n\t},\n\t\n\t/** `gain(value, factor=DEFAULT_GAIN_FACTOR, data=none)` is similar to `add()`, but fades \n\tprevious values by multiplying them by the given factor. This is useful to implement schemes \n\tsimilar to exponential moving averages.\n\t*/\n\tgain: function gain(value, factor, data) {\n\t\tfactor = isNaN(factor) ? this.DEFAULT_GAIN_FACTOR : +factor;\n\t\tthis.__count__ *= factor;\n\t\tthis.__sum__ *= factor;\n\t\tthis.__sqrSum__ *= factor;\n\t\treturn this.add(value, data);\n\t},\n\n\t/** The `DEFAULT_GAIN_FACTOR=0.99` is used in the `gain()` method.\n\t*/\n\tDEFAULT_GAIN_FACTOR: 0.99,\n\t\n\t/** `gainAll(values, factor=DEFAULT_GAIN_FACTOR, data=none)` gains all the given values (using \n\t`gain()`).\n\t*/\n\tgainAll: function gainAll(values, factor, data) {\t\n\t\tfor (var i = 0; i < values.length; i++) {\n\t\t\tthis.gain(values[i], factor, data);\n\t\t}\n\t\treturn this; // For chaining.\n\t},\n\t\n\t/** `addStatistic(stat)` adds the values in the given Statistic object to this one.\n\t*/\n\taddStatistic: function addStatistic(stat) {\n\t\tthis.__count__ += stat.__count__; \n\t\tthis.__sum__ += stat.__sum__; \n\t\tthis.__sqrSum__ += stat.__sqrSum__;\n\t\tif (stat.__min__ < this.__min__) {\n\t\t\tthis.__min__ = stat.__min__;\n\t\t\tthis.__maxData__ = stat.__maxData__;\n\t\t}\n\t\tif (stat.__max__ > this.__max__) {\n\t\t\tthis.__max__ = stat.__max__;\n\t\t\tthis.__maxData__ = stat.__maxData__;\n\t\t}\t\t\n\t\treturn this;\n\t},\n\t\n\t// ### Time handling ###########################################################################\n\t\n\t/** `startTime(timestamp=now)` starts a chronometer for this statistic.\n\t*/\n\tstartTime: function startTime(timestamp) {\n\t\tvar chronometer = this.__chronometer__ || (this.__chronometer__ = new Chronometer());\n\t\treturn chronometer.reset(timestamp);\n\t},\n\t\n\t/** `addTime(data=undefined)` adds to this statistic the time since `startTime` was called.\n\t*/\n\taddTime: function addTime(data) {\n\t\traiseIf(!this.__chronometer__, \"Statistic's chronometer has not been started.\");\n\t\treturn this.add(this.__chronometer__.time(), data);\n\t},\n\n\t/** `addTick(data=undefined)` adds to this statistic the time since `startTime` was called, and \n\tresets the chronometer.\n\t*/\n\taddTick: function addTick(data) {\n\t\traiseIf(!this.__chronometer__, \"Statistic's chronometer has not been started.\");\n\t\treturn this.add(this.__chronometer__.tick(), data);\n\t},\n\t\n\t// ## Tests and inference ######################################################################\n\t\n\t/** The static `z_test` method returns the mean statistic for [z-tests](http://en.wikipedia.org/wiki/Z-test)\n\tgiven the expected `mean` and `variance` and the `sampleCount` and `sampleMean`.\t\n\t*/\n\t'static z_test': function z_test(mean, variance, sampleCount, sampleMean) {\n\t\tvar r = {},\n\t\t\tz = r.z = (sampleMean - mean) / Math.sqrt(variance / sampleCount),\n\t\t\tp = math.gauss_cdf(z);\n\t\tr.p_lessThan    = z < 0 ? p : 0;\n\t\tr.p_greaterThan = z > 0 ? 1 - p : 0;\n\t\tr.p_notEqual    = z !== 0 ? 2 * Math.max(r.p_lessThan, r.p_greaterThan) : 0; //TODO Check this.\n\t\treturn r;\n\t},\n\t\n\t/** The instance `z_test` method is analogue to the static one, using this object's data. The \n\t`variance` is assumed to this sample's variance by default.\n\t*/\n\tz_test: function z_test(mean, variance) {\n\t\tvariance = isNaN(variance) ? this.variance() : +variance;\n\t\treturn Statistic.z_test(mean, variance, this.count(), this.average());\n\t},\n\t\n\t/** The static `t_test1` method returns the mean statistic for \n\t[Student's one-sample t-tests](http://en.wikipedia.org/wiki/Student%27s_t-test#One-sample_t-test) \n\tgiven: `mean`, `sampleCount`, `sampleMean` and `sampleStandardDeviation`.\n\t*/\n\t'static t_test1': function t_test1(mean, sampleCount, sampleMean, sampleStandardDeviation) {\n\t\treturn { \n\t\t\tt: (sampleMean - mean) / sampleStandardDeviation * Math.sqrt(sampleCount)\n\t\t};\n\t},\n\t\n\t/** The instance `t_test1` method is analogue to the static one, using this object's data. The \n\t`mean` is assumed to be zero by default.\n\t*/\n\tt_test1: function t_test1(mean, sampleCount, sampleMean, sampleStandardDeviation) {\n\t\treturn Statistic.t_test1(\n\t\t\tisNaN(mean) ? 0.0 : +mean,\n\t\t\tisNaN(sampleCount) ? this.count() : +sampleCount,\n\t\t\tisNaN(sampleMean) ? this.average() : +sampleMean,\n\t\t\tisNaN(sampleStandardDeviation) ? this.standardDeviation() : +sampleStandardDeviation\n\t\t);\n\t},\n\t\n\t/** The static `t_test2` method returns the mean statistic for \n\t[Student's two-sample t-tests](http://en.wikipedia.org/wiki/Student%27s_t-test#Unequal_sample_sizes.2C_equal_variance) \n\tgiven the two sample groups' count, mean and variance.\n\t*/\n\t'static t_test2': function t_test2(sampleCount1, sampleCount2, \n\t\t\tsampleMean1, sampleMean2, sampleVariance1, sampleVariance2) {\n\t\tvar pooledVariance = (((sampleCount1 - 1) * sampleVariance1 + (sampleCount2 - 1) * sampleVariance2) /\n\t\t\t(sampleCount1 + sampleCount2 - 2));\n\t\treturn { \n\t\t\tt: (sampleMean1 - sampleMean2) / Math.sqrt(pooledVariance * (1 / sampleCount1 + 1 / sampleCount2))\n\t\t};\n\t},\n\t\n\t/** The instance `t_test2` method is analogue to the static one, using this object's and another\n\tone's data.\n\t*/\n\tt_test2: function t_test2(other) {\n\t\treturn Statistic.t_test2(\n\t\t\tthis.count(), other.count(),\n\t\t\tthis.average(), other.average(),\n\t\t\tthis.variance(), other.variance()\n\t\t);\n\t},\n\t\n\t// ## Other ####################################################################################\n\t\n\t/** The default string representation is the concatenation of the statistic's id, count, \n\tminimum, average, maximum and standard deviation, separated by tabs.\n\t*/\n\ttoString: function toString(sep) {\n\t\tsep = ''+ (sep || '\\t');\n\t\tvar keys = typeof this.keys !== 'object' ? this.keys + '' :\n\t\t\titerable(this.keys).map(function (kv) {\n\t\t\t\treturn kv[0] +':'+ kv[1];\n\t\t\t}).join(', ');\n\t\treturn [keys, this.count(), this.minimum(), this.average(), \n\t\t\tthis.maximum(), this.standardDeviation()].join(sep);\n\t},\n\t\n\t/** Serialization and materialization using Sermat, registered with identifier\n\t`creatartis-base.Statistic`.\n\t*/\n\t'static __SERMAT__': {\n\t\tidentifier: 'Statistic',\n\t\tserializer: function serialize_Statistic(obj) {\n\t\t\tvar result = [obj.keys || null, obj.__count__, obj.__sum__, obj.__sqrSum__, obj.__min__, obj.__max__];\n\t\t\tif (typeof obj.__minData__ !== 'undefined') { // Assumes this implies (typeof obj.__maxData__ !== 'undefined')\n\t\t\t\treturn result.concat([obj.__minData__, obj.__maxData__]);\n\t\t\t} else {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t},\n\t\tmaterializer: function materialize_Statistic(obj, args  /* [keys, count, sum, sqrSum, min, max, minData, maxData] */) {\n\t\t\tif (!args) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tvar stat = args[0] ? new Statistic(args[0]) : new Statistic();\n\t\t\tstat.__count__ = +args[1]; \n\t\t\tstat.__sum__ = +args[2];\n\t\t\tstat.__sqrSum__ = +args[3];\n\t\t\tstat.__min__ = +args[4];\n\t\t\tstat.__max__ = +args[5];\n\t\t\tif (stat.__count__ > 0) {\n\t\t\t\tstat.__minData__ = args[6];\n\t\t\t\tstat.__maxData__ = args[7];\n\t\t\t}\n\t\t\treturn stat;\n\t\t}\n\t}\n}); // declare Statistic.","/** # Statistics\n\nStatistical accounting, measurements and related functions.\n*/\nvar Statistics = exports.Statistics = declare({\n\t/** A `Statistics` is a bundle of Statistic objects.\n\t*/\n\tconstructor: function Statistics() {\n\t\tthis.__stats__ = {};\n\t},\n\t\n\t/** Each [`Statistic`](Statistic.js.html) object is stored in `__stats__` indexed by an \n\tidentifier string generated by `__id__(keys)`.\n\t*/\n\t__id__: function __id__(keys) {\n\t\tif (typeof keys === 'object' && keys !== null) {\n\t\t\tif (Array.isArray(keys)) {\n\t\t\t\treturn JSON.stringify(keys.slice().sort());\n\t\t\t} else {\n\t\t\t\treturn Object.keys(keys).sort().map(function (n) {\n\t\t\t\t\treturn JSON.stringify(n) +':'+ JSON.stringify(keys[n]);\n\t\t\t\t}).join(',');\n\t\t\t}\n\t\t} else {\n\t\t\treturn JSON.stringify(keys)+'';\n\t\t}\n\t},\n\t\n\t/** `stats(keys)` gets the [`Statistic`](Statistic.js.html) objects that applies to `keys`.\n\t*/\n\tstats: function stats(keys) {\n\t\treturn iterable(this.__stats__).map(function (keyVal) {\n\t\t\treturn keyVal[1];\n\t\t}, function (stat) {\n\t\t\treturn stat.applies(keys);\n\t\t}).toArray();\n\t},\n\t\n\t/** `stat(keys)` gets the statistic that applies to `keys`, or creates it if it does not exist.\n\t*/\n\tstat: function stat(keys) {\n\t\tvar id = this.__id__(keys);\n\t\treturn this.__stats__[id] || (this.__stats__[id] = new Statistic(keys));\n\t},\n\t\n\t/** `addObject(obj, data)` adds the values in the given object, one stat per member. If a member \n\tis an array, all numbers in the array are added.\n\t*/\n\taddObject: function addObject(obj, data) {\n\t\traiseIf(!obj, \"Cannot add object \"+ JSON.stringify(obj) +\".\");\n\t\tfor (var name in obj) {\n\t\t\tif (Array.isArray(obj[name])) {\n\t\t\t\tthis.addAll(name, obj[name], data);\n\t\t\t} else {\n\t\t\t\tthis.add(name, obj[name], data);\n\t\t\t}\n\t\t}\n\t\treturn this; // For chaining.\n\t},\n\t\n\t/** `addStatistic(stat, keys=stat.keys)` adds the values in the given [`Statistic`](Statistic.js.html) \n\tto the one with the same keys in this object. If there is none one is created. This does not put\n\tthe argument as an statistic of this object.\n\t*/\n\taddStatistic: function addStatistic(stat, keys) {\n\t\treturn this.stat(typeof keys !== 'undefined' ? keys : stat.keys).addStatistic(stat);\n\t},\n\t\n\t/** `addStatistics(stats, keys=all)` combines the stats of the given `Statistics` with this \n\tone's.\n\t*/\n\taddStatistics: function addStatistics(stats, keys) {\n\t\tvar self = this;\n\t\tstats.stats(keys).forEach(function (stat) {\n\t\t\tself.stat(stat.keys).addStatistic(stat);\n\t\t});\n\t\treturn this;\n\t},\n\t\n\t// ## Statistic updating shortcuts #############################################################\n\t\n\t/** `reset(keys)` resets all the stats that apply to the given `keys`.\n\t*/\n\treset: function reset(keys) {\n\t\tthis.stats(keys).forEach(function (stat) {\n\t\t\tstat.reset();\n\t\t});\n\t\treturn this; // For chaining.\n\t},\n\n\t/** `add(keys, value, data)` adds a value to the corresponding statistics.\n\t*/\n\tadd: function add(keys, value, data) {\n\t\treturn this.stat(keys).add(value, data);\n\t},\n\t\n\t/** `gain(keys, value, factor, data)` gain a value to the corresponding statistics.\n\t*/\n\tgain: function gain(keys, value, factor, data) {\n\t\treturn this.stat(keys).gain(value, factor, data);\n\t},\n\t\n\t/** `addAll(keys, values, data)` add all values to the corresponding statistics.\n\t*/\n\taddAll: function addAll(keys, values, data) {\n\t\treturn this.stat(keys).addAll(values, data);\n\t},\n\t\n\t/** `gainAll(keys, values, factor, data)` gain all values to the corresponding statistics.\n\t*/\n\tgainAll: function gainAll(keys, values, factor, data) {\n\t\treturn this.stat(keys).addAll(values, data);\n\t},\n\n\t/** `startTime(keys, timestamp=now)` starts the timers of all the corresponding statistics.\n\t*/\n\tstartTime: function startTime(keys, timestamp) {\n\t\treturn this.stat(keys).startTime(timestamp);\n\t},\n\t\n\t/** `addTime(keys, data=undefined)` adds the times elapsed since the timers of the corresponding \n\tstatistics was started.\n\t*/\n\taddTime: function addTime(keys, data) {\n\t\treturn this.stat(keys).addTime(data);\n\t},\n\t\n\t/** `addTick(keys, data=undefined)` adds the times elapsed since the timers of the corresponding \n\tstatistics was started, and resets them.\n\t*/\n\taddTick: function addTick(keys, data) {\n\t\treturn this.stat(keys).addTick(data);\n\t},\n\t\n\t// ## Statistic querying shortcuts #############################################################\n\t\n\t/** `accumulation(keys)` creates a new statistic that accumulates all that apply to the given \n\tkeys.\n\t*/\n\taccumulation: function accumulation(keys) {\n\t\tvar acc = new Statistic(keys);\n\t\tthis.stats(keys).forEach(function (stat) {\n\t\t\tacc.addStatistic(stat);\n\t\t});\n\t\treturn acc;\n\t},\n\t\n\t/** `count(keys)` gets the count of the accumulation of the corresponding statistics.\n\t*/\n\tcount: function count(keys) {\n\t\treturn this.accumulation(keys).count();\n\t},\n\t\n\t/** `sum(keys)` gets the sum of the accumulation of the corresponding statistics.\n\t*/\n\tsum: function sum(keys) {\n\t\treturn this.accumulation(keys).sum();\n\t},\n\t\n\t/** `squareSum(keys)` gets the sum of squares of the accumulation of the corresponding \n\tstatistics.\n\t*/\n\tsquareSum: function squareSum(keys) {\n\t\treturn this.accumulation(keys).squareSum();\n\t},\n\t\n\t/** `minimum(keys)` gets the minimum value of the accumulation of the corresponding statistics.\n\t*/\n\tminimum: function minimum(keys) {\n\t\treturn this.accumulation(keys).minimum();\n\t},\n\t\n\t/** `maximum(keys)` gets the maximum value of the accumulation of the corresponding statistics.\n\t*/\n\tmaximum: function maximum(keys) {\n\t\treturn this.accumulation(keys).maximum();\n\t},\n\t\n\t/** `average(keys)` gets the average value of the accumulation of the corresponding statistics.\n\t*/\n\taverage: function average(keys) {\n\t\treturn this.accumulation(keys).average();\n\t},\n\t\n\t/** `variance(keys, center=average)` calculates the variance of the accumulation of the \n\tcorresponding statistics.\n\t*/\n\tvariance: function variance(keys, center) {\n\t\treturn this.accumulation(keys).variance(center);\n\t},\n\t\n\t/** `standardDeviation(keys, center=average)` calculates the standard deviation of the \n\taccumulation of the corresponding statistics.\n\t*/\n\tstandardDeviation: function standardDeviation(keys, center) {\n\t\treturn this.accumulation(keys).standardDeviation(center);\n\t},\n\t\n\t// ## Other ####################################################################################\n\t\n\t/** The default string representation concatenates the string representations off all \n\t`Statistic` objects, one per line.\n\t*/\n\ttoString: function toString(fsep, rsep) {\n\t\tfsep = ''+ (fsep || '\\t');\n\t\trsep = ''+ (rsep || '\\n');\n\t\tvar stats = this.__stats__;\n\t\treturn Object.keys(stats).map(function (name) {\n\t\t\treturn stats[name].toString(fsep);\n\t\t}).join(rsep);\n\t},\n\t\n\t/** Serialization and materialization using Sermat, registered with identifier \n\t`creatartis-base.Statistics`.\n\t*/\n\t'static __SERMAT__': {\n\t\tidentifier: 'Statistics',\n\t\tserializer: function serialize_Statistics(obj) {\n\t\t\tvar stats = obj.__stats__;\n\t\t\treturn Object.keys(stats).map(function (k) {\n\t\t\t\treturn stats[k];\n\t\t\t});\n\t\t},\n\t\tmaterializer: function materialize_Statistics(obj, args) {\n\t\t\tif (!args) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tvar result = new Statistics();\n\t\t\targs.forEach(function (stat) {\n\t\t\t\tresult.addStatistic(stat);\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t}\n}); // declare Statistics.","/** # Logger\n\nSimple logging capabilities in a similar (but greatly simplified) fashion that \nLog4J.\n*/\nvar Logger = exports.Logger\t= declare({\n\t/** All loggers have a name, a level and a parent (except `Logger.ROOT`). \n\tThe level is the priority of the entries accepted by the logger, and is used\n\tto filter which messages are displayed. All log entries accepted by a logger\n\tare forwarded to the parent (if defined).\n\t*/\n\tconstructor: function Logger(name, parent, level) { \n\t\tthis.name = ''+ name;\n\t\tthis.parent = parent || Logger.ROOT;\n\t\tthis.level = level || \"INFO\";\n\t\tthis.appenders = [];\n\t},\n\t\n\t/** `log(level, message...)` appends a new entry in the log if the given \n\tlevel is greater than the current logger's level. The message results of a \n\ttimestamp and the arguments.\n\t*/\n\tlog: function log(level) {\n\t\tvar passes = this.LEVELS[this.level] <= this.LEVELS[level];\n\t\tif (passes) {\n\t\t\tvar logger = this,\n\t\t\t\tmessage = Array.prototype.slice.call(arguments, 1).join('');\n\t\t\tthis.appenders.forEach(function (appender) {\n\t\t\t\tvar format = appender.format || logger.defaultFormat;\n\t\t\t\tappender(format(logger.name, new Date(), level, message));\n\t\t\t});\n\t\t\tif (this.parent) {\n\t\t\t\tthis.parent.log.apply(this.parent, arguments); // Forward to parent.\n\t\t\t}\n\t\t}\n\t\treturn passes;\n\t},\n\t\n\t/** Log levels are numbers, with the default one being 0. Some standard \n\tlevels are predefined. For each of these there is a shortcut method to log\n\tdirectly in that level:\n\t*/\n\tLEVELS: {\n\t\tTRACE: -Infinity, DEBUG: -1, INFO: 0, WARN: 1, ERROR: 2, FATAL: Infinity,\n\t\tOK: 0, FAIL: 1, TODO: 1, FIXME: 1 // Utility levels.\n\t},\n\t\n\t/** + `trace(message...)` logs an entry with the `TRACE` level.\n\t*/\n\ttrace: function trace() {\n\t\treturn this.log(\"TRACE\", Array.prototype.slice.call(arguments, 0).join(\"\"));\n\t},\n\t\n\t/** + `debug(message...)` logs an entry with the `DEBUG` level.\n\t*/\n\tdebug: function debug() {\n\t\treturn this.log(\"DEBUG\", Array.prototype.slice.call(arguments, 0).join(\"\"));\n\t},\n\n\t/** + `info(message...)` logs an entry with the `INFO` level.\n\t*/\n\tinfo: function info() {\n\t\treturn this.log(\"INFO\", Array.prototype.slice.call(arguments, 0).join(\"\"));\n\t},\n\n\t/** + `warn(message...)` logs an entry with the `WARN` level.\n\t*/\n\twarn: function warn() {\n\t\treturn this.log(\"WARN\", Array.prototype.slice.call(arguments, 0).join(\"\"));\n\t},\n\t\n\t/** + `error(message...)` logs an entry with the `ERROR` level.\n\t*/\n\terror: function error() {\n\t\treturn this.log(\"ERROR\", Array.prototype.slice.call(arguments, 0).join(\"\"));\n\t},\n\n\t/** + `fatal(message...)` logs an entry with the `FATAL` level.\n\t*/\n\tfatal: function fatal() {\n\t\treturn this.log(\"FATAL\", Array.prototype.slice.call(arguments, 0).join(\"\"));\n\t},\n\t\n\t/** ## Formats. ###########################################################\n\t\n\tEntries are formatted before appending them. Each appender may have a\n\tdifferent format function. \n\t*/\n\t\n\t/** By default, `defaultFormat(name, time, level, message)`\n\tis used. It simply concatenates the log entry data in a string.\n\t*/\n\tdefaultFormat: function defaultFormat(name, time, level, message) {\n\t\treturn [level, name, Text.formatDate(time, 'hhnnss.SSS'), message].join(' ');\n\t},\n\t\n\t/** The `htmlFormat(tag='pre', cssClassPrefix='log_')` writes the entry in\n\tvalid HTML with CSS styling support.\n\t*/\n\thtmlFormat: function htmlFormat(tag, cssClassPrefix) {\n\t\ttag = tag || 'p';\n\t\tcssClassPrefix = cssClassPrefix || 'log_';\n\t\treturn function (name, time, level, message) {\n\t\t\treturn ['<', tag, ' class=\"', cssClassPrefix, level, '\">', \n\t\t\t\t'<span class=\"', cssClassPrefix, 'level\">', level, '</span> ',\n\t\t\t\t'<span class=\"', cssClassPrefix, 'name\">', name, '</span> ',\n\t\t\t\t'<span class=\"', cssClassPrefix, 'time\">', Text.formatDate(time, 'hhnnss.SSS'), '</span> ',\n\t\t\t\t'<span class=\"', cssClassPrefix, 'message\">', \n\t\t\t\t\tText.escapeXML(message).replace(/\\n/g, '<br/>').replace(/\\t/g, '&nbsp;&nbsp;&nbsp;'), \n\t\t\t\t'</span>',\n\t\t\t\t'</', tag, '>'].join('');\n\t\t};\n\t},\n\t\n\t/** ## Appenders. ##########################################################\n\t\n\tAppenders are functions attached to loggers that output the log entries in\n\tdifferent ways.\n\t*/\n\t\n\t/** `appendToConsole()` adds to the logger an appender that writes messages \n\tto the console (using console.log).\n\t*/\n\tappendToConsole: (function () {\n\t\tfunction __consoleAppender__(entry) {\n\t\t\tconsole.log(entry);\n\t\t}\n\t\treturn function appendToConsole() {\n\t\t\tthis.appenders.push(__consoleAppender__);\n\t\t\treturn __consoleAppender__;\n\t\t};\n\t})(),\n\t\n\t/** `appendToFile(filePath, flags='a', encoding='utf-8')` adds to the logger\n\tan appender that writes the log entries to a file using NodeJS's file system\n\tmodule.\n\t*/\n\tappendToFile: function appendToFile(filepath, flags, encoding) { // Node.js specific.\n\t\tfilepath = filepath || './log'+ (new Date()).format('yyyymmdd-hhnnss') +'.log';\n\t\tflags = flags !== undefined ? flags : 'a';\n\t\tencoding = encoding !== undefined ? encoding : 'utf-8';\n\t\tvar stream = require('fs').createWriteStream(filepath, {flags: flags, encoding: encoding});\n\t\tfunction fileAppender(entry) {\n\t\t\tstream.write(entry +'\\n');\n\t\t}\n\t\tthis.appenders.push(fileAppender);\n\t\treturn fileAppender;\n\t},\n\t\n\t/** `appendToHtml(htmlElement=document.body, maxEntries=all)` adds to the \n\tlogger an appender that writes the log entries as paragraphs inside the \n\tgiven `htmlElement`. The number of entries can be limited with `maxEntries`.\n\t\n\tWarning! Formatted entry text is assumed to be valid HTML and hence is not\n\tescaped.\n\t*/\n\tappendToHtml: function appendToHtml(htmlElement, maxEntries, reversed) { // Browser specific.\n\t\tmaxEntries = (+maxEntries) || Infinity;\n\t\treversed = !!reversed;\n\t\tif (typeof htmlElement === 'string') {\n\t\t\thtmlElement =  document.getElementById(htmlElement);\n\t\t} else {\n\t\t\thtmlElement = htmlElement || document.getElementsByTagName('body')[0];\n\t\t}\n\t\tvar entries = [];\n\t\tfunction htmlAppender(entry) {\n\t\t\tif (reversed) {\n\t\t\t\tentries.unshift(entry);\n\t\t\t\twhile (entries.length > maxEntries) {\n\t\t\t\t\tentries.pop();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tentries.push(entry);\n\t\t\t\twhile (entries.length > maxEntries) {\n\t\t\t\t\tentries.shift();\n\t\t\t\t}\n\t\t\t}\n\t\t\thtmlElement.innerHTML = entries.join('\\n');\n\t\t}\n\t\tthis.appenders.push(htmlAppender);\n\t\treturn htmlAppender;\n\t},\n\t\n\t/** `appendAsWorkerMessages(messageTag='log')` adds to the logger an \n\tappender that posts the log entries with the web workers `postMessage()`\n\tfunction.\n\t*/\n\tappendAsWorkerMessages: function appendAsWorkerMessages(messageTag) {\n\t\tmessageTag = ''+ (messageTag || 'log');\n\t\tfunction postMessageAppender(entry) {\n\t\t\tvar message = ({});\n\t\t\tmessage[messageTag] = entry;\n\t\t\tself.postMessage(JSON.stringify(message));\n\t\t}\n\t\tpostMessageAppender.format = function format(name, time, level, message) {\n\t\t\treturn {name: name, time: time, level: level, message: message};\n\t\t};\n\t\tthis.appenders.push(postMessageAppender);\n\t\treturn postMessageAppender;\n\t},\n\t\n\t// ## Other ################################################################\n\t\n\t/** `stats()` gets the logger's Statistics objects, creating it if \n\tnecessary.\n\t*/\n\tstats: function stats() {\n\t\treturn this.__stats__ || (this.__stats__ = new Statistics());\n\t}\n}); // declare Logger.\t\n\n/** The `Logger.ROOT` must be the final ancestor of all loggers. It is the \ndefault parent of the Logger constructor.\n*/\nLogger.ROOT = new Logger(\"\");\n","// See __prologue__.js\n\t[\tRandomness, Randomness.LinearCongruential, Randomness.MersenneTwister,\n\t\tStatistic, Statistics\n\t].forEach(function (type) {\n\t\ttype.__SERMAT__.identifier = exports.__package__ +'.'+ type.__SERMAT__.identifier;\n\t\texports.__SERMAT__.include.push(type);\n\t});\n\treturn exports;\n}\n"]}